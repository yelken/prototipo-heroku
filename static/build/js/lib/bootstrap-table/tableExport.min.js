!function(t){t.fn.extend({tableExport:function(e){function o(e,o,n,l,a){if(-1==t.inArray(n,y.ignoreRow)&&-1==t.inArray(n-l,y.ignoreRow)){var r=t(e).filter(function(){return"none"!=t(this).data("tableexport-display")&&(t(this).is(":visible")||"always"==t(this).data("tableexport-display")||"always"==t(this).closest("table").data("tableexport-display"))}).find(o),s=0;r.each(function(e){if(("always"==t(this).data("tableexport-display")||"none"!=t(this).css("display")&&"hidden"!=t(this).css("visibility")&&"none"!=t(this).data("tableexport-display"))&&-1==t.inArray(e,y.ignoreColumn)&&-1==t.inArray(e-r.length,y.ignoreColumn)&&"function"==typeof a){var o,l,i=0,c=0;if("undefined"!=typeof w[n]&&0<w[n].length)for(o=0;o<=e;o++)"undefined"!=typeof w[n][o]&&(a(null,n,o),delete w[n][o],e++);for(t(this).is("[colspan]")&&(i=parseInt(t(this).attr("colspan")),s+=0<i?i-1:0),t(this).is("[rowspan]")&&(c=parseInt(t(this).attr("rowspan"))),a(this,n,e),o=0;o<i-1;o++)a(null,n,e+o);if(c)for(l=1;l<c;l++)for("undefined"==typeof w[n+l]&&(w[n+l]=[]),w[n+l][e+s]="",o=1;o<i;o++)w[n+l][e+s-o]=""}})}}function n(t){if(!0===y.consoleLog&&console.log(t.output()),"string"===y.outputMode)return t.output();if("base64"===y.outputMode)return h(t.output());try{var e=t.output("blob");saveAs(e,y.fileName+".pdf")}catch(o){p(y.fileName+".pdf","data:application/pdf;base64,",t.output())}}function l(t,e,o){var n=0;if("undefined"!=typeof o&&(n=o.colspan),0<=n){for(var l=t.width,a=t.textPos.x,r=e.table.columns.indexOf(e.column),s=1;s<n;s++)l+=e.table.columns[r+s].width;return 1<n&&("right"===t.styles.halign?a=t.textPos.x+l-t.width:"center"===t.styles.halign&&(a=t.textPos.x+(l-t.width)/2)),t.width=l,t.textPos.x=a,"undefined"!=typeof o&&1<o.rowspan&&("middle"===t.styles.valign?t.textPos.y+=t.height*(o.rowspan-1)/2:"bottom"===t.styles.valign&&(t.textPos.y+=(o.rowspan-1)*t.height),t.height*=o.rowspan),"middle"!==t.styles.valign&&"bottom"!==t.styles.valign||(o=("string"==typeof t.text?t.text.split(/\r\n|\r|\n/g):t.text).length||1,2<o&&(t.textPos.y-=(2-1.15)/2*e.row.styles.fontSize*(o-2)/3)),!0}return!1}function a(t,e,o){return t.replace(new RegExp(e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),o)}function r(t){return t=a(t||"0",y.numbers.html.decimalMark,"."),t=a(t,y.numbers.html.thousandsSeparator,""),("number"==typeof t||!1!==jQuery.isNumeric(t))&&t}function s(e,o,n){var l="";if(null!=e){e=t(e);var a=e.html();if("function"==typeof y.onCellHtmlData&&(a=y.onCellHtmlData(e,o,n,a)),!0===y.htmlContent)l=t.trim(a);else{var s=a.replace(/\n/g,"\u2028").replace(/<br\s*[\/]?>/gi,"⁠"),a=t("<div/>").html(s).contents(),s="";if(t.each(a.text().split("\u2028"),function(e,o){0<e&&(s+=" "),s+=t.trim(o)}),t.each(s.split("⁠"),function(e,o){0<e&&(l+="\n"),l+=t.trim(o).replace(/\u00AD/g,"")}),(y.numbers.html.decimalMark!=y.numbers.output.decimalMark||y.numbers.html.thousandsSeparator!=y.numbers.output.thousandsSeparator)&&(a=r(l),!1!==a)){var i=(""+a).split(".");1==i.length&&(i[1]="");var c=3<i[0].length?i[0].length%3:0,l=(0>a?"-":"")+(y.numbers.output.thousandsSeparator?(c?i[0].substr(0,c)+y.numbers.output.thousandsSeparator:"")+i[0].substr(c).replace(/(\d{3})(?=\d)/g,"$1"+y.numbers.output.thousandsSeparator):i[0])+(i[1].length?y.numbers.output.decimalMark+i[1]:"")}}!0===y.escape&&(l=escape(l)),"function"==typeof y.onCellData&&(l=y.onCellData(e,o,n,l))}return l}function i(t,e,o){return e+"-"+o.toLowerCase()}function c(t,e){var o=/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/.exec(t),n=e;return o&&(n=[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]),n}function d(e){var o=f(e,"text-align"),n=f(e,"font-weight"),l=f(e,"font-style"),a="";return"start"==o&&(o="rtl"==f(e,"direction")?"right":"left"),700<=n&&(a="bold"),"italic"==l&&(a+=l),""==a&&(a="normal"),{style:{align:o,bcolor:c(f(e,"background-color"),[255,255,255]),color:c(f(e,"color"),[0,0,0]),fstyle:a},colspan:parseInt(t(e).attr("colspan"))||0,rowspan:parseInt(t(e).attr("rowspan"))||0}}function f(t,e){try{return window.getComputedStyle?(e=e.replace(/([a-z])([A-Z])/,i),window.getComputedStyle(t,null).getPropertyValue(e)):t.currentStyle?t.currentStyle[e]:t.style[e]}catch(o){}return""}function u(t,e,o){if(e=f(t,e).match(/\d+/),null!==e){e=e[0];var n=document.createElement("div");return n.style.overflow="hidden",n.style.visibility="hidden",t.parentElement.appendChild(n),n.style.width=100+o,o=100/n.offsetWidth,t.parentElement.removeChild(n),e*o}return 0}function p(t,e,o){var n=window.navigator.userAgent;0<n.indexOf("MSIE ")||n.match(/Trident.*rv\:11\./)?(e=document.createElement("iframe"))&&(document.body.appendChild(e),e.setAttribute("style","display:none"),e.contentDocument.open("txt/html","replace"),e.contentDocument.write(o),e.contentDocument.close(),e.focus(),e.contentDocument.execCommand("SaveAs",!0,t),document.body.removeChild(e)):(n=document.createElement("a"))&&(n.style.display="none",n.download=t,0<=e.toLowerCase().indexOf("base64,")?n.href=e+h(o):n.href=e+encodeURIComponent(o),document.body.appendChild(n),document.createEvent?(null==g&&(g=document.createEvent("MouseEvents")),g.initEvent("click",!0,!1),n.dispatchEvent(g)):document.createEventObject?n.fireEvent("onclick"):"function"==typeof n.onclick&&n.onclick(),document.body.removeChild(n))}function h(t){var e,o,n,l,a,r,s="",i=0;for(t=t.replace(/\x0d\x0a/g,"\n"),o="",n=0;n<t.length;n++)l=t.charCodeAt(n),128>l?o+=String.fromCharCode(l):(127<l&&2048>l?o+=String.fromCharCode(l>>6|192):(o+=String.fromCharCode(l>>12|224),o+=String.fromCharCode(l>>6&63|128)),o+=String.fromCharCode(63&l|128));for(t=o;i<t.length;)e=t.charCodeAt(i++),o=t.charCodeAt(i++),n=t.charCodeAt(i++),l=e>>2,e=(3&e)<<4|o>>4,a=(15&o)<<2|n>>6,r=63&n,isNaN(o)?a=r=64:isNaN(n)&&(r=64),s=s+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(r);return s}var y={consoleLog:!1,csvEnclosure:'"',csvSeparator:",",csvUseBOM:!0,displayTableName:!1,escape:!1,excelstyles:["border-bottom","border-top","border-left","border-right"],fileName:"tableExport",htmlContent:!1,ignoreColumn:[],ignoreRow:[],jspdf:{orientation:"p",unit:"pt",format:"a4",margins:{left:20,right:10,top:10,bottom:10},autotable:{styles:{cellPadding:2,rowHeight:12,fontSize:8,fillColor:255,textColor:50,fontStyle:"normal",overflow:"ellipsize",halign:"left",valign:"middle"},headerStyles:{fillColor:[52,73,94],textColor:255,fontStyle:"bold",halign:"center"},alternateRowStyles:{fillColor:245},tableExport:{onAfterAutotable:null,onBeforeAutotable:null,onTable:null}}},numbers:{html:{decimalMark:".",thousandsSeparator:","},output:{decimalMark:".",thousandsSeparator:","}},onCellData:null,onCellHtmlData:null,outputMode:"file",tbodySelector:"tr",theadSelector:"tr",tableName:"myTableName",type:"csv",worksheetName:"xlsWorksheetName"},m=this,g=null,b=[],v=[],x=0,w=[],C="";if(t.extend(!0,y,e),"csv"==y.type||"txt"==y.type){e=function(e,n,l,r){return v=t(m).find(e).first().find(n),v.each(function(){C="",o(this,l,x,r+v.length,function(t,e,o){var n=C,l="";null!=t&&(t=s(t,e,o),e=null===t||""==t?"":t.toString(),t instanceof Date?l=y.csvEnclosure+t.toLocaleString()+y.csvEnclosure:(l=a(e,y.csvEnclosure,y.csvEnclosure+y.csvEnclosure),(0<=l.indexOf(y.csvSeparator)||/[\r\n ]/g.test(l))&&(l=y.csvEnclosure+l+y.csvEnclosure))),C=n+(l+y.csvSeparator)}),C=t.trim(C).substring(0,C.length-1),0<C.length&&(0<S.length&&(S+="\n"),S+=C),x++}),v.length};var S="",E=0,x=0,E=E+e("thead",y.theadSelector,"th,td",E),E=E+e("tbody",y.tbodySelector,"td",E);if(e("tfoot",y.tbodySelector,"td",E),S+="\n",!0===y.consoleLog&&console.log(S),"string"===y.outputMode)return S;if("base64"===y.outputMode)return h(S);try{var A=new Blob([S],{type:"text/"+("csv"==y.type?"csv":"plain")+";charset=utf-8"});saveAs(A,y.fileName+"."+y.type,"csv"!=y.type||!1===y.csvUseBOM)}catch(N){p(y.fileName+"."+y.type,"data:text/"+("csv"==y.type?"csv":"plain")+";charset=utf-8,"+("csv"==y.type&&y.csvUseBOM?"\ufeff":""),S)}}else if("sql"==y.type){var x=0,j="INSERT INTO `"+y.tableName+"` (",b=t(m).find("thead").first().find(y.theadSelector);if(b.each(function(){o(this,"th,td",x,b.length,function(t,e,o){j+="'"+s(t,e,o)+"',"}),x++,j=t.trim(j),j=t.trim(j).substring(0,j.length-1)}),j+=") VALUES ",v=t(m).find("tbody").first().find(y.tbodySelector),v.each(function(){C="",o(this,"td",x,b.length+v.length,function(t,e,o){C+="'"+s(t,e,o)+"',"}),3<C.length&&(j+="("+C,j=t.trim(j).substring(0,j.length-1),j+="),"),x++}),j=t.trim(j).substring(0,j.length-1),j+=";",!0===y.consoleLog&&console.log(j),"string"===y.outputMode)return j;if("base64"===y.outputMode)return h(j);try{A=new Blob([j],{type:"text/plain;charset=utf-8"}),saveAs(A,y.fileName+".sql")}catch(N){p(y.fileName+".sql","data:application/sql;charset=utf-8,",j)}}else if("json"==y.type){var k=[],b=t(m).find("thead").first().find(y.theadSelector);b.each(function(){var t=[];o(this,"th,td",x,b.length,function(e,o,n){t.push(s(e,o,n))}),k.push(t)});var M=[],v=t(m).find("tbody").first().find(y.tbodySelector);if(v.each(function(){var t=[];o(this,"td",x,b.length+v.length,function(e,o,n){t.push(s(e,o,n))}),0<t.length&&(1!=t.length||""!=t[0])&&M.push(t),x++}),e=[],e.push({header:k,data:M}),e=JSON.stringify(e),!0===y.consoleLog&&console.log(e),"string"===y.outputMode)return e;if("base64"===y.outputMode)return h(e);try{A=new Blob([e],{type:"application/json;charset=utf-8"}),saveAs(A,y.fileName+".json")}catch(N){p(y.fileName+".json","data:application/json;charset=utf-8;base64,",e)}}else if("xml"===y.type){var x=0,P='<?xml version="1.0" encoding="utf-8"?>',P=P+"<tabledata><fields>",b=t(m).find("thead").first().find(y.theadSelector);b.each(function(){o(this,"th,td",x,v.length,function(t,e,o){P+="<field>"+s(t,e,o)+"</field>"}),x++});var P=P+"</fields><data>",D=1,v=t(m).find("tbody").first().find(y.tbodySelector);if(v.each(function(){var t=1;C="",o(this,"td",x,b.length+v.length,function(e,o,n){C+="<column-"+t+">"+s(e,o,n)+"</column-"+t+">",t++}),0<C.length&&"<column-1></column-1>"!=C&&(P+='<row id="'+D+'">'+C+"</row>",D++),x++}),P+="</data></tabledata>",!0===y.consoleLog&&console.log(P),"string"===y.outputMode)return P;if("base64"===y.outputMode)return h(P);try{A=new Blob([P],{type:"application/xml;charset=utf-8"}),saveAs(A,y.fileName+".xml")}catch(N){p(y.fileName+".xml","data:application/xml;charset=utf-8;base64,",P)}}else if("excel"==y.type||"xls"==y.type||"word"==y.type||"doc"==y.type){e="excel"==y.type||"xls"==y.type?"excel":"word";var E="excel"==e?"xls":"doc",L="xls"==E?'xmlns:x="urn:schemas-microsoft-com:office:excel"':'xmlns:w="urn:schemas-microsoft-com:office:word"',x=0,O="<table><thead>",b=t(m).find("thead").first().find(y.theadSelector);if(b.each(function(){C="",o(this,"th,td",x,b.length,function(e,o,n){if(null!=e){C+='<th style="';for(var l in y.excelstyles)y.excelstyles.hasOwnProperty(l)&&(C+=y.excelstyles[l]+": "+t(e).css(y.excelstyles[l])+";");t(e).is("[colspan]")&&(C+='" colspan="'+t(e).attr("colspan")),t(e).is("[rowspan]")&&(C+='" rowspan="'+t(e).attr("rowspan")),C+='">'+s(e,o,n)+"</th>"}}),0<C.length&&(O+="<tr>"+C+"</tr>"),x++}),O+="</thead><tbody>",v=t(m).find("tbody").first().find(y.tbodySelector),v.each(function(){C="",o(this,"td",x,b.length+v.length,function(e,o,n){if(null!=e){C+='<td style="';for(var l in y.excelstyles)y.excelstyles.hasOwnProperty(l)&&(C+=y.excelstyles[l]+": "+t(e).css(y.excelstyles[l])+";");t(e).is("[colspan]")&&(C+='" colspan="'+t(e).attr("colspan")),t(e).is("[rowspan]")&&(C+='" rowspan="'+t(e).attr("rowspan")),C+='">'+s(e,o,n)+"</td>"}}),0<C.length&&(O+="<tr>"+C+"</tr>"),x++}),y.displayTableName&&(O+="<tr><td></td></tr><tr><td></td></tr><tr><td>"+s(t("<p>"+y.tableName+"</p>"))+"</td></tr>"),O+="</tbody></table>",!0===y.consoleLog&&console.log(O),L='<html xmlns:o="urn:schemas-microsoft-com:office:office" '+L+' xmlns="http://www.w3.org/TR/REC-html40">'+('<meta http-equiv="content-type" content="application/vnd.ms-'+e+'; charset=UTF-8">'),L+="<head>","excel"===e&&(L+="<!--[if gte mso 9]>",L+="<xml>",L+="<x:ExcelWorkbook>",L+="<x:ExcelWorksheets>",L+="<x:ExcelWorksheet>",L+="<x:Name>",L+=y.worksheetName,L+="</x:Name>",L+="<x:WorksheetOptions>",L+="<x:DisplayGridlines/>",L+="</x:WorksheetOptions>",L+="</x:ExcelWorksheet>",L+="</x:ExcelWorksheets>",L+="</x:ExcelWorkbook>",L+="</xml>",L+="<![endif]-->"),L+="</head>",L+="<body>",L+=O,L+="</body>",L+="</html>",!0===y.consoleLog&&console.log(L),"string"===y.outputMode)return L;if("base64"===y.outputMode)return h(L);try{A=new Blob([L],{type:"application/vnd.ms-"+y.type}),saveAs(A,y.fileName+"."+E)}catch(N){p(y.fileName+"."+E,"data:application/vnd.ms-"+e+";base64,",L)}}else if("png"==y.type)html2canvas(t(m)[0],{allowTaint:!0,background:"#fff",onrendered:function(t){t=t.toDataURL(),t=t.substring(22);for(var e=atob(t),o=new ArrayBuffer(e.length),n=new Uint8Array(o),l=0;l<e.length;l++)n[l]=e.charCodeAt(l);if(!0===y.consoleLog&&console.log(e),"string"===y.outputMode)return e;if("base64"===y.outputMode)return h(t);try{var a=new Blob([o],{type:"image/png"});saveAs(a,y.fileName+".png")}catch(r){p(y.fileName+".png","data:image/png;base64,",t)}}});else if("pdf"==y.type)if(!1===y.jspdf.autotable){var A={dim:{w:u(t(m).first().get(0),"width","mm"),h:u(t(m).first().get(0),"height","mm")},pagesplit:!1},T=new jsPDF(y.jspdf.orientation,y.jspdf.unit,y.jspdf.format);T.addHTML(t(m).first(),y.jspdf.margins.left,y.jspdf.margins.top,A,function(){n(T)})}else{var B=y.jspdf.autotable.tableExport;if("string"==typeof y.jspdf.format&&"bestfit"===y.jspdf.format.toLowerCase()){var I={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89]},R="",W="",H=0;t(m).filter(":visible").each(function(){if("none"!=t(this).css("display")){var e=u(t(this).get(0),"width","pt");if(e>H){e>I.a0[0]&&(R="a0",W="l");for(var o in I)I.hasOwnProperty(o)&&I[o][1]>e&&(R=o,W="l",I[o][0]>e&&(W="p"));H=e}}}),y.jspdf.format=""==R?"a4":R,y.jspdf.orientation=""==W?"w":W}B.doc=new jsPDF(y.jspdf.orientation,y.jspdf.unit,y.jspdf.format),t(m).filter(function(){return"none"!=t(this).data("tableexport-display")&&(t(this).is(":visible")||"always"==t(this).data("tableexport-display"))}).each(function(){var e,n=0;if(B.columns=[],B.rows=[],B.rowoptions={},"function"==typeof B.onTable&&!1===B.onTable(t(this),y))return!0;y.jspdf.autotable.tableExport=null;var a=t.extend(!0,{},y.jspdf.autotable);y.jspdf.autotable.tableExport=B,a.margin={},t.extend(!0,a.margin,y.jspdf.margins),a.tableExport=B,"function"!=typeof a.beforePageContent&&(a.beforePageContent=function(t){1==t.pageCount&&t.table.rows.concat(t.table.headerRow).forEach(function(e){0<e.height&&(e.height+=(2-1.15)/2*e.styles.fontSize,t.table.height+=(2-1.15)/2*e.styles.fontSize)})}),"function"!=typeof a.createdHeaderCell&&(a.createdHeaderCell=function(t,e){if("undefined"!=typeof B.columns[e.column.dataKey]){var o=B.columns[e.column.dataKey];t.styles.halign=o.style.align,"inherit"===a.styles.fillColor&&(t.styles.fillColor=o.style.bcolor),"inherit"===a.styles.textColor&&(t.styles.textColor=o.style.color),"inherit"===a.styles.fontStyle&&(t.styles.fontStyle=o.style.fstyle)}}),"function"!=typeof a.createdCell&&(a.createdCell=function(t,e){var o=B.rowoptions[e.row.index+":"+e.column.dataKey];"undefined"!=typeof o&&"undefined"!=typeof o.style&&(t.styles.halign=o.style.align,"inherit"===a.styles.fillColor&&(t.styles.fillColor=o.style.bcolor),"inherit"===a.styles.textColor&&(t.styles.textColor=o.style.color),"inherit"===a.styles.fontStyle&&(t.styles.fontStyle=o.style.fstyle))}),"function"!=typeof a.drawHeaderCell&&(a.drawHeaderCell=function(t,e){var o=B.columns[e.column.dataKey];return(1!=o.style.hasOwnProperty("hidden")||!0!==o.style.hidden)&&l(t,e,o)}),"function"!=typeof a.drawCell&&(a.drawCell=function(t,e){return l(t,e,B.rowoptions[e.row.index+":"+e.column.dataKey])}),b=t(this).find("thead").find(y.theadSelector),b.each(function(){e=0,o(this,"th,td",n,b.length,function(t,o,n){var l=d(t);l.title=s(t,o,n),l.key=e++,B.columns.push(l)}),n++});var r=0;v=t(this).find("tbody").find(y.tbodySelector),v.each(function(){var l=[];e=0,o(this,"td",n,b.length+v.length,function(o,n,a){if("undefined"==typeof B.columns[e]){var i={title:"",key:e,style:{hidden:!0}};B.columns.push(i)}null!==o?B.rowoptions[r+":"+e++]=d(o):(i=t.extend(!0,{},B.rowoptions[r+":"+(e-1)]),i.colspan=-1,B.rowoptions[r+":"+e++]=i),l.push(s(o,n,a))}),l.length&&(B.rows.push(l),r++),n++}),"function"==typeof B.onBeforeAutotable&&B.onBeforeAutotable(t(this),B.columns,B.rows,a),B.doc.autoTable(B.columns,B.rows,a),"function"==typeof B.onAfterAutotable&&B.onAfterAutotable(t(this),a),y.jspdf.autotable.startY=B.doc.autoTableEndPosY()+a.margin.top}),n(B.doc),B.columns.length=0,B.rows.length=0,delete B.doc,B.doc=null}return this}})}(jQuery);