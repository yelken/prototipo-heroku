var SVGTypewriter;!function(t){var e;!function(t){var e;!function(t){function e(t,e){if(null==t||null==e)return t===e;if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function r(t,r){if(null==t||null==r)return t===r;var n=Object.keys(t).sort(),i=Object.keys(r).sort(),a=n.map(function(e){return t[e]}),o=i.map(function(t){return r[t]});return e(n,i)&&e(a,o)}t.arrayEq=e,t.objEq=r}(e=t.Methods||(t.Methods={}))}(e=t.Utils||(t.Utils={}))}(SVGTypewriter||(SVGTypewriter={}));var SVGTypewriter;!function(t){var e;!function(t){var e;!function(t){function e(t,e,r){var n=d3.transform(t.attr("transform"));return null==e?n.translate:(r=null==r?0:r,n.translate[0]=e,n.translate[1]=r,t.attr("transform",n.toString()),t)}function r(t){var e;try{e=t.node().getBBox()}catch(r){e={x:0,y:0,width:0,height:0}}return e}t.transform=e,t.getBBox=r}(e=t.DOM||(t.DOM={}))}(e=t.Utils||(t.Utils={}))}(SVGTypewriter||(SVGTypewriter={}));var SVGTypewriter;!function(t){var e;!function(t){var e=function(){function t(t,e){void 0===e&&(e=function(t,e){return t===e}),this.cache=d3.map(),this.compute=t,this.valueEq=e}return t.prototype.get=function(t){return this.cache.has(t)||this.cache.set(t,this.compute(t)),this.cache.get(t)},t.prototype.clear=function(){return this.cache=d3.map(),this},t}();t.Cache=e}(e=t.Utils||(t.Utils={}))}(SVGTypewriter||(SVGTypewriter={}));var SVGTypewriter;!function(t){var e;!function(t){var e=function(){function t(){this.WordDividerRegExp=new RegExp("\\W"),this.WhitespaceRegExp=new RegExp("\\s")}return t.prototype.tokenize=function(t){var e=this;return t.split("").reduce(function(t,r){return t.slice(0,-1).concat(e.shouldCreateNewToken(t[t.length-1],r))},[""])},t.prototype.shouldCreateNewToken=function(t,e){if(!t)return[e];var r=t[t.length-1];return this.WhitespaceRegExp.test(r)&&this.WhitespaceRegExp.test(e)?[t+e]:this.WhitespaceRegExp.test(r)||this.WhitespaceRegExp.test(e)?[t,e]:this.WordDividerRegExp.test(r)||this.WordDividerRegExp.test(e)?r===e?[t+e]:[t,e]:[t+e]},t}();t.Tokenizer=e}(e=t.Utils||(t.Utils={}))}(SVGTypewriter||(SVGTypewriter={}));var SVGTypewriter;!function(t){var e;!function(t){var e;!function(t){function e(t){return t.replace(/\s+/g," ")}function r(t){return t&&""!==t.trim()}function n(t,e){if(!t)return t;var n=t.split(""),i=e?function(t){return t.split(e).some(r)}:r;return n.reduce(function(t,e){return i(t+e)?t+e:t},"")}function i(t,e){if(!t)return t;var r=t.split("");return r.reverse(),r=n(r.join(""),e).split(""),r.reverse(),r.join("")}t.combineWhitespace=e,t.isNotEmptyString=r,t.trimStart=n,t.trimEnd=i}(e=t.StringMethods||(t.StringMethods={}))}(e=t.Utils||(t.Utils={}))}(SVGTypewriter||(SVGTypewriter={}));var SVGTypewriter;!function(t){var e;!function(t){var e=function(){function t(){this.duration(t.DEFAULT_DURATION_MILLISECONDS),this.delay(0),this.easing(t.DEFAULT_EASING),this.moveX(0),this.moveY(0)}return t.prototype.animate=function(t){var e=d3.transform("");return e.translate=[this.moveX(),this.moveY()],t.attr("transform",e.toString()),e.translate=[0,0],this._animate(t,{transform:e.toString()})},t.prototype._animate=function(t,e){return t.transition().ease(this.easing()).duration(this.duration()).delay(this.delay()).attr(e)},t.prototype.duration=function(t){return null==t?this._duration:(this._duration=t,this)},t.prototype.moveX=function(t){return null==t?this._moveX:(this._moveX=t,this)},t.prototype.moveY=function(t){return null==t?this._moveY:(this._moveY=t,this)},t.prototype.delay=function(t){return null==t?this._delay:(this._delay=t,this)},t.prototype.easing=function(t){return null==t?this._easing:(this._easing=t,this)},t.DEFAULT_DURATION_MILLISECONDS=300,t.DEFAULT_EASING="exp-out",t}();t.BaseAnimator=e}(e=t.Animators||(t.Animators={}))}(SVGTypewriter||(SVGTypewriter={}));var __extends=this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},SVGTypewriter;!function(t){var e;!function(e){var r=function(e){function r(){this.direction("bottom"),e.call(this)}return __extends(r,e),r.prototype.direction=function(t){if(null==t)return this._direction;if(r.SupportedDirections.indexOf(t)===-1)throw new Error("unsupported direction - "+t);return this._direction=t,this},r.prototype.animate=function(r){var n=t.Utils.DOM.getBBox(r),i=r.select(".clip-rect");switch(i.attr("width",0),i.attr("height",0),this._direction){case"top":i.attr("y",n.y+n.height),i.attr("x",n.x),i.attr("width",n.width);break;case"bottom":i.attr("y",n.y),i.attr("x",n.x),i.attr("width",n.width);break;case"left":i.attr("y",n.y),i.attr("x",n.x),i.attr("height",n.height);break;case"right":i.attr("y",n.y),i.attr("x",n.x+n.width),i.attr("height",n.height)}return this._animate(i,n),e.prototype.animate.call(this,r)},r.SupportedDirections=["top","bottom","left","right"],r}(e.BaseAnimator);e.UnveilAnimator=r}(e=t.Animators||(t.Animators={}))}(SVGTypewriter||(SVGTypewriter={}));var __extends=this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},SVGTypewriter;!function(t){var e;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.animate=function(e){var r=e.select(".text-area");r.attr("opacity",0);var n={opacity:1};return this._animate(r,n),t.prototype.animate.call(this,e)},e}(t.BaseAnimator);t.OpacityAnimator=e}(e=t.Animators||(t.Animators={}))}(SVGTypewriter||(SVGTypewriter={}));var SVGTypewriter;!function(t){var e;!function(e){var r=function(){function e(){this.maxLines(1/0),this.textTrimming("ellipsis"),this.allowBreakingWords(!0),this._tokenizer=new t.Utils.Tokenizer,this._breakingCharacter="-"}return e.prototype.maxLines=function(t){return null==t?this._maxLines:(this._maxLines=t,this)},e.prototype.textTrimming=function(t){if(null==t)return this._textTrimming;if("ellipsis"!==t&&"none"!==t)throw new Error(t+" - unsupported text trimming option.");return this._textTrimming=t,this},e.prototype.allowBreakingWords=function(t){return null==t?this._allowBreakingWords:(this._allowBreakingWords=t,this)},e.prototype.wrap=function(t,e,r,n){var i=this;void 0===n&&(n=1/0);var a={originalText:t,wrappedText:"",noLines:0,noBrokeWords:0,truncatedText:""},o={wrapping:a,currentLine:"",availableWidth:r,availableLines:Math.min(Math.floor(n/e.measure().height),this._maxLines),canFitText:!0},s=t.split("\n");return s.reduce(function(t,r,n){return i.breakLineToFitWidth(t,r,n!==s.length-1,e)},o).wrapping},e.prototype.breakLineToFitWidth=function(e,r,n,i){var a=this;e.canFitText||""===e.wrapping.truncatedText||(e.wrapping.truncatedText+="\n");var o=this._tokenizer.tokenize(r);e=o.reduce(function(t,e){return a.wrapNextToken(e,t,i)},e);var s=t.Utils.StringMethods.trimEnd(e.currentLine);if(e.wrapping.noLines+=+(""!==s),e.wrapping.noLines===e.availableLines&&"none"!==this._textTrimming&&n){var p=this.addEllipsis(s,e.availableWidth,i);e.wrapping.wrappedText+=p.wrappedToken,e.wrapping.truncatedText+=p.remainingToken,e.canFitText=!1}else e.wrapping.wrappedText+=s;return e.currentLine="\n",e},e.prototype.canFitToken=function(t,e,r){var n=this,i=this._allowBreakingWords?t.split("").map(function(e,r){return r!==t.length-1?e+n._breakingCharacter:e}):[t];return r.measure(t).width<=e||i.every(function(t){return r.measure(t).width<=e})},e.prototype.addEllipsis=function(e,r,n){if("none"===this._textTrimming)return{wrappedToken:e,remainingToken:""};var i=e.substring(0).trim(),a=n.measure(i).width,o=n.measure("...").width,s=e.length>0&&"\n"===e[0]?"\n":"";if(r<=o){var p=o/3,u=Math.floor(r/p);return{wrappedToken:s+"...".substr(0,u),remainingToken:e}}for(;a+o>r;)i=t.Utils.StringMethods.trimEnd(i.substr(0,i.length-1)),a=n.measure(i).width;return{wrappedToken:s+i+"...",remainingToken:t.Utils.StringMethods.trimEnd(e.substring(i.length),"-").trim()}},e.prototype.wrapNextToken=function(e,r,n){if(!r.canFitText||r.availableLines===r.wrapping.noLines||!this.canFitToken(e,r.availableWidth,n))return this.finishWrapping(e,r,n);for(var i=e;i;){var a=this.breakTokenToFitInWidth(i,r.currentLine,r.availableWidth,n);if(r.currentLine=a.line,i=a.remainingToken,null!=i){if(r.wrapping.noBrokeWords+=+a.breakWord,++r.wrapping.noLines,r.availableLines===r.wrapping.noLines){var o=this.addEllipsis(r.currentLine,r.availableWidth,n);return r.wrapping.wrappedText+=o.wrappedToken,r.wrapping.truncatedText+=o.remainingToken+i,r.currentLine="\n",r}r.wrapping.wrappedText+=t.Utils.StringMethods.trimEnd(r.currentLine),r.currentLine="\n"}}return r},e.prototype.finishWrapping=function(t,e,r){if(e.canFitText&&e.availableLines!==e.wrapping.noLines&&this._allowBreakingWords&&"none"!==this._textTrimming){var n=this.addEllipsis(e.currentLine+t,e.availableWidth,r);e.wrapping.wrappedText+=n.wrappedToken,e.wrapping.truncatedText+=n.remainingToken,e.wrapping.noBrokeWords+=+(n.remainingToken.length<t.length),e.wrapping.noLines+=+(n.wrappedToken.length>0),e.currentLine=""}else e.wrapping.truncatedText+=t;return e.canFitText=!1,e},e.prototype.breakTokenToFitInWidth=function(t,e,r,n,i){if(void 0===i&&(i=this._breakingCharacter),n.measure(e+t).width<=r)return{remainingToken:null,line:e+t,breakWord:!1};if(""===t.trim())return{remainingToken:"",line:e,breakWord:!1};if(!this._allowBreakingWords)return{remainingToken:t,line:e,breakWord:!1};for(var a=0;a<t.length&&n.measure(e+t.substring(0,a+1)+i).width<=r;)++a;var o="";return a>0&&(o=i),{remainingToken:t.substring(a),line:e+t.substring(0,a)+o,breakWord:a>0}},e}();e.Wrapper=r}(e=t.Wrappers||(t.Wrappers={}))}(SVGTypewriter||(SVGTypewriter={}));var __extends=this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},SVGTypewriter;!function(t){var e;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.wrap=function(r,n,i,a){var o=this;void 0===a&&(a=1/0);var s=r.split("\n");if(s.length>1)throw new Error("SingleLineWrapper is designed to work only on single line");var p=function(e){return t.prototype.wrap.call(o,r,n,e,a)},u=p(i);if(u.noLines<2)return u;for(var h=0,c=i,l=0;l<e.NO_WRAP_ITERATIONS&&c>h;++l){var d=(c+h)/2,f=p(d);this.areSameResults(u,f)?(c=d,u=f):h=d}return u},e.prototype.areSameResults=function(t,e){return t.noLines===e.noLines&&t.truncatedText===e.truncatedText},e.NO_WRAP_ITERATIONS=5,e}(t.Wrapper);t.SingleLineWrapper=e}(e=t.Wrappers||(t.Wrappers={}))}(SVGTypewriter||(SVGTypewriter={}));var SVGTypewriter;!function(t){var e;!function(e){var r=function(){function e(t,r){this._writerID=e.nextID++,this._elementID=0,this.measurer(t),r&&this.wrapper(r),this.addTitleElement(!1)}return e.prototype.measurer=function(t){return this._measurer=t,this},e.prototype.wrapper=function(t){return this._wrapper=t,this},e.prototype.addTitleElement=function(t){return this._addTitleElement=t,this},e.prototype.writeLine=function(r,n,i,a,o){var s=n.append("text");s.text(r);var p=i*e.XOffsetFactor[a],u=e.AnchorConverter[a];s.attr("text-anchor",u).classed("text-line",!0),t.Utils.DOM.transform(s,p,o).attr("y","-0.25em")},e.prototype.writeText=function(t,r,n,i,a,o){var s=this,p=t.split("\n"),u=this._measurer.measure().height,h=e.YOffsetFactor[o]*(i-p.length*u);p.forEach(function(t,e){s.writeLine(t,r,n,a,(e+1)*u+h)})},e.prototype.write=function(t,r,n,i){if(e.SupportedRotation.indexOf(i.textRotation)===-1)throw new Error("unsupported rotation - "+i.textRotation);var a=Math.abs(Math.abs(i.textRotation)-90)>45,o=a?r:n,s=a?n:r,p=i.selection.append("g").classed("text-container",!0);this._addTitleElement&&p.append("title").text(t);var u=p.append("g").classed("text-area",!0),h=this._wrapper?this._wrapper.wrap(t,this._measurer,o,s).wrappedText:t;this.writeText(h,u,o,s,i.xAlign,i.yAlign);var c=d3.transform(""),l=d3.transform("");switch(c.rotate=i.textRotation,i.textRotation){case 90:c.translate=[r,0],l.rotate=-90,l.translate=[0,200];break;case-90:c.translate=[0,n],l.rotate=90,l.translate=[r,0];break;case 180:c.translate=[r,n],l.translate=[r,n],l.rotate=180}u.attr("transform",c.toString()),this.addClipPath(p,l),i.animator&&i.animator.animate(p)},e.prototype.addClipPath=function(e,r){var n=this._elementID++,i=/MSIE [5-9]/.test(navigator.userAgent)?"":document.location.href;i=i.split("#")[0];var a="clipPath"+this._writerID+"_"+n;e.select(".text-area").attr("clip-path",'url("'+i+"#"+a+'")');var o=e.append("clipPath").attr("id",a),s=t.Utils.DOM.getBBox(e.select(".text-area")),p=o.append("rect");p.classed("clip-rect",!0).attr({x:s.x,y:s.y,width:s.width,height:s.height})},e.nextID=0,e.SupportedRotation=[-90,0,180,90],e.AnchorConverter={left:"start",center:"middle",right:"end"},e.XOffsetFactor={left:0,center:.5,right:1},e.YOffsetFactor={top:0,center:.5,bottom:1},e}();e.Writer=r}(e=t.Writers||(t.Writers={}))}(SVGTypewriter||(SVGTypewriter={}));var SVGTypewriter;!function(t){var e;!function(e){var r=function(){function e(t,e){this.textMeasurer=this.getTextMeasurer(t,e)}return e.prototype.checkSelectionIsText=function(t){return"text"===t[0][0].tagName||!t.select("text").empty()},e.prototype.getTextMeasurer=function(t,e){var r=this;if(this.checkSelectionIsText(t)){var n,i=t.node().parentNode;return n="text"===t[0][0].tagName?t:t.select("text"),t.remove(),function(e){i.appendChild(t.node());var a=r.measureBBox(n,e);return t.remove(),a}}var a=t.append("text");return e&&a.classed(e,!0),a.remove(),function(e){t.node().appendChild(a.node());var n=r.measureBBox(a,e);return a.remove(),n}},e.prototype.measureBBox=function(e,r){e.text(r);var n=t.Utils.DOM.getBBox(e);return{width:n.width,height:n.height}},e.prototype.measure=function(t){return void 0===t&&(t=e.HEIGHT_TEXT),this.textMeasurer(t)},e.HEIGHT_TEXT="bqpdl",e}();e.AbstractMeasurer=r}(e=t.Measurers||(t.Measurers={}))}(SVGTypewriter||(SVGTypewriter={}));var __extends=this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},SVGTypewriter;!function(t){var e;!function(t){var e=function(e){function r(t,r,n){void 0===r&&(r=null),void 0===n&&(n=!1),e.call(this,t,r),this.useGuards=n}return __extends(r,e),r.prototype._addGuards=function(e){return t.AbstractMeasurer.HEIGHT_TEXT+e+t.AbstractMeasurer.HEIGHT_TEXT},r.prototype.getGuardWidth=function(){return null==this.guardWidth&&(this.guardWidth=e.prototype.measure.call(this).width),this.guardWidth},r.prototype._measureLine=function(t){var r=this.useGuards?this._addGuards(t):t,n=e.prototype.measure.call(this,r);return n.width-=this.useGuards?2*this.getGuardWidth():0,n},r.prototype.measure=function(e){var r=this;if(void 0===e&&(e=t.AbstractMeasurer.HEIGHT_TEXT),""===e.trim())return{width:0,height:0};var n=e.trim().split("\n").map(function(t){return r._measureLine(t)});return{width:d3.max(n,function(t){return t.width}),height:d3.sum(n,function(t){return t.height})}},r}(t.AbstractMeasurer);t.Measurer=e}(e=t.Measurers||(t.Measurers={}))}(SVGTypewriter||(SVGTypewriter={}));var __extends=this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},SVGTypewriter;!function(t){var e;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype._measureCharacter=function(e){return t.prototype._measureLine.call(this,e)},e.prototype._measureLine=function(t){var e=this,r=t.split("").map(function(t){return e._measureCharacter(t)});return{width:d3.sum(r,function(t){return t.width}),height:d3.max(r,function(t){return t.height})}},e}(t.Measurer);t.CharacterMeasurer=e}(e=t.Measurers||(t.Measurers={}))}(SVGTypewriter||(SVGTypewriter={}));var __extends=this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},SVGTypewriter;!function(t){var e;!function(e){var r=function(e){function r(r,n){var i=this;e.call(this,r,n),this.cache=new t.Utils.Cache(function(t){return i._measureCharacterNotFromCache(t)},t.Utils.Methods.objEq)}return __extends(r,e),r.prototype._measureCharacterNotFromCache=function(t){return e.prototype._measureCharacter.call(this,t)},r.prototype._measureCharacter=function(t){return this.cache.get(t)},r.prototype.reset=function(){this.cache.clear()},r}(e.CharacterMeasurer);e.CacheCharacterMeasurer=r}(e=t.Measurers||(t.Measurers={}))}(SVGTypewriter||(SVGTypewriter={}));