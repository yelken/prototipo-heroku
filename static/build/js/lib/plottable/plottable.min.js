!function(t,e){if("object"==typeof exports)module.exports=e(require,exports,module);else if("function"==typeof define&&define.amd)define(["require","exports","module"],e);else{var i=function(e){return t[e]},n=t,r={exports:n};t.Plottable=e(i,n,r)}}(this,function(t,e,i){var n;!function(t){var e;!function(e){var i;!function(e){function i(t,e,i){return u.min(e,i)<=t&&t<=u.max(e,i)}function n(t,e,i){return u.min(u.max(e,t),i)}function r(t,e,i){var n="function"==typeof e?e:null,r=null==n?e:i,o=null==n?d3.max(t):d3.max(t,n);return void 0!==o?o:r}function o(t,e,i){var n="function"==typeof e?e:null,r=null==n?e:i,o=null==n?d3.min(t):d3.min(t,n);return void 0!==o?o:r}function a(t){return t!==t}function s(e){return"number"==typeof e&&!t.Utils.Math.isNaN(e)&&isFinite(e)}function l(t,e,i){if(void 0===i&&(i=1),0===i)throw new Error("step cannot be 0");for(var n=u.max(u.ceil((e-t)/i),0),r=[],o=0;n>o;++o)r[o]=t+i*o;return r}function c(t,e){return u.pow(e.y-t.y,2)+u.pow(e.x-t.x,2)}function h(t){return t/360*u.PI*2}var u=window.Math;e.inRange=i,e.clamp=n,e.max=r,e.min=o,e.isNaN=a,e.isValidNumber=s,e.range=l,e.distanceSquared=c,e.degreesToRadians=h}(i=e.Math||(e.Math={}))}(e=t.Utils||(t.Utils={}))}(n||(n={}));var n;!function(t){var e;!function(t){var e=function(){function e(){"function"==typeof window.Map?this._es6Map=new window.Map:this._keyValuePairs=[]}return e.prototype.set=function(e,i){if(t.Math.isNaN(e))throw new Error("NaN may not be used as a key to the Map");if(null!=this._es6Map)return this._es6Map.set(e,i),this;for(var n=0;n<this._keyValuePairs.length;n++)if(this._keyValuePairs[n].key===e)return this._keyValuePairs[n].value=i,this;return this._keyValuePairs.push({key:e,value:i}),this},e.prototype.get=function(t){if(null!=this._es6Map)return this._es6Map.get(t);for(var e=0;e<this._keyValuePairs.length;e++)if(this._keyValuePairs[e].key===t)return this._keyValuePairs[e].value},e.prototype.has=function(t){if(null!=this._es6Map)return this._es6Map.has(t);for(var e=0;e<this._keyValuePairs.length;e++)if(this._keyValuePairs[e].key===t)return!0;return!1},e.prototype.forEach=function(t,e){var i=this;if(null!=this._es6Map){var n=function(n,r){return t.call(e,n,r,i)};return void this._es6Map.forEach(n,e)}this._keyValuePairs.forEach(function(n){t.call(e,n.value,n.key,i)})},e.prototype["delete"]=function(t){if(null!=this._es6Map)return this._es6Map["delete"](t);for(var e=0;e<this._keyValuePairs.length;e++)if(this._keyValuePairs[e].key===t)return this._keyValuePairs.splice(e,1),!0;return!1},e}();t.Map=e}(e=t.Utils||(t.Utils={}))}(n||(n={}));var n;!function(t){var e;!function(t){var e=function(){function t(){"function"==typeof window.Set?this._es6Set=new window.Set:this._values=[],this.size=0}return t.prototype.add=function(t){return null!=this._es6Set?(this._es6Set.add(t),this.size=this._es6Set.size,this):(this.has(t)||(this._values.push(t),this.size=this._values.length),this)},t.prototype["delete"]=function(t){if(null!=this._es6Set){var e=this._es6Set["delete"](t);return this.size=this._es6Set.size,e}var i=this._values.indexOf(t);return-1!==i&&(this._values.splice(i,1),this.size=this._values.length,!0)},t.prototype.has=function(t){return null!=this._es6Set?this._es6Set.has(t):-1!==this._values.indexOf(t)},t.prototype.forEach=function(t,e){var i=this;if(null!=this._es6Set){var n=function(n,r){return t.call(e,n,r,i)};return void this._es6Set.forEach(n,e)}this._values.forEach(function(n){t.call(e,n,n,i)})},t}();t.Set=e}(e=t.Utils||(t.Utils={}))}(n||(n={}));var n;!function(t){var e;!function(t){var e;!function(t){function e(t){var e;try{e=t.node().getBBox()}catch(i){e={x:0,y:0,width:0,height:0}}return e}function i(e){null!=window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,t.SCREEN_REFRESH_RATE_MILLISECONDS)}function n(t){var e=window.getComputedStyle(t);return p(e,"width")+p(e,"padding-left")+p(e,"padding-right")+p(e,"border-left-width")+p(e,"border-right-width")}function r(t){var e=window.getComputedStyle(t);return p(e,"height")+p(e,"padding-top")+p(e,"padding-bottom")+p(e,"border-top-width")+p(e,"border-bottom-width")}function o(t,e,i){var n=d3.transform(t.attr("transform"));return null==e?n.translate:(i=null==i?0:i,n.translate[0]=e,n.translate[1]=i,t.attr("transform",n.toString()),t)}function a(t,e){return!(d.floor(t.right)<=d.ceil(e.left))&&(!(d.ceil(t.left)>=d.floor(e.right))&&(!(d.floor(t.bottom)<=d.ceil(e.top))&&!(d.ceil(t.top)>=d.floor(e.bottom))))}function s(t,e){return d.floor(e.left)<=d.ceil(t.left)&&d.floor(e.top)<=d.ceil(t.top)&&d.floor(t.right)<=d.ceil(e.right)&&d.floor(t.bottom)<=d.ceil(e.bottom)}function l(t){var e=t.ownerSVGElement;return null!=e?e:"svg"===t.nodeName.toLowerCase()?t:null}function c(){return"plottableClipPath"+ ++_}function h(t,e,i,n){void 0===n&&(n=.5);var r=u(t),o=u(e);return i.x+i.width>=r.min-n&&i.x<=r.max+n&&i.y+i.height>=o.min-n&&i.y<=o.max+n}function u(t){if("number"==typeof t){var e=t;return{min:e,max:e}}var i=t;if(i instanceof Object&&"min"in i&&"max"in i)return i;throw new Error("input '"+t+"' can't be parsed as an Range")}function p(t,e){var i=t.getPropertyValue(e),n=parseFloat(i);return n||0}var d=window.Math;t.elementBBox=e,t.SCREEN_REFRESH_RATE_MILLISECONDS=1e3/60,t.requestAnimationFramePolyfill=i,t.elementWidth=n,t.elementHeight=r,t.translate=o,t.clientRectsOverlap=a,t.clientRectInside=s,t.boundingSVG=l;var _=0;t.generateUniqueClipPathId=c,t.intersectsBBox=h}(e=t.DOM||(t.DOM={}))}(e=t.Utils||(t.Utils={}))}(n||(n={}));var n;!function(t){var e;!function(t){var e;!function(t){function e(t,e){var i=r(t)+.05,n=r(e)+.05;return i>n?i/n:n/i}function i(t,e){var i=d3.hsl(t).brighter(e);return i.rgb().toString()}function n(t,e){t.classed(e,!0);var i=t.style("background-color");if("transparent"===i)return null;var n=/\((.+)\)/.exec(i)[1].split(",").map(function(t){var e=+t,i=e.toString(16);return 16>e?"0"+i:i});if(4===n.length&&"00"===n[3])return null;var r="#"+n.join("");return t.classed(e,!1),r}function r(t){var e=d3.rgb(t),i=function(t){return t/=255,.03928>=t?t/12.92:o.pow((t+.055)/1.055,2.4)},n=i(e.r),r=i(e.g),a=i(e.b);return.2126*n+.7152*r+.0722*a}var o=window.Math;t.contrast=e,t.lightenColor=i,t.colorTest=n}(e=t.Color||(t.Color={}))}(e=t.Utils||(t.Utils={}))}(n||(n={}));var n;!function(t){var e;!function(t){var e;!function(t){function e(t,e){if(t.length!==e.length)throw new Error("attempted to add arrays of unequal length");return t.map(function(i,n){return t[n]+e[n]})}function i(t){var e=d3.set(),i=[];return t.forEach(function(t){e.has(String(t))||(e.add(String(t)),i.push(t))}),i}function n(t){return o.prototype.concat.apply([],t)}function r(t,e){for(var i=[],n=0;e>n;n++)i[n]="function"==typeof t?t(n):t;return i}var o=window.Array;t.add=e,t.uniq=i,t.flatten=n,t.createFilledArray=r}(e=t.Array||(t.Array={}))}(e=t.Utils||(t.Utils={}))}(n||(n={}));var n,r=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)};!function(t){var e;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return r(e,t),e.prototype.callCallbacks=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i-0]=arguments[i];return this.forEach(function(i){i.apply(t,e)}),this},e}(t.Set);t.CallbackSet=e}(e=t.Utils||(t.Utils={}))}(n||(n={}));var n;!function(t){var e;!function(t){var e;!function(e){function i(e,i,n){var o=d3.map(),a=d3.map(),s=new t.Map;return e.forEach(function(e){var l=new t.Map;e.data().forEach(function(t,s){var c,h=r(i(t,s,e)),u=+n(t,s,e),p=u>=0?o:a;p.has(h)?(c=p.get(h),p.set(h,c+u)):(c=0,p.set(h,u)),l.set(h,{value:u,offset:c})}),s.set(e,l)}),s}function n(e,i,n){var a=[];e.forEach(function(t,e){e.data().forEach(function(o,s){if(null==n||n(o,s,e)){var l=t.get(r(i(o,s,e)));a.push(l.value+l.offset)}})});var s=t.Math.max(a,0),l=t.Math.min(a,0);return[o.min(l,0),o.max(0,s)]}function r(t){return String(t)}var o=window.Math;e.stack=i,e.stackedExtent=n,e.normalizeKey=r}(e=t.Stacking||(t.Stacking={}))}(e=t.Utils||(t.Utils={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i;!function(i){function n(e){t.Configs.SHOW_WARNINGS&&null!=window.console&&(null!=window.console.warn?console.warn(e):null!=window.console.log&&console.log(e))}function r(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];return 0===e?(t(i),-1):window.setTimeout(t,e,i)}function o(t,i,n){void 0===n&&(n=""),e.Window.warn("Method "+t+" has been deprecated in version "+i+". Please refer to the release notes. "+n)}i.warn=n,i.setTimeout=r,i.deprecated=o}(i=e.Window||(e.Window={}))}(e=t.Utils||(t.Utils={}))}(n||(n={}));var n;!function(t){var e;!function(t){var e=function(){function e(t){this._svg=t,this._measureRect=document.createElementNS(t.namespaceURI,"rect"),this._measureRect.setAttribute("class","measure-rect"),this._measureRect.setAttribute("style","opacity: 0; visibility: hidden;"),this._measureRect.setAttribute("width","1"),this._measureRect.setAttribute("height","1"),this._svg.appendChild(this._measureRect)}return e.getTranslator=function(i){var n=t.DOM.boundingSVG(i),r=n[e._TRANSLATOR_KEY];return null==r&&(r=new e(n),n[e._TRANSLATOR_KEY]=r),r},e.prototype.computePosition=function(t,e){this._measureRect.setAttribute("x","0"),this._measureRect.setAttribute("y","0");var i=this._measureRect.getBoundingClientRect(),n={x:i.left,y:i.top},r=100;this._measureRect.setAttribute("x",String(r)),this._measureRect.setAttribute("y",String(r)),i=this._measureRect.getBoundingClientRect();var o={x:i.left,y:i.top};if(n.x===o.x||n.y===o.y)return null;var a=(o.x-n.x)/r,s=(o.y-n.y)/r;this._measureRect.setAttribute("x",String((t-n.x)/a)),this._measureRect.setAttribute("y",String((e-n.y)/s)),i=this._measureRect.getBoundingClientRect();var l={x:i.left,y:i.top},c={x:(l.x-n.x)/a,y:(l.y-n.y)/s};return c},e.prototype.insideSVG=function(e){return t.DOM.boundingSVG(e.target)===this._svg},e._TRANSLATOR_KEY="__Plottable_ClientToSVGTranslator",e}();t.ClientToSVGTranslator=e}(e=t.Utils||(t.Utils={}))}(n||(n={}));var n;!function(t){var e;!function(t){t.SHOW_WARNINGS=!0,t.ADD_TITLE_ELEMENTS=!0}(e=t.Configs||(t.Configs={}))}(n||(n={}));var n;!function(t){t.version="2.0.0"}(n||(n={}));var n;!function(t){var e=function(){function e(e,i){void 0===e&&(e=[]),void 0===i&&(i={}),this._data=e,this._metadata=i,this._callbacks=new t.Utils.CallbackSet}return e.prototype.onUpdate=function(t){return this._callbacks.add(t),this},e.prototype.offUpdate=function(t){return this._callbacks["delete"](t),this},e.prototype.data=function(t){return null==t?this._data:(this._data=t,this._callbacks.callCallbacks(this),this)},e.prototype.metadata=function(t){return null==t?this._metadata:(this._metadata=t,this._callbacks.callCallbacks(this),this)},e}();t.Dataset=e}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(){function e(){}return e.prototype.render=function(){t.RenderController.flush()},e}();e.Immediate=i;var n=function(){function e(){}return e.prototype.render=function(){t.Utils.DOM.requestAnimationFramePolyfill(t.RenderController.flush)},e}();e.AnimationFrame=n;var r=function(){function e(){this._timeoutMsec=t.Utils.DOM.SCREEN_REFRESH_RATE_MILLISECONDS}return e.prototype.render=function(){setTimeout(t.RenderController.flush,this._timeoutMsec)},e}();e.Timeout=r}(e=t.RenderPolicies||(t.RenderPolicies={}))}(n||(n={}));var n;!function(t){var e;!function(e){function i(e){if(null==e)return p;switch(e.toLowerCase()){case s.IMMEDIATE:p=new t.RenderPolicies.Immediate;break;case s.ANIMATION_FRAME:p=new t.RenderPolicies.AnimationFrame;break;case s.TIMEOUT:p=new t.RenderPolicies.Timeout;break;default:t.Utils.Window.warn("Unrecognized renderPolicy: "+e)}}function n(e){u&&t.Utils.Window.warn("Registered to render while other components are flushing: request may be ignored"),l.add(e),o()}function r(t){c.add(t),l.add(t),o()}function o(){h||(h=!0,p.render())}function a(){if(h){c.forEach(function(t){return t.computeLayout()}),l.forEach(function(t){return t.render()}),u=!0;var e=new t.Utils.Set;l.forEach(function(t){try{t.renderImmediately()}catch(i){window.setTimeout(function(){throw i},0),e.add(t)}}),c=new t.Utils.Set,l=e,h=!1,u=!1}}var s,l=new t.Utils.Set,c=new t.Utils.Set,h=!1,u=!1;!function(t){t.IMMEDIATE="immediate",t.ANIMATION_FRAME="animationframe",t.TIMEOUT="timeout"}(s=e.Policy||(e.Policy={}));var p=new t.RenderPolicies.AnimationFrame;e.renderPolicy=i,e.registerToRender=n,e.registerToComputeLayout=r,e.flush=a}(e=t.RenderController||(t.RenderController={}))}(n||(n={}));var n;!function(t){var e;!function(t){function e(e,i,n){void 0===e&&(e=2),void 0===i&&(i="$"),void 0===n&&(n=!0);var r=t.fixed(e);return function(t){var e=r(Math.abs(t));return""!==e&&(n?e=i+e:e+=i,0>t&&(e="-"+e)),e}}function i(t){return void 0===t&&(t=3),h(t),function(e){return e.toFixed(t)}}function n(t){return void 0===t&&(t=3),h(t),function(e){if("number"==typeof e){var i=Math.pow(10,t);return String(Math.round(e*i)/i)}return String(e)}}function r(){return function(t){return String(t)}}function o(e){void 0===e&&(e=0);var i=t.fixed(e);return function(t){var e=100*t,n=t.toString(),r=Math.pow(10,n.length-(n.indexOf(".")+1));return e=parseInt((e*r).toString(),10)/r,i(e)+"%"}}function a(t){return void 0===t&&(t=3),h(t),function(e){return d3.format("."+t+"s")(e)}}function s(t){void 0===t&&(t=3),h(t);var e="KMBTQ",i=d3.format("."+t+"e"),n=d3.format("."+t+"f"),r=Math.pow(10,3*(e.length+1)),o=Math.pow(10,-t);return function(t){var a=Math.abs(t);if((o>a||a>=r)&&0!==a)return i(t);for(var s=-1;a>=Math.pow(1e3,s+2)&&s<e.length-1;)s++;var l="";return l=-1===s?n(t):n(t/Math.pow(1e3,s+1))+e[s],(t>0&&"1000"===l.substr(0,4)||0>t&&"-1000"===l.substr(0,5))&&(s<e.length-1?(s++,l=n(t/Math.pow(1e3,s+1))+e[s]):l=i(t)),l}}function l(){var t=8,e={};return e[0]={format:".%L",filter:function(t){return 0!==t.getMilliseconds()}},e[1]={format:":%S",filter:function(t){return 0!==t.getSeconds()}},e[2]={format:"%I:%M",filter:function(t){return 0!==t.getMinutes()}},e[3]={format:"%I %p",filter:function(t){return 0!==t.getHours()}},e[4]={format:"%a %d",filter:function(t){return 0!==t.getDay()&&1!==t.getDate()}},e[5]={format:"%b %d",filter:function(t){return 1!==t.getDate()}},e[6]={format:"%b",filter:function(t){return 0!==t.getMonth()}},e[7]={format:"%Y",filter:function(){return!0}},function(i){for(var n=0;t>n;n++)if(e[n].filter(i))return d3.time.format(e[n].format)(i)}}function c(t){return d3.time.format(t)}function h(t){if(0>t||t>20)throw new RangeError("Formatter precision must be between 0 and 20");if(t!==Math.floor(t))throw new RangeError("Formatter precision must be an integer")}t.currency=e,t.fixed=i,t.general=n,t.identity=r,t.percentage=o,t.siSuffix=a,t.shortScale=s,t.multiTime=l,t.time=c}(e=t.Formatters||(t.Formatters={}))}(n||(n={}));var n;!function(t){var e;!function(t){function e(){return function(t){return d3.svg.symbol().type("circle").size(Math.PI*Math.pow(t/2,2))(null)}}function i(){return function(t){return d3.svg.symbol().type("square").size(Math.pow(t,2))(null)}}function n(){return function(t){return d3.svg.symbol().type("cross").size(5/9*Math.pow(t,2))(null)}}function r(){return function(t){return d3.svg.symbol().type("diamond").size(Math.tan(Math.PI/6)*Math.pow(t,2)/2)(null)}}function o(){return function(t){return d3.svg.symbol().type("triangle-up").size(Math.sqrt(3)*Math.pow(t/2,2))(null)}}function a(){return function(t){return d3.svg.symbol().type("triangle-down").size(Math.sqrt(3)*Math.pow(t/2,2))(null)}}t.circle=e,t.square=i,t.cross=n,t.diamond=r,t.triangleUp=o,t.triangleDown=a}(e=t.SymbolFactories||(t.SymbolFactories={}))}(n||(n={}));var n;!function(t){var e=function(){function e(){this._autoDomainAutomatically=!0,this._domainModificationInProgress=!1,this._callbacks=new t.Utils.CallbackSet,this._includedValuesProviders=new t.Utils.Set}return e.prototype.extentOfValues=function(t){return[]},e.prototype._getAllIncludedValues=function(){var t=this,e=[];return this._includedValuesProviders.forEach(function(i){var n=i(t);e=e.concat(n)}),e},e.prototype._getExtent=function(){return[]},e.prototype.onUpdate=function(t){return this._callbacks.add(t),this},e.prototype.offUpdate=function(t){return this._callbacks["delete"](t),this},e.prototype._dispatchUpdate=function(){this._callbacks.callCallbacks(this)},e.prototype.autoDomain=function(){return this._autoDomainAutomatically=!0,this._setDomain(this._getExtent()),this},e.prototype._autoDomainIfAutomaticMode=function(){this._autoDomainAutomatically&&this.autoDomain()},e.prototype.scale=function(t){throw new Error("Subclasses should override scale")},e.prototype.domain=function(t){return null==t?this._getDomain():(this._autoDomainAutomatically=!1,this._setDomain(t),this)},e.prototype._getDomain=function(){throw new Error("Subclasses should override _getDomain")},e.prototype._setDomain=function(t){this._domainModificationInProgress||(this._domainModificationInProgress=!0,this._setBackingScaleDomain(t),this._dispatchUpdate(),this._domainModificationInProgress=!1)},e.prototype._setBackingScaleDomain=function(t){throw new Error("Subclasses should override _setBackingDomain")},e.prototype.range=function(t){return null==t?this._getRange():(this._setRange(t),this)},e.prototype._getRange=function(){throw new Error("Subclasses should override _getRange")},e.prototype._setRange=function(t){throw new Error("Subclasses should override _setRange")},e.prototype.addIncludedValuesProvider=function(t){return this._includedValuesProviders.add(t),this._autoDomainIfAutomaticMode(),this},e.prototype.removeIncludedValuesProvider=function(t){return this._includedValuesProviders["delete"](t),this._autoDomainIfAutomaticMode(),this},e}();t.Scale=e}(n||(n={}));var n;!function(t){var e=function(e){function i(){e.call(this),this._tickGenerator=function(t){return t.defaultTicks()},this._padProportion=.05,this._snappingDomainEnabled=!0,this._paddingExceptionsProviders=new t.Utils.Set}return r(i,e),i.prototype.autoDomain=function(){return this._domainMin=null,this._domainMax=null,e.prototype.autoDomain.call(this),this},i.prototype._autoDomainIfAutomaticMode=function(){if(null!=this._domainMin&&null!=this._domainMax)return void this._setDomain([this._domainMin,this._domainMax]);var t=this._getExtent();if(null!=this._domainMin){var i=t[1];return this._domainMin>=i&&(i=this._expandSingleValueDomain([this._domainMin,this._domainMin])[1]),void this._setDomain([this._domainMin,i])}if(null!=this._domainMax){var n=t[0];return this._domainMax<=n&&(n=this._expandSingleValueDomain([this._domainMax,this._domainMax])[0]),void this._setDomain([n,this._domainMax])}e.prototype._autoDomainIfAutomaticMode.call(this)},i.prototype._getExtent=function(){var e=this._getAllIncludedValues(),i=this._defaultExtent();if(0!==e.length){var n=[t.Utils.Math.min(e,i[0]),t.Utils.Math.max(e,i[1])];i=this._padDomain(n)}return null!=this._domainMin&&(i[0]=this._domainMin),null!=this._domainMax&&(i[1]=this._domainMax),i},i.prototype.addPaddingExceptionsProvider=function(t){return this._paddingExceptionsProviders.add(t),this._autoDomainIfAutomaticMode(),this},i.prototype.removePaddingExceptionsProvider=function(t){return this._paddingExceptionsProviders["delete"](t),this._autoDomainIfAutomaticMode(),this},i.prototype.padProportion=function(t){if(null==t)return this._padProportion;if(0>t)throw new Error("padProportion must be non-negative");return this._padProportion=t,this._autoDomainIfAutomaticMode(),this},i.prototype._padDomain=function(t){var e=this;if(t[0].valueOf()===t[1].valueOf())return this._expandSingleValueDomain(t);if(0===this._padProportion)return t;var i=this._padProportion/2,n=t[0],r=t[1],o=!1,a=!1;this._paddingExceptionsProviders.forEach(function(t){var i=t(e);i.forEach(function(t){t.valueOf()===n.valueOf()&&(o=!0),t.valueOf()===r.valueOf()&&(a=!0)})});var s=this._getDomain();this._setBackingScaleDomain(t);var l=o?n:this.invert(this.scale(n)-(this.scale(r)-this.scale(n))*i),c=a?r:this.invert(this.scale(r)+(this.scale(r)-this.scale(n))*i);return this._setBackingScaleDomain(s),this._snappingDomainEnabled?this._niceDomain([l,c]):[l,c]},i.prototype.snappingDomainEnabled=function(t){return null==t?this._snappingDomainEnabled:(this._snappingDomainEnabled=t,this._autoDomainIfAutomaticMode(),this)},i.prototype._expandSingleValueDomain=function(t){return t},i.prototype.invert=function(t){throw new Error("Subclasses should override invert")},i.prototype.domain=function(t){return null!=t&&(this._domainMin=t[0],this._domainMax=t[1]),e.prototype.domain.call(this,t)},i.prototype.domainMin=function(t){return null==t?this.domain()[0]:(this._domainMin=t,this._autoDomainIfAutomaticMode(),this)},i.prototype.domainMax=function(t){return null==t?this.domain()[1]:(this._domainMax=t,this._autoDomainIfAutomaticMode(),this)},i.prototype.extentOfValues=function(e){var i=d3.extent(e.filter(function(e){return t.Utils.Math.isValidNumber(+e)}));return null==i[0]||null==i[1]?[]:i},i.prototype._setDomain=function(i){var n=function(e){return t.Utils.Math.isNaN(e)||e===1/0||e===-(1/0)};return n(i[0])||n(i[1])?void t.Utils.Window.warn("Warning: QuantitativeScales cannot take NaN or Infinity as a domain value. Ignoring."):void e.prototype._setDomain.call(this,i)},i.prototype.defaultTicks=function(){throw new Error("Subclasses should override _getDefaultTicks")},i.prototype.ticks=function(){return this._tickGenerator(this)},i.prototype._niceDomain=function(t,e){throw new Error("Subclasses should override _niceDomain")},i.prototype._defaultExtent=function(){throw new Error("Subclasses should override _defaultExtent")},i.prototype.tickGenerator=function(t){return null==t?this._tickGenerator:(this._tickGenerator=t,this)},i._DEFAULT_NUM_TICKS=10,i}(t.Scale);t.QuantitativeScale=e}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(t){function i(){t.call(this),this._d3Scale=d3.scale.linear()}return r(i,t),i.prototype._defaultExtent=function(){return[0,1]},i.prototype._expandSingleValueDomain=function(t){return t[0]===t[1]?[t[0]-1,t[1]+1]:t},i.prototype.scale=function(t){return this._d3Scale(t)},i.prototype._getDomain=function(){return this._d3Scale.domain()},i.prototype._setBackingScaleDomain=function(t){this._d3Scale.domain(t)},i.prototype._getRange=function(){return this._d3Scale.range()},i.prototype._setRange=function(t){this._d3Scale.range(t)},i.prototype.invert=function(t){return this._d3Scale.invert(t)},i.prototype.defaultTicks=function(){return this._d3Scale.ticks(e.Linear._DEFAULT_NUM_TICKS)},i.prototype._niceDomain=function(t,e){return this._d3Scale.copy().domain(t).nice(e).domain()},i}(t.QuantitativeScale);e.Linear=i}(e=t.Scales||(t.Scales={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(i){function n(t){if(void 0===t&&(t=10),i.call(this),this._d3Scale=d3.scale.linear(),this._base=t,this._pivot=this._base,this._setDomain(this._defaultExtent()),1>=t)throw new Error("ModifiedLogScale: The base must be > 1")}return r(n,i),n.prototype._adjustedLog=function(t){var e=0>t?-1:1;return t*=e,t<this._pivot&&(t+=(this._pivot-t)/this._pivot),t=Math.log(t)/Math.log(this._base),t*=e},n.prototype._invertedAdjustedLog=function(t){var e=0>t?-1:1;return t*=e,t=Math.pow(this._base,t),t<this._pivot&&(t=this._pivot*(t-1)/(this._pivot-1)),t*=e},n.prototype.scale=function(t){return this._d3Scale(this._adjustedLog(t))},n.prototype.invert=function(t){return this._invertedAdjustedLog(this._d3Scale.invert(t))},n.prototype._getDomain=function(){return this._untransformedDomain},n.prototype._setDomain=function(t){this._untransformedDomain=t;var e=[this._adjustedLog(t[0]),this._adjustedLog(t[1])];i.prototype._setDomain.call(this,e)},n.prototype._setBackingScaleDomain=function(t){this._d3Scale.domain(t)},n.prototype.ticks=function(){var i=function(t,e,i){return[t,e,i].sort(function(t,e){return t-e})[1]},n=t.Utils.Math.min(this._untransformedDomain,0),r=t.Utils.Math.max(this._untransformedDomain,0),o=n,a=i(n,r,-this._pivot),s=i(n,r,this._pivot),l=r,c=this._logTicks(-a,-o).map(function(t){return-t}).reverse(),h=this._logTicks(s,l),u=Math.max(n,-this._pivot),p=Math.min(r,this._pivot),d=d3.scale.linear().domain([u,p]).ticks(this._howManyTicks(u,p)),_=c.concat(d).concat(h);return _.length<=1&&(_=d3.scale.linear().domain([n,r]).ticks(e.ModifiedLog._DEFAULT_NUM_TICKS)),_},n.prototype._logTicks=function(e,i){var n=this,r=this._howManyTicks(e,i);if(0===r)return[];var o=Math.floor(Math.log(e)/Math.log(this._base)),a=Math.ceil(Math.log(i)/Math.log(this._base)),s=d3.range(a,o,-Math.ceil((a-o)/r)),l=d3.range(this._base,1,-(this._base-1)).map(Math.floor),c=t.Utils.Array.uniq(l),h=s.map(function(t){return c.map(function(e){return Math.pow(n._base,t-1)*e})}),u=t.Utils.Array.flatten(h),p=u.filter(function(t){return t>=e&&i>=t}),d=p.sort(function(t,e){return t-e});return d},n.prototype._howManyTicks=function(i,n){var r=this._adjustedLog(t.Utils.Math.min(this._untransformedDomain,0)),o=this._adjustedLog(t.Utils.Math.max(this._untransformedDomain,0)),a=this._adjustedLog(i),s=this._adjustedLog(n),l=(s-a)/(o-r),c=Math.ceil(l*e.ModifiedLog._DEFAULT_NUM_TICKS);return c},n.prototype._niceDomain=function(t,e){return t},n.prototype._defaultExtent=function(){return[0,this._base]},n.prototype._expandSingleValueDomain=function(t){if(t[0]===t[1]){var e=t[0];return e>0?[e/this._base,e*this._base]:0===e?[-this._base,this._base]:[e*this._base,e/this._base]}return t},n.prototype._getRange=function(){return this._d3Scale.range()},n.prototype._setRange=function(t){this._d3Scale.range(t)},n.prototype.defaultTicks=function(){return this._d3Scale.ticks(e.ModifiedLog._DEFAULT_NUM_TICKS)},n}(t.QuantitativeScale);e.ModifiedLog=i}(e=t.Scales||(t.Scales={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this._range=[0,1],this._d3Scale=d3.scale.ordinal();var t=.3;this._innerPadding=i._convertToPlottableInnerPadding(t),this._outerPadding=i._convertToPlottableOuterPadding(.5,t)}return r(i,e),i.prototype.extentOfValues=function(e){return t.Utils.Array.uniq(e)},i.prototype._getExtent=function(){return t.Utils.Array.uniq(this._getAllIncludedValues())},i.prototype.domain=function(t){return e.prototype.domain.call(this,t)},i.prototype._setDomain=function(t){e.prototype._setDomain.call(this,t),this.range(this.range())},i.prototype.range=function(t){if(null==t)return this._range;this._range=t;var e=1-1/(1+this.innerPadding()),i=this.outerPadding()/(1+this.innerPadding());return this._d3Scale.rangeBands(t,e,i),this},i._convertToPlottableInnerPadding=function(t){return 1/(1-t)-1},i._convertToPlottableOuterPadding=function(t,e){return t/(1-e)},i.prototype.rangeBand=function(){return this._d3Scale.rangeBand()},i.prototype.stepWidth=function(){return this.rangeBand()*(1+this.innerPadding())},i.prototype.innerPadding=function(t){return null==t?this._innerPadding:(this._innerPadding=t,this.range(this.range()),this._dispatchUpdate(),this)},i.prototype.outerPadding=function(t){return null==t?this._outerPadding:(this._outerPadding=t,this.range(this.range()),this._dispatchUpdate(),this)},i.prototype.scale=function(t){return this._d3Scale(t)+this.rangeBand()/2},i.prototype._getDomain=function(){return this._d3Scale.domain()},i.prototype._setBackingScaleDomain=function(t){this._d3Scale.domain(t)},i.prototype._getRange=function(){return this._d3Scale.range()},i.prototype._setRange=function(t){this._d3Scale.range(t)},i}(t.Scale);e.Category=i}(e=t.Scales||(t.Scales={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(t){e.call(this);var n;switch(t){case null:case void 0:null==i._plottableColorCache&&(i._plottableColorCache=i._getPlottableColors()),n=d3.scale.ordinal().range(i._plottableColorCache);break;case"Category10":case"category10":case"10":n=d3.scale.category10();break;case"Category20":case"category20":case"20":n=d3.scale.category20();break;case"Category20b":case"category20b":case"20b":n=d3.scale.category20b();break;case"Category20c":case"category20c":case"20c":n=d3.scale.category20c();break;default:throw new Error("Unsupported ColorScale type")}this._d3Scale=n}return r(i,e),i.prototype.extentOfValues=function(e){return t.Utils.Array.uniq(e)},i.prototype._getExtent=function(){return t.Utils.Array.uniq(this._getAllIncludedValues())},i.invalidateColorCache=function(){i._plottableColorCache=null},i._getPlottableColors=function(){for(var e,i=[],n=d3.select("body").append("plottable-color-tester"),r=t.Utils.Color.colorTest(n,""),o=0;null!==(e=t.Utils.Color.colorTest(n,"plottable-colors-"+o))&&o<this._MAXIMUM_COLORS_FROM_CSS&&(e!==r||e!==i[i.length-1]);)i.push(e),o++;return n.remove(),i},i.prototype.scale=function(e){var n=this._d3Scale(e),r=this.domain().indexOf(e),o=Math.floor(r/this.range().length),a=Math.log(o*i._LOOP_LIGHTEN_FACTOR+1);return t.Utils.Color.lightenColor(n,a)},i.prototype._getDomain=function(){return this._d3Scale.domain()},i.prototype._setBackingScaleDomain=function(t){this._d3Scale.domain(t)},i.prototype._getRange=function(){return this._d3Scale.range()},i.prototype._setRange=function(t){this._d3Scale.range(t)},i._LOOP_LIGHTEN_FACTOR=1.6,i._MAXIMUM_COLORS_FROM_CSS=256,i}(t.Scale);e.Color=i}(e=t.Scales||(t.Scales={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(i){function n(){i.call(this),this._d3Scale=d3.time.scale(),this.autoDomain()}return r(n,i),n.prototype.tickInterval=function(t,e){var i=d3.time.scale(),r=n.timeIntervalToD3Time(t);return i.domain(this.domain()),i.range(this.range()),i.ticks(r,e)},n.prototype._setDomain=function(t){if(t[1]<t[0])throw new Error("Scale.Time domain values must be in chronological order");return i.prototype._setDomain.call(this,t)},n.prototype._defaultExtent=function(){return[new Date("1970-01-01"),new Date("1970-01-02")]},n.prototype._expandSingleValueDomain=function(t){var e=t[0].getTime(),i=t[1].getTime();if(e===i){var n=new Date(e);n.setDate(n.getDate()-1);var r=new Date(i);return r.setDate(r.getDate()+1),[n,r]}return t},n.prototype.scale=function(t){return this._d3Scale(t)},n.prototype._getDomain=function(){return this._d3Scale.domain()},n.prototype._setBackingScaleDomain=function(t){this._d3Scale.domain(t)},n.prototype._getRange=function(){return this._d3Scale.range()},n.prototype._setRange=function(t){this._d3Scale.range(t)},n.prototype.invert=function(t){return this._d3Scale.invert(t)},n.prototype.defaultTicks=function(){return this._d3Scale.ticks(e.Time._DEFAULT_NUM_TICKS)},n.prototype._niceDomain=function(t){return this._d3Scale.copy().domain(t).nice().domain()},n.timeIntervalToD3Time=function(e){switch(e){case t.TimeInterval.second:return d3.time.second;case t.TimeInterval.minute:return d3.time.minute;case t.TimeInterval.hour:return d3.time.hour;case t.TimeInterval.day:return d3.time.day;case t.TimeInterval.week:return d3.time.week;case t.TimeInterval.month:return d3.time.month;case t.TimeInterval.year:return d3.time.year;default:throw Error("TimeInterval specified does not exist: "+e)}},n}(t.QuantitativeScale);e.Time=i}(e=t.Scales||(t.Scales={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(t){switch(void 0===t&&(t="linear"),e.call(this),t){case"linear":this._colorScale=d3.scale.linear();break;case"log":this._colorScale=d3.scale.log();break;case"sqrt":this._colorScale=d3.scale.sqrt();break;case"pow":this._colorScale=d3.scale.pow()}if(null==this._colorScale)throw new Error("unknown QuantitativeScale scale type "+t);this.range(i.REDS)}return r(i,e),i.prototype.extentOfValues=function(t){var e=d3.extent(t);return null==e[0]||null==e[1]?[]:e},i.prototype._d3InterpolatedScale=function(){return this._colorScale.range([0,1]).interpolate(this._interpolateColors())},i.prototype._interpolateColors=function(){var t=this._colorRange;if(t.length<2)throw new Error("Color scale arrays must have at least two elements.");return function(e,i){return function(e){e=Math.max(0,Math.min(1,e));var i=e*(t.length-1),n=Math.floor(i),r=Math.ceil(i),o=i-n;return d3.interpolateLab(t[n],t[r])(o)}}},i.prototype._resetScale=function(){this._d3Scale=this._d3InterpolatedScale(),
this._autoDomainIfAutomaticMode(),this._dispatchUpdate()},i.prototype.autoDomain=function(){var e=this._getAllIncludedValues();return e.length>0&&this._setDomain([t.Utils.Math.min(e,0),t.Utils.Math.max(e,0)]),this},i.prototype.scale=function(t){return this._d3Scale(t)},i.prototype._getDomain=function(){return this._d3Scale.domain()},i.prototype._setBackingScaleDomain=function(t){this._d3Scale.domain(t)},i.prototype._getRange=function(){return this._colorRange},i.prototype._setRange=function(t){this._colorRange=t,this._resetScale()},i.REDS=["#FFFFFF","#FFF6E1","#FEF4C0","#FED976","#FEB24C","#FD8D3C","#FC4E2A","#E31A1C","#B10026"],i.BLUES=["#FFFFFF","#CCFFFF","#A5FFFD","#85F7FB","#6ED3EF","#55A7E0","#417FD0","#2545D3","#0B02E1"],i.POSNEG=["#0B02E1","#2545D3","#417FD0","#55A7E0","#6ED3EF","#85F7FB","#A5FFFD","#CCFFFF","#FFFFFF","#FFF6E1","#FEF4C0","#FED976","#FEB24C","#FD8D3C","#FC4E2A","#E31A1C","#B10026"],i}(t.Scale);e.InterpolatedColor=i}(e=t.Scales||(t.Scales={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i;!function(e){function i(e){if(0>=e)throw new Error("interval must be positive number");return function(i){var n=i.domain(),r=Math.min(n[0],n[1]),o=Math.max(n[0],n[1]),a=Math.ceil(r/e)*e,s=Math.floor((o-a)/e)+1,l=r%e===0?[]:[r],c=t.Utils.Math.range(0,s).map(function(t){return a+t*e}),h=o%e===0?[]:[o];return l.concat(c).concat(h)}}function n(){return function(t){var e=t.defaultTicks();return e.filter(function(t,i){return t%1===0||0===i||i===e.length-1})}}e.intervalTickGenerator=i,e.integerTickGenerator=n}(i=e.TickGenerators||(e.TickGenerators={}))}(e=t.Scales||(t.Scales={}))}(n||(n={}));var n;!function(t){var e=function(){function e(t){this._cachedSelectionValid=!1,this._dataset=t}return e.prototype.renderArea=function(t){return null==t?this._renderArea:(this._renderArea=t,this._cachedSelectionValid=!1,this)},e.prototype.remove=function(){null!=this.renderArea()&&this.renderArea().remove()},e.prototype._bindSelectionData=function(t){var e=this.selection().data(t);e.enter().append(this._svgElementName),e.exit().remove(),this._applyDefaultAttributes(e)},e.prototype._applyDefaultAttributes=function(t){null!=this._className&&t.classed(this._className,!0)},e.prototype._drawStep=function(t){var e=this.selection(),i=["fill","stroke"];i.forEach(function(i){null!=t.attrToAppliedProjector[i]&&e.attr(i,t.attrToAppliedProjector[i])}),t.animator.animate(e,t.attrToAppliedProjector),null!=this._className&&this.selection().classed(this._className,!0)},e.prototype._appliedProjectors=function(t){var e=this,i={};return Object.keys(t).forEach(function(n){i[n]=function(i,r){return t[n](i,r,e._dataset)}}),i},e.prototype.totalDrawTime=function(t,e){var i=0;return e.forEach(function(e,n){i+=e.animator.totalTime(t.length)}),i},e.prototype.draw=function(e,i){var n=this,r=i.map(function(t){var e=n._appliedProjectors(t.attrToProjector);return{attrToAppliedProjector:e,animator:t.animator}});this._bindSelectionData(e),this._cachedSelectionValid=!1;var o=0;return r.forEach(function(i,r){t.Utils.Window.setTimeout(function(){return n._drawStep(i)},o),o+=i.animator.totalTime(e.length)}),this},e.prototype.selection=function(){return this._cachedSelectionValid||(this._cachedSelection=this.renderArea().selectAll(this.selector()),this._cachedSelectionValid=!0),this._cachedSelection},e.prototype.selector=function(){return this._svgElementName},e.prototype.selectionForIndex=function(t){return d3.select(this.selection()[0][t])},e}();t.Drawer=e}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(t){function e(e){t.call(this,e),this._className="line",this._svgElementName="path"}return r(e,t),e.prototype._applyDefaultAttributes=function(e){t.prototype._applyDefaultAttributes.call(this,e),e.style("fill","none")},e.prototype.selectionForIndex=function(t){return d3.select(this.selection()[0][0])},e}(t.Drawer);e.Line=i}(e=t.Drawers||(t.Drawers={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(t){function e(e){t.call(this,e),this._className="area",this._svgElementName="path"}return r(e,t),e.prototype._applyDefaultAttributes=function(e){t.prototype._applyDefaultAttributes.call(this,e),e.style("stroke","none")},e.prototype.selectionForIndex=function(t){return d3.select(this.selection()[0][0])},e}(t.Drawer);e.Area=i}(e=t.Drawers||(t.Drawers={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(t){function e(e){t.call(this,e),this._svgElementName="rect"}return r(e,t),e}(t.Drawer);e.Rectangle=i}(e=t.Drawers||(t.Drawers={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(t){function e(e){t.call(this,e),this._className="arc fill",this._svgElementName="path"}return r(e,t),e.prototype._applyDefaultAttributes=function(e){t.prototype._applyDefaultAttributes.call(this,e),e.style("stroke","none")},e}(t.Drawer);e.Arc=i}(e=t.Drawers||(t.Drawers={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(t){function e(e){t.call(this,e),this._className="arc outline",this._svgElementName="path"}return r(e,t),e.prototype._applyDefaultAttributes=function(e){t.prototype._applyDefaultAttributes.call(this,e),e.style("fill","none")},e}(t.Drawer);e.ArcOutline=i}(e=t.Drawers||(t.Drawers={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(t){function e(e){t.call(this,e),this._svgElementName="path",this._className="symbol"}return r(e,t),e}(t.Drawer);e.Symbol=i}(e=t.Drawers||(t.Drawers={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(t){function e(e){t.call(this,e),this._svgElementName="line"}return r(e,t),e}(t.Drawer);e.Segment=i}(e=t.Drawers||(t.Drawers={}))}(n||(n={}));var n;!function(t){var e;!function(t){var e=function(){function t(){}return t.TOP="top",t.BOTTOM="bottom",t.LEFT="left",t.RIGHT="right",t.CENTER="center",t}();t.Alignment=e}(e=t.Components||(t.Components={}));var i=function(){function e(){this._clipPathEnabled=!1,this._origin={x:0,y:0},this._xAlignment="left",this._yAlignment="top",this._isSetup=!1,this._isAnchored=!1,this._boxes=[],this._isTopLevelComponent=!1,this._cssClasses=new t.Utils.Set,this._destroyed=!1,this._onAnchorCallbacks=new t.Utils.CallbackSet,this._onDetachCallbacks=new t.Utils.CallbackSet,this._cssClasses.add("component")}return e.prototype.anchor=function(t){if(this._destroyed)throw new Error("Can't reuse destroy()-ed Components!");if(this._isTopLevelComponent="svg"===t.node().nodeName.toLowerCase(),this._isTopLevelComponent){this._rootSVG=t,this._rootSVG.classed("plottable",!0),this._rootSVG.style("overflow","visible");var i=this._rootSVG.select("."+e._SAFARI_EVENT_BACKING_CLASS);i.empty()&&this._rootSVG.append("rect").classed(e._SAFARI_EVENT_BACKING_CLASS,!0).attr({x:0,y:0,width:"100%",height:"100%"}).style("opacity",0)}return null!=this._element?t.node().appendChild(this._element.node()):(this._element=t.append("g"),this._setup()),this._isAnchored=!0,this._onAnchorCallbacks.callCallbacks(this),this},e.prototype.onAnchor=function(t){return this._isAnchored&&t(this),this._onAnchorCallbacks.add(t),this},e.prototype.offAnchor=function(t){return this._onAnchorCallbacks["delete"](t),this},e.prototype._setup=function(){var e=this;this._isSetup||(this._cssClasses.forEach(function(t){e._element.classed(t,!0)}),this._cssClasses=new t.Utils.Set,this._backgroundContainer=this._element.append("g").classed("background-container",!0),this._addBox("background-fill",this._backgroundContainer),this._content=this._element.append("g").classed("content",!0),this._foregroundContainer=this._element.append("g").classed("foreground-container",!0),this._boxContainer=this._element.append("g").classed("box-container",!0),this._clipPathEnabled&&this._generateClipPath(),this._boundingBox=this._addBox("bounding-box"),this._isSetup=!0)},e.prototype.requestedSpace=function(t,e){return{minWidth:0,minHeight:0}},e.prototype.computeLayout=function(i,n,r){var o=this;if(null==i||null==n||null==r){if(null==this._element)throw new Error("anchor() must be called before computeLayout()");if(!this._isTopLevelComponent)throw new Error("null arguments cannot be passed to computeLayout() on a non-root node");i={x:0,y:0},null==this._rootSVG.attr("width")&&this._rootSVG.attr("width","100%"),null==this._rootSVG.attr("height")&&this._rootSVG.attr("height","100%");var a=this._rootSVG.node();n=t.Utils.DOM.elementWidth(a),r=t.Utils.DOM.elementHeight(a)}var s=this._sizeFromOffer(n,r);this._width=s.width,this._height=s.height;var l=e._xAlignToProportion[this._xAlignment],c=e._yAlignToProportion[this._yAlignment];return this._origin={x:i.x+(n-this.width())*l,y:i.y+(r-this.height())*c},this._element.attr("transform","translate("+this._origin.x+","+this._origin.y+")"),this._boxes.forEach(function(t){return t.attr("width",o.width()).attr("height",o.height())}),this},e.prototype._sizeFromOffer=function(t,e){var i=this.requestedSpace(t,e);return{width:this.fixedWidth()?Math.min(t,i.minWidth):t,height:this.fixedHeight()?Math.min(e,i.minHeight):e}},e.prototype.render=function(){return this._isAnchored&&this._isSetup&&this.width()>=0&&this.height()>=0&&t.RenderController.registerToRender(this),this},e.prototype._scheduleComputeLayout=function(){this._isAnchored&&this._isSetup&&t.RenderController.registerToComputeLayout(this)},e.prototype.renderImmediately=function(){return this._clipPathEnabled&&this._updateClipPath(),this},e.prototype.redraw=function(){return this._isAnchored&&this._isSetup&&(this._isTopLevelComponent?this._scheduleComputeLayout():this.parent().redraw()),this},e.prototype.renderTo=function(e){if(this.detach(),null!=e){var i;if(i="string"==typeof e?d3.select(e):e instanceof Element?d3.select(e):e,!i.node()||"svg"!==i.node().nodeName.toLowerCase())throw new Error("Plottable requires a valid SVG to renderTo");this.anchor(i)}if(null==this._element)throw new Error("If a Component has never been rendered before, then renderTo must be given a node to render to, or a d3.Selection, or a selector string");return this.computeLayout(),this.render(),t.RenderController.flush(),this},e.prototype.xAlignment=function(t){if(null==t)return this._xAlignment;if(t=t.toLowerCase(),null==e._xAlignToProportion[t])throw new Error("Unsupported alignment: "+t);return this._xAlignment=t,this.redraw(),this},e.prototype.yAlignment=function(t){if(null==t)return this._yAlignment;if(t=t.toLowerCase(),null==e._yAlignToProportion[t])throw new Error("Unsupported alignment: "+t);return this._yAlignment=t,this.redraw(),this},e.prototype._addBox=function(t,e){if(null==this._element)throw new Error("Adding boxes before anchoring is currently disallowed");e=null==e?this._boxContainer:e;var i=e.append("rect");return null!=t&&i.classed(t,!0),this._boxes.push(i),null!=this.width()&&null!=this.height()&&i.attr("width",this.width()).attr("height",this.height()),i},e.prototype._generateClipPath=function(){this._clipPathID=t.Utils.DOM.generateUniqueClipPathId();var e=this._boxContainer.append("clipPath").attr("id",this._clipPathID);this._addBox("clip-rect",e),this._updateClipPath()},e.prototype._updateClipPath=function(){var t=/MSIE [5-9]/.test(navigator.userAgent)?"":document.location.href;t=t.split("#")[0],this._element.attr("clip-path",'url("'+t+"#"+this._clipPathID+'")')},e.prototype.hasClass=function(t){return null!=t&&(null==this._element?this._cssClasses.has(t):this._element.classed(t))},e.prototype.addClass=function(t){return null==t?this:(null==this._element?this._cssClasses.add(t):this._element.classed(t,!0),this)},e.prototype.removeClass=function(t){return null==t?this:(null==this._element?this._cssClasses["delete"](t):this._element.classed(t,!1),this)},e.prototype.fixedWidth=function(){return!1},e.prototype.fixedHeight=function(){return!1},e.prototype.detach=function(){return this.parent(null),this._isAnchored&&(this._element.remove(),this._isTopLevelComponent&&this._rootSVG.select("."+e._SAFARI_EVENT_BACKING_CLASS).remove()),this._isAnchored=!1,this._onDetachCallbacks.callCallbacks(this),this},e.prototype.onDetach=function(t){return this._onDetachCallbacks.add(t),this},e.prototype.offDetach=function(t){return this._onDetachCallbacks["delete"](t),this},e.prototype.parent=function(t){if(void 0===t)return this._parent;if(null!==t&&!t.has(this))throw new Error("Passed invalid parent");return this._parent=t,this},e.prototype.destroy=function(){this._destroyed=!0,this.detach()},e.prototype.width=function(){return this._width},e.prototype.height=function(){return this._height},e.prototype.origin=function(){return{x:this._origin.x,y:this._origin.y}},e.prototype.originToSVG=function(){for(var t=this.origin(),e=this.parent();null!=e;){var i=e.origin();t.x+=i.x,t.y+=i.y,e=e.parent()}return t},e.prototype.foreground=function(){return this._foregroundContainer},e.prototype.content=function(){return this._content},e.prototype.background=function(){return this._backgroundContainer},e._xAlignToProportion={left:0,center:.5,right:1},e._yAlignToProportion={top:0,center:.5,bottom:1},e._SAFARI_EVENT_BACKING_CLASS="safari-event-backing",e}();t.Component=i}(n||(n={}));var n;!function(t){var e=function(t){function e(){var e=this;t.call(this),this._detachCallback=function(t){return e.remove(t)}}return r(e,t),e.prototype.anchor=function(e){var i=this;return t.prototype.anchor.call(this,e),this._forEach(function(t){return t.anchor(i.content())}),this},e.prototype.render=function(){return this._forEach(function(t){return t.render()}),this},e.prototype.has=function(t){throw new Error("has() is not implemented on ComponentContainer")},e.prototype._adoptAndAnchor=function(t){t.parent(this),t.onDetach(this._detachCallback),this._isAnchored&&t.anchor(this.content())},e.prototype.remove=function(t){return this.has(t)&&(t.offDetach(this._detachCallback),this._remove(t),t.detach(),this.redraw()),this},e.prototype._remove=function(t){return!1},e.prototype._forEach=function(t){throw new Error("_forEach() is not implemented on ComponentContainer")},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._forEach(function(t){return t.destroy()})},e}(t.Component);t.ComponentContainer=e}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(t){var i=this;void 0===t&&(t=[]),e.call(this),this._components=[],this.addClass("component-group"),t.forEach(function(t){return i.append(t)})}return r(i,e),i.prototype._forEach=function(t){this.components().forEach(t)},i.prototype.has=function(t){return this._components.indexOf(t)>=0},i.prototype.requestedSpace=function(e,i){var n=this._components.map(function(t){return t.requestedSpace(e,i)});return{minWidth:t.Utils.Math.max(n,function(t){return t.minWidth},0),minHeight:t.Utils.Math.max(n,function(t){return t.minHeight},0)}},i.prototype.computeLayout=function(t,i,n){var r=this;return e.prototype.computeLayout.call(this,t,i,n),this._forEach(function(t){t.computeLayout({x:0,y:0},r.width(),r.height())}),this},i.prototype._sizeFromOffer=function(t,e){return{width:t,height:e}},i.prototype.fixedWidth=function(){return this._components.every(function(t){return t.fixedWidth()})},i.prototype.fixedHeight=function(){return this._components.every(function(t){return t.fixedHeight()})},i.prototype.components=function(){return this._components.slice()},i.prototype.append=function(t){return null==t||this.has(t)||(t.detach(),this._components.push(t),this._adoptAndAnchor(t),this.redraw()),this},i.prototype._remove=function(t){var e=this._components.indexOf(t);return e>=0&&(this._components.splice(e,1),!0)},i}(t.ComponentContainer);e.Group=i}(e=t.Components||(t.Components={}))}(n||(n={}));var n;!function(t){var e=function(e){function i(i,n){var r=this;if(e.call(this),this._endTickLength=5,this._innerTickLength=5,this._tickLabelPadding=10,this._margin=15,this._showEndTickLabels=!1,this._annotationsEnabled=!1,this._annotationTierCount=1,null==i||null==n)throw new Error("Axis requires a scale and orientation");this._scale=i,this.orientation(n),this._setDefaultAlignment(),this.addClass("axis"),this._isHorizontal()?this.addClass("x-axis"):this.addClass("y-axis"),this.formatter(t.Formatters.identity()),this._rescaleCallback=function(t){return r._rescale()},this._scale.onUpdate(this._rescaleCallback),this._annotatedTicks=[],this._annotationFormatter=t.Formatters.identity()}return r(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._scale.offUpdate(this._rescaleCallback)},i.prototype._isHorizontal=function(){return"top"===this._orientation||"bottom"===this._orientation},i.prototype._computeWidth=function(){return this._maxLabelTickLength()},i.prototype._computeHeight=function(){return this._maxLabelTickLength()},i.prototype.requestedSpace=function(t,e){var n=0,r=0;if(this._isHorizontal()){if(r=this._computeHeight()+this._margin,this.annotationsEnabled()){var o=this._annotationMeasurer.measure().height+2*i._ANNOTATION_LABEL_PADDING;r+=o*this.annotationTierCount()}}else if(n=this._computeWidth()+this._margin,this.annotationsEnabled()){var o=this._annotationMeasurer.measure().height+2*i._ANNOTATION_LABEL_PADDING;n+=o*this.annotationTierCount()}return{minWidth:n,minHeight:r}},i.prototype.fixedHeight=function(){return this._isHorizontal()},i.prototype.fixedWidth=function(){return!this._isHorizontal()},i.prototype._rescale=function(){this.render()},i.prototype.computeLayout=function(t,i,n){return e.prototype.computeLayout.call(this,t,i,n),this._isHorizontal()?this._scale.range([0,this.width()]):this._scale.range([this.height(),0]),this},i.prototype._setup=function(){e.prototype._setup.call(this),this._tickMarkContainer=this.content().append("g").classed(i.TICK_MARK_CLASS+"-container",!0),this._tickLabelContainer=this.content().append("g").classed(i.TICK_LABEL_CLASS+"-container",!0),this._baseline=this.content().append("line").classed("baseline",!0),this._annotationContainer=this.content().append("g").classed("annotation-container",!0),this._annotationContainer.append("g").classed("annotation-line-container",!0),this._annotationContainer.append("g").classed("annotation-circle-container",!0),this._annotationContainer.append("g").classed("annotation-rect-container",!0);var t=this._annotationContainer.append("g").classed("annotation-label-container",!0);this._annotationMeasurer=new o.Measurers.Measurer(t),this._annotationWriter=new o.Writers.Writer(this._annotationMeasurer)},i.prototype._getTickValues=function(){return[]},i.prototype.renderImmediately=function(){var t=this._getTickValues(),e=this._tickMarkContainer.selectAll("."+i.TICK_MARK_CLASS).data(t);return e.enter().append("line").classed(i.TICK_MARK_CLASS,!0),e.attr(this._generateTickMarkAttrHash()),d3.select(e[0][0]).classed(i.END_TICK_MARK_CLASS,!0).attr(this._generateTickMarkAttrHash(!0)),d3.select(e[0][t.length-1]).classed(i.END_TICK_MARK_CLASS,!0).attr(this._generateTickMarkAttrHash(!0)),e.exit().remove(),this._baseline.attr(this._generateBaselineAttrHash()),this.annotationsEnabled()?this._drawAnnotations():this._removeAnnotations(),this},i.prototype.annotatedTicks=function(t){return null==t?this._annotatedTicks:(this._annotatedTicks=t,this.render(),this)},i.prototype.annotationFormatter=function(t){return null==t?this._annotationFormatter:(this._annotationFormatter=t,this.render(),this)},i.prototype.annotationsEnabled=function(t){return null==t?this._annotationsEnabled:(this._annotationsEnabled=t,this.redraw(),this)},i.prototype.annotationTierCount=function(t){if(null==t)return this._annotationTierCount;if(0>t)throw new Error("annotationTierCount cannot be negative");return this._annotationTierCount=t,this.redraw(),this},i.prototype._drawAnnotations=function(){var e=this,n=i._ANNOTATION_LABEL_PADDING,r=new t.Utils.Map,o=this._annotatedTicksToRender();o.forEach(function(t){var i=e._annotationMeasurer.measure(e.annotationFormatter()(t)),o={width:i.width+2*n,height:i.height+2*n};r.set(t,o)});var a=this._annotationMeasurer.measure().height+2*n,s=this._annotationToTier(r),l=new t.Utils.Set,c=this._isHorizontal()?this.height():this.width(),h=this._coreSize(),u=Math.min(this.annotationTierCount(),Math.floor((c-h)/a));s.forEach(function(t,e){(-1===t||t>=u)&&l.add(e)});var p,d=function(t,e,i){var n=t.selectAll("."+i).data(o);return n.enter().append(e).classed(i,!0),n.exit().remove(),n},_=function(t){switch(e.orientation()){case"bottom":case"right":return s.get(t)*a+h;case"top":case"left":return c-h-s.get(t)*a}},f=function(t){return e._scale.scale(t)},y=function(t){return l.has(t)?"hidden":"visible"};switch(this.orientation()){case"bottom":case"right":p=0;break;case"top":p=this.height();break;case"left":p=this.width()}var m=this._isHorizontal();d(this._annotationContainer.select(".annotation-line-container"),"line",i.ANNOTATION_LINE_CLASS).attr({x1:m?f:p,x2:m?f:_,y1:m?p:f,y2:m?_:f,visibility:y}),d(this._annotationContainer.select(".annotation-circle-container"),"circle",i.ANNOTATION_CIRCLE_CLASS).attr({cx:m?f:p,cy:m?p:f,r:3});var g=function(t){switch(e.orientation()){case"bottom":case"right":return _(t);case"top":case"left":return _(t)-r.get(t).height}};d(this._annotationContainer.select(".annotation-rect-container"),"rect",i.ANNOTATION_RECT_CLASS).attr({x:m?f:g,y:m?g:f,width:m?function(t){return r.get(t).width}:function(t){return r.get(t).height},height:m?function(t){return r.get(t).height}:function(t){return r.get(t).width},visibility:y});var v=this._annotationWriter,x=this.annotationFormatter(),b=d(this._annotationContainer.select(".annotation-label-container"),"g",i.ANNOTATION_LABEL_CLASS);b.selectAll(".text-container").remove(),b.attr({transform:function(t){var e=m?f(t):g(t),i=m?g(t):f(t);return"translate("+e+","+i+")"},visibility:y}).each(function(t){var e={selection:d3.select(this),xAlign:"center",yAlign:"center",textRotation:m?0:90};v.write(x(t),m?r.get(t).width:r.get(t).height,m?r.get(t).height:r.get(t).width,e)})},i.prototype._annotatedTicksToRender=function(){var e=this,i=this._scale.range();return t.Utils.Array.uniq(this.annotatedTicks().filter(function(n){return null!=n&&t.Utils.Math.inRange(e._scale.scale(n),i[0],i[1])}))},i.prototype._coreSize=function(){var t=this._isHorizontal()?this.height():this.width(),e=this._isHorizontal()?this._computeHeight():this._computeWidth();return Math.min(e,t)},i.prototype._annotationTierHeight=function(){return this._annotationMeasurer.measure().height+2*i._ANNOTATION_LABEL_PADDING},i.prototype._annotationToTier=function(e){var i=this,n=[[]],r=new t.Utils.Map,o=this._isHorizontal()?this.width():this.height();return this._annotatedTicksToRender().forEach(function(t){var a=i._scale.scale(t),s=e.get(t).width;if(0>a||a+s>o)return void r.set(t,-1);for(var l=function(t){return n[t].some(function(t){var n=i._scale.scale(t),r=e.get(t).width;return a+s>=n&&n+r>=a})},c=0;l(c);)c++,n.length===c&&n.push([]);n[c].push(t),r.set(t,c)}),r},i.prototype._removeAnnotations=function(){this._annotationContainer.selectAll(".annotation-line").remove(),this._annotationContainer.selectAll(".annotation-circle").remove(),this._annotationContainer.selectAll(".annotation-rect").remove(),this._annotationContainer.selectAll(".annotation-label").remove()},i.prototype._generateBaselineAttrHash=function(){var t={x1:0,y1:0,x2:0,y2:0};switch(this._orientation){case"bottom":t.x2=this.width();break;case"top":t.x2=this.width(),t.y1=this.height(),t.y2=this.height();break;case"left":t.x1=this.width(),t.x2=this.width(),t.y2=this.height();break;case"right":t.y2=this.height()}return t},i.prototype._generateTickMarkAttrHash=function(t){var e=this;void 0===t&&(t=!1);var i={x1:0,y1:0,x2:0,y2:0},n=function(t){return e._scale.scale(t)};this._isHorizontal()?(i.x1=n,i.x2=n):(i.y1=n,i.y2=n);var r=t?this._endTickLength:this._innerTickLength;switch(this._orientation){case"bottom":i.y2=r;break;case"top":i.y1=this.height(),i.y2=this.height()-r;break;case"left":i.x1=this.width(),i.x2=this.width()-r;break;case"right":i.x2=r}return i},i.prototype._setDefaultAlignment=function(){switch(this._orientation){case"bottom":this.yAlignment("top");break;case"top":this.yAlignment("bottom");break;case"left":this.xAlignment("right");break;case"right":this.xAlignment("left")}},i.prototype.formatter=function(t){return null==t?this._formatter:(this._formatter=t,this.redraw(),this)},i.prototype.innerTickLength=function(t){if(null==t)return this._innerTickLength;if(0>t)throw new Error("inner tick length must be positive");return this._innerTickLength=t,this.redraw(),this},i.prototype.endTickLength=function(t){if(null==t)return this._endTickLength;if(0>t)throw new Error("end tick length must be positive");return this._endTickLength=t,this.redraw(),this},i.prototype._maxLabelTickLength=function(){return this.showEndTickLabels()?Math.max(this.innerTickLength(),this.endTickLength()):this.innerTickLength()},i.prototype.tickLabelPadding=function(t){if(null==t)return this._tickLabelPadding;if(0>t)throw new Error("tick label padding must be positive");return this._tickLabelPadding=t,this.redraw(),this},i.prototype.margin=function(t){if(null==t)return this._margin;if(0>t)throw new Error("margin size must be positive");return this._margin=t,this.redraw(),this},i.prototype.orientation=function(t){if(null==t)return this._orientation;var e=t.toLowerCase();if("top"!==e&&"bottom"!==e&&"left"!==e&&"right"!==e)throw new Error("unsupported orientation");return this._orientation=e,this.redraw(),this},i.prototype.showEndTickLabels=function(t){return null==t?this._showEndTickLabels:(this._showEndTickLabels=t,this.render(),this)},i.END_TICK_MARK_CLASS="end-tick-mark",i.TICK_MARK_CLASS="tick-mark",i.TICK_LABEL_CLASS="tick-label",i.ANNOTATION_LINE_CLASS="annotation-line",i.ANNOTATION_RECT_CLASS="annotation-rect",i.ANNOTATION_CIRCLE_CLASS="annotation-circle",i.ANNOTATION_LABEL_CLASS="annotation-label",i._ANNOTATION_LABEL_PADDING=4,i}(t.Component);t.Axis=e}(n||(n={}));var n;!function(t){var e;!function(t){t.second="second",t.minute="minute",t.hour="hour",t.day="day",t.week="week",t.month="month",t.year="year"}(e=t.TimeInterval||(t.TimeInterval={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(n,r){e.call(this,n,r),this._tierLabelPositions=[],this.addClass("time-axis"),this.tickLabelPadding(5),this.axisConfigurations(i._DEFAULT_TIME_AXIS_CONFIGURATIONS),this.annotationFormatter(t.Formatters.time("%a %b %d, %Y"))}return r(i,e),i.prototype.tierLabelPositions=function(t){if(null==t)return this._tierLabelPositions;if(!t.every(function(t){return"between"===t.toLowerCase()||"center"===t.toLowerCase()}))throw new Error("Unsupported position for tier labels");return this._tierLabelPositions=t,this.redraw(),this},i.prototype.axisConfigurations=function(e){if(null==e)return this._possibleTimeAxisConfigurations;this._possibleTimeAxisConfigurations=e,this._numTiers=t.Utils.Math.max(this._possibleTimeAxisConfigurations.map(function(t){return t.length}),0),this._isAnchored&&this._setupDomElements();for(var i=this.tierLabelPositions(),n=[],r=0;r<this._numTiers;r++)n.push(i[r]||"between");return this.tierLabelPositions(n),this.redraw(),this},i.prototype._getMostPreciseConfigurationIndex=function(){var e=this,i=this._possibleTimeAxisConfigurations.length;return this._possibleTimeAxisConfigurations.forEach(function(t,n){i>n&&t.every(function(t){return e._checkTimeAxisTierConfigurationWidth(t)})&&(i=n)}),i===this._possibleTimeAxisConfigurations.length&&(t.Utils.Window.warn("zoomed out too far: could not find suitable interval to display labels"),--i),i},i.prototype.orientation=function(t){if(t&&("right"===t.toLowerCase()||"left"===t.toLowerCase()))throw new Error(t+" is not a supported orientation for TimeAxis - only horizontal orientations are supported");return e.prototype.orientation.call(this,t)},i.prototype._computeHeight=function(){var t=this._measurer.measure().height;this._tierHeights=[];for(var e=0;e<this._numTiers;e++)this._tierHeights.push(t+this.tickLabelPadding()+("between"===this._tierLabelPositions[e]?0:this._maxLabelTickLength()));return d3.sum(this._tierHeights)},i.prototype._getIntervalLength=function(e){var i=this._scale.domain()[0],n=t.Scales.Time.timeIntervalToD3Time(e.interval),r=n.offset(i,e.step);if(r>this._scale.domain()[1])return this.width();var o=Math.abs(this._scale.scale(r)-this._scale.scale(i));return o},i.prototype._maxWidthForInterval=function(t){return this._measurer.measure(t.formatter(i._LONG_DATE)).width},i.prototype._checkTimeAxisTierConfigurationWidth=function(t){var e=this._maxWidthForInterval(t)+2*this.tickLabelPadding();return Math.min(this._getIntervalLength(t),this.width())>=e},i.prototype._sizeFromOffer=function(t,i){var n=e.prototype._sizeFromOffer.call(this,t,i),r=this._tierHeights.reduce(function(t,e,i,r){return t+e>n.height?t:t+e}),o=this.margin()+(this.annotationsEnabled()?this.annotationTierCount()*this._annotationTierHeight():0);return n.height=Math.min(n.height,r+o),n},i.prototype._setup=function(){e.prototype._setup.call(this),this._setupDomElements()},i.prototype._setupDomElements=function(){this.content().selectAll("."+i.TIME_AXIS_TIER_CLASS).remove(),this._tierLabelContainers=[],this._tierMarkContainers=[],this._tierBaselines=[],this._tickLabelContainer.remove(),this._baseline.remove();for(var e=0;e<this._numTiers;++e){var n=this.content().append("g").classed(i.TIME_AXIS_TIER_CLASS,!0);this._tierLabelContainers.push(n.append("g").classed(t.Axis.TICK_LABEL_CLASS+"-container",!0)),this._tierMarkContainers.push(n.append("g").classed(t.Axis.TICK_MARK_CLASS+"-container",!0)),this._tierBaselines.push(n.append("line").classed("baseline",!0))}this._measurer=new o.Measurers.Measurer(this._tierLabelContainers[0])},i.prototype._getTickIntervalValues=function(t){return this._scale.tickInterval(t.interval,t.step)},i.prototype._getTickValues=function(){var t=this;return this._possibleTimeAxisConfigurations[this._mostPreciseConfigIndex].reduce(function(e,i){return e.concat(t._getTickIntervalValues(i))},[])},i.prototype._cleanTiers=function(){for(var e=0;e<this._tierLabelContainers.length;e++)this._tierLabelContainers[e].selectAll("."+t.Axis.TICK_LABEL_CLASS).remove(),this._tierMarkContainers[e].selectAll("."+t.Axis.TICK_MARK_CLASS).remove(),this._tierBaselines[e].style("visibility","hidden")},i.prototype._getTickValuesForConfiguration=function(t){var e=this._scale.tickInterval(t.interval,t.step),i=this._scale.domain(),n=e.map(function(t){return t.valueOf()});return-1===n.indexOf(i[0].valueOf())&&e.unshift(i[0]),-1===n.indexOf(i[1].valueOf())&&e.push(i[1]),e},i.prototype._renderTierLabels=function(e,i,n){var r=this,o=this._getTickValuesForConfiguration(i),a=[];"between"===this._tierLabelPositions[n]&&1===i.step?o.map(function(t,e){e+1>=o.length||a.push(new Date((o[e+1].valueOf()-o[e].valueOf())/2+o[e].valueOf()))}):a=o;var s=e.selectAll("."+t.Axis.TICK_LABEL_CLASS).data(a,function(t){return String(t.valueOf())}),l=s.enter().append("g").classed(t.Axis.TICK_LABEL_CLASS,!0);l.append("text");var c,h="center"===this._tierLabelPositions[n]||1===i.step?0:this.tickLabelPadding();c="bottom"===this.orientation()?d3.sum(this._tierHeights.slice(0,n+1))-this.tickLabelPadding():"center"===this._tierLabelPositions[n]?this.height()-d3.sum(this._tierHeights.slice(0,n))-this.tickLabelPadding()-this._maxLabelTickLength():this.height()-d3.sum(this._tierHeights.slice(0,n))-this.tickLabelPadding();var u=s.selectAll("text");u.size()>0&&t.Utils.DOM.translate(u,h,c),s.exit().remove(),s.attr("transform",function(t){return"translate("+r._scale.scale(t)+",0)"});var p="center"===this._tierLabelPositions[n]||1===i.step?"middle":"start";s.selectAll("text").text(i.formatter).style("text-anchor",p)},i.prototype._renderTickMarks=function(e,i){var n=this._tierMarkContainers[i].selectAll("."+t.Axis.TICK_MARK_CLASS).data(e);n.enter().append("line").classed(t.Axis.TICK_MARK_CLASS,!0);var r=this._generateTickMarkAttrHash(),o=this._tierHeights.slice(0,i).reduce(function(t,e){return t+e},0);"bottom"===this.orientation()?(r.y1=o,r.y2=o+("center"===this._tierLabelPositions[i]?this.innerTickLength():this._tierHeights[i])):(r.y1=this.height()-o,r.y2=this.height()-(o+("center"===this._tierLabelPositions[i]?this.innerTickLength():this._tierHeights[i]))),
n.attr(r),"bottom"===this.orientation()?(r.y1=o,r.y2=o+("center"===this._tierLabelPositions[i]?this.endTickLength():this._tierHeights[i])):(r.y1=this.height()-o,r.y2=this.height()-(o+("center"===this._tierLabelPositions[i]?this.endTickLength():this._tierHeights[i]))),d3.select(n[0][0]).attr(r),d3.select(n[0][n.size()-1]).attr(r),d3.select(n[0][0]).classed(t.Axis.END_TICK_MARK_CLASS,!0),d3.select(n[0][n.size()-1]).classed(t.Axis.END_TICK_MARK_CLASS,!0),n.exit().remove()},i.prototype._renderLabellessTickMarks=function(e){var i=this._tickMarkContainer.selectAll("."+t.Axis.TICK_MARK_CLASS).data(e);i.enter().append("line").classed(t.Axis.TICK_MARK_CLASS,!0);var n=this._generateTickMarkAttrHash();n.y2="bottom"===this.orientation()?this.tickLabelPadding():this.height()-this.tickLabelPadding(),i.attr(n),i.exit().remove()},i.prototype._generateLabellessTicks=function(){return this._mostPreciseConfigIndex<1?[]:this._getTickIntervalValues(this._possibleTimeAxisConfigurations[this._mostPreciseConfigIndex-1][0])},i.prototype.renderImmediately=function(){var t=this;this._mostPreciseConfigIndex=this._getMostPreciseConfigurationIndex();var e=this._possibleTimeAxisConfigurations[this._mostPreciseConfigIndex];this._cleanTiers(),e.forEach(function(e,i){return t._renderTierLabels(t._tierLabelContainers[i],e,i)});for(var i=e.map(function(e,i){return t._getTickValuesForConfiguration(e)}),n=0,r=0;r<Math.max(e.length,1);++r){var o=this._generateBaselineAttrHash();o.y1+="bottom"===this.orientation()?n:-n,o.y2=o.y1,this._tierBaselines[r].attr(o).style("visibility","inherit"),n+=this._tierHeights[r]}var a=[],s=this._scale.domain(),l=this._scale.scale(s[1])-this._scale.scale(s[0]);1.5*this._getIntervalLength(e[0])>=l&&(a=this._generateLabellessTicks()),this._renderLabellessTickMarks(a),this._hideOverflowingTiers();for(var r=0;r<e.length;++r)this._renderTickMarks(i[r],r),this._hideOverlappingAndCutOffLabels(r);return this.annotationsEnabled()?this._drawAnnotations():this._removeAnnotations(),this},i.prototype._hideOverflowingTiers=function(){var t=this,e=this.height(),n=0;this.content().selectAll("."+i.TIME_AXIS_TIER_CLASS).attr("visibility",function(i,r){return n+=t._tierHeights[r],e>=n?"inherit":"hidden"})},i.prototype._hideOverlappingAndCutOffLabels=function(e){var i,n=this,r=this._boundingBox.node().getBoundingClientRect(),o=function(t){return Math.floor(r.left)<=Math.ceil(t.left)&&Math.floor(r.top)<=Math.ceil(t.top)&&Math.floor(t.right)<=Math.ceil(r.left+n.width())&&Math.floor(t.bottom)<=Math.ceil(r.top+n.height())},a=this._tierMarkContainers[e].selectAll("."+t.Axis.TICK_MARK_CLASS).filter(function(t,e){var i=d3.select(this).style("visibility");return"visible"===i||"inherit"===i}),s=a[0].map(function(t){return t.getBoundingClientRect()}),l=this._tierLabelContainers[e].selectAll("."+t.Axis.TICK_LABEL_CLASS).filter(function(t,e){var i=d3.select(this).style("visibility");return"visible"===i||"inherit"===i});l.each(function(e,n){var r=this.getBoundingClientRect(),a=d3.select(this),l=s[n],c=s[n+1],h=null!=i&&t.Utils.DOM.clientRectsOverlap(r,i),u=null!=l&&t.Utils.DOM.clientRectsOverlap(r,l),p=null!=c&&t.Utils.DOM.clientRectsOverlap(r,c);!o(r)||h||u||p?a.style("visibility","hidden"):(i=r,a.style("visibility","inherit"))})},i.TIME_AXIS_TIER_CLASS="time-axis-tier",i._DEFAULT_TIME_AXIS_CONFIGURATIONS=[[{interval:t.TimeInterval.second,step:1,formatter:t.Formatters.time("%I:%M:%S %p")},{interval:t.TimeInterval.day,step:1,formatter:t.Formatters.time("%B %e, %Y")}],[{interval:t.TimeInterval.second,step:5,formatter:t.Formatters.time("%I:%M:%S %p")},{interval:t.TimeInterval.day,step:1,formatter:t.Formatters.time("%B %e, %Y")}],[{interval:t.TimeInterval.second,step:10,formatter:t.Formatters.time("%I:%M:%S %p")},{interval:t.TimeInterval.day,step:1,formatter:t.Formatters.time("%B %e, %Y")}],[{interval:t.TimeInterval.second,step:15,formatter:t.Formatters.time("%I:%M:%S %p")},{interval:t.TimeInterval.day,step:1,formatter:t.Formatters.time("%B %e, %Y")}],[{interval:t.TimeInterval.second,step:30,formatter:t.Formatters.time("%I:%M:%S %p")},{interval:t.TimeInterval.day,step:1,formatter:t.Formatters.time("%B %e, %Y")}],[{interval:t.TimeInterval.minute,step:1,formatter:t.Formatters.time("%I:%M %p")},{interval:t.TimeInterval.day,step:1,formatter:t.Formatters.time("%B %e, %Y")}],[{interval:t.TimeInterval.minute,step:5,formatter:t.Formatters.time("%I:%M %p")},{interval:t.TimeInterval.day,step:1,formatter:t.Formatters.time("%B %e, %Y")}],[{interval:t.TimeInterval.minute,step:10,formatter:t.Formatters.time("%I:%M %p")},{interval:t.TimeInterval.day,step:1,formatter:t.Formatters.time("%B %e, %Y")}],[{interval:t.TimeInterval.minute,step:15,formatter:t.Formatters.time("%I:%M %p")},{interval:t.TimeInterval.day,step:1,formatter:t.Formatters.time("%B %e, %Y")}],[{interval:t.TimeInterval.minute,step:30,formatter:t.Formatters.time("%I:%M %p")},{interval:t.TimeInterval.day,step:1,formatter:t.Formatters.time("%B %e, %Y")}],[{interval:t.TimeInterval.hour,step:1,formatter:t.Formatters.time("%I %p")},{interval:t.TimeInterval.day,step:1,formatter:t.Formatters.time("%B %e, %Y")}],[{interval:t.TimeInterval.hour,step:3,formatter:t.Formatters.time("%I %p")},{interval:t.TimeInterval.day,step:1,formatter:t.Formatters.time("%B %e, %Y")}],[{interval:t.TimeInterval.hour,step:6,formatter:t.Formatters.time("%I %p")},{interval:t.TimeInterval.day,step:1,formatter:t.Formatters.time("%B %e, %Y")}],[{interval:t.TimeInterval.hour,step:12,formatter:t.Formatters.time("%I %p")},{interval:t.TimeInterval.day,step:1,formatter:t.Formatters.time("%B %e, %Y")}],[{interval:t.TimeInterval.day,step:1,formatter:t.Formatters.time("%a %e")},{interval:t.TimeInterval.month,step:1,formatter:t.Formatters.time("%B %Y")}],[{interval:t.TimeInterval.day,step:1,formatter:t.Formatters.time("%e")},{interval:t.TimeInterval.month,step:1,formatter:t.Formatters.time("%B %Y")}],[{interval:t.TimeInterval.month,step:1,formatter:t.Formatters.time("%B")},{interval:t.TimeInterval.year,step:1,formatter:t.Formatters.time("%Y")}],[{interval:t.TimeInterval.month,step:1,formatter:t.Formatters.time("%b")},{interval:t.TimeInterval.year,step:1,formatter:t.Formatters.time("%Y")}],[{interval:t.TimeInterval.month,step:3,formatter:t.Formatters.time("%b")},{interval:t.TimeInterval.year,step:1,formatter:t.Formatters.time("%Y")}],[{interval:t.TimeInterval.month,step:6,formatter:t.Formatters.time("%b")},{interval:t.TimeInterval.year,step:1,formatter:t.Formatters.time("%Y")}],[{interval:t.TimeInterval.year,step:1,formatter:t.Formatters.time("%Y")}],[{interval:t.TimeInterval.year,step:1,formatter:t.Formatters.time("%y")}],[{interval:t.TimeInterval.year,step:5,formatter:t.Formatters.time("%Y")}],[{interval:t.TimeInterval.year,step:25,formatter:t.Formatters.time("%Y")}],[{interval:t.TimeInterval.year,step:50,formatter:t.Formatters.time("%Y")}],[{interval:t.TimeInterval.year,step:100,formatter:t.Formatters.time("%Y")}],[{interval:t.TimeInterval.year,step:200,formatter:t.Formatters.time("%Y")}],[{interval:t.TimeInterval.year,step:500,formatter:t.Formatters.time("%Y")}],[{interval:t.TimeInterval.year,step:1e3,formatter:t.Formatters.time("%Y")}]],i._LONG_DATE=new Date(9999,8,29,12,59,9999),i}(t.Axis);e.Time=i}(e=t.Axes||(t.Axes={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(i,n){e.call(this,i,n),this._tickLabelPositioning="center",this._usesTextWidthApproximation=!1,this.formatter(t.Formatters.general())}return r(i,e),i.prototype._setup=function(){e.prototype._setup.call(this),this._measurer=new o.Measurers.Measurer(this._tickLabelContainer,t.Axis.TICK_LABEL_CLASS),this._wrapper=(new o.Wrappers.Wrapper).maxLines(1)},i.prototype._computeWidth=function(){var t=this._usesTextWidthApproximation?this._computeApproximateTextWidth():this._computeExactTextWidth();return"center"===this._tickLabelPositioning?this._maxLabelTickLength()+this.tickLabelPadding()+t:Math.max(this._maxLabelTickLength(),this.tickLabelPadding()+t)},i.prototype._computeExactTextWidth=function(){var e=this,i=this._getTickValues(),n=i.map(function(t){var i=e.formatter()(t);return e._measurer.measure(i).width});return t.Utils.Math.max(n,0)},i.prototype._computeApproximateTextWidth=function(){var e=this,i=this._getTickValues(),n=this._measurer.measure("M").width,r=i.map(function(t){var i=e.formatter()(t);return i.length*n});return t.Utils.Math.max(r,0)},i.prototype._computeHeight=function(){var t=this._measurer.measure().height;return"center"===this._tickLabelPositioning?this._maxLabelTickLength()+this.tickLabelPadding()+t:Math.max(this._maxLabelTickLength(),this.tickLabelPadding()+t)},i.prototype._getTickValues=function(){var t=this._scale,e=t.domain(),i=e[0]<=e[1]?e[0]:e[1],n=e[0]>=e[1]?e[0]:e[1];return i===e[0]?t.ticks().filter(function(t){return t>=i&&n>=t}):t.ticks().filter(function(t){return t>=i&&n>=t}).reverse()},i.prototype._rescale=function(){if(this._isSetup){if(!this._isHorizontal()){var t=this._computeWidth();if(t>this.width()||t<this.width()-this.margin())return void this.redraw()}this.render()}},i.prototype.renderImmediately=function(){var i=this;e.prototype.renderImmediately.call(this);var n={x:0,y:0,dx:"0em",dy:"0.3em"},r=this._maxLabelTickLength(),o=this.tickLabelPadding(),a="middle",s=0,l=0,c=0,h=0;if(this._isHorizontal())switch(this._tickLabelPositioning){case"left":a="end",s=-o,h=o;break;case"center":h=r+o;break;case"right":a="start",s=o,h=o}else switch(this._tickLabelPositioning){case"top":n.dy="-0.3em",c=o,l=-o;break;case"center":c=r+o;break;case"bottom":n.dy="1em",c=o,l=o}var u=this._generateTickMarkAttrHash();switch(this.orientation()){case"bottom":n.x=u.x1,n.dy="0.95em",l=u.y1+h;break;case"top":n.x=u.x1,n.dy="-.25em",l=u.y1-h;break;case"left":a="end",s=u.x1-c,n.y=u.y1;break;case"right":a="start",s=u.x1+c,n.y=u.y1}var p=this._getTickValues(),d=this._tickLabelContainer.selectAll("."+t.Axis.TICK_LABEL_CLASS).data(p);d.enter().append("text").classed(t.Axis.TICK_LABEL_CLASS,!0),d.exit().remove(),d.style("text-anchor",a).style("visibility","inherit").attr(n).text(function(t){return i.formatter()(t)});var _="translate("+s+", "+l+")";return this._tickLabelContainer.attr("transform",_),this._showAllTickMarks(),this.showEndTickLabels()||this._hideEndTickLabels(),this._hideOverflowingTickLabels(),this._hideOverlappingTickLabels(),("bottom"===this._tickLabelPositioning||"top"===this._tickLabelPositioning||"left"===this._tickLabelPositioning||"right"===this._tickLabelPositioning)&&this._hideTickMarksWithoutLabel(),this},i.prototype._showAllTickMarks=function(){this._tickMarkContainer.selectAll("."+t.Axis.TICK_MARK_CLASS).each(function(){d3.select(this).style("visibility","inherit")})},i.prototype._hideTickMarksWithoutLabel=function(){var e=this._tickMarkContainer.selectAll("."+t.Axis.TICK_MARK_CLASS),i=this._tickLabelContainer.selectAll("."+t.Axis.TICK_LABEL_CLASS).filter(function(t,e){var i=d3.select(this).style("visibility");return"inherit"===i||"visible"===i}),n=[];i.each(function(t){return n.push(t)}),e.each(function(t,e){-1===n.indexOf(t)&&d3.select(this).style("visibility","hidden")})},i.prototype.tickLabelPosition=function(t){if(null==t)return this._tickLabelPositioning;var e=t.toLowerCase();if(this._isHorizontal()){if("left"!==e&&"center"!==e&&"right"!==e)throw new Error(e+" is not a valid tick label position for a horizontal NumericAxis")}else if("top"!==e&&"center"!==e&&"bottom"!==e)throw new Error(e+" is not a valid tick label position for a vertical NumericAxis");return this._tickLabelPositioning=e,this.redraw(),this},i.prototype.usesTextWidthApproximation=function(t){return null==t?this._usesTextWidthApproximation:(this._usesTextWidthApproximation=t,this)},i.prototype._hideEndTickLabels=function(){var e=this._boundingBox.node().getBoundingClientRect(),i=this._tickLabelContainer.selectAll("."+t.Axis.TICK_LABEL_CLASS);if(0!==i[0].length){var n=i[0][0];t.Utils.DOM.clientRectInside(n.getBoundingClientRect(),e)||d3.select(n).style("visibility","hidden");var r=i[0][i[0].length-1];t.Utils.DOM.clientRectInside(r.getBoundingClientRect(),e)||d3.select(r).style("visibility","hidden")}},i.prototype._hideOverflowingTickLabels=function(){var e=this._boundingBox.node().getBoundingClientRect(),i=this._tickLabelContainer.selectAll("."+t.Axis.TICK_LABEL_CLASS);i.empty()||i.each(function(i,n){t.Utils.DOM.clientRectInside(this.getBoundingClientRect(),e)||d3.select(this).style("visibility","hidden")})},i.prototype._hideOverlappingTickLabels=function(){for(var e=this._tickLabelContainer.selectAll("."+t.Axis.TICK_LABEL_CLASS).filter(function(t,e){var i=d3.select(this).style("visibility");return"inherit"===i||"visible"===i}),i=e[0].map(function(t){return t.getBoundingClientRect()}),n=1;!this._hasOverlapWithInterval(n,i)&&n<i.length;)n+=1;e.each(function(t,e){var i=d3.select(this);e%n!==0&&i.style("visibility","hidden")})},i.prototype._hasOverlapWithInterval=function(t,e){var i=this.tickLabelPadding();("bottom"===this._tickLabelPositioning||"top"===this._tickLabelPositioning||"left"===this._tickLabelPositioning||"right"===this._tickLabelPositioning)&&(i*=3);for(var n=0;n<e.length-t;n+=t){var r=e[n],o=e[n+t];if(this._isHorizontal()){if(r.right+i>=o.left)return!1}else if(r.top-i<=o.bottom)return!1}return!0},i}(t.Axis);e.Numeric=i}(e=t.Axes||(t.Axes={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(t,i){e.call(this,t,i),this._tickLabelAngle=0,this.addClass("category-axis")}return r(i,e),i.prototype._setup=function(){e.prototype._setup.call(this),this._measurer=new o.Measurers.CacheCharacterMeasurer(this._tickLabelContainer),this._wrapper=new o.Wrappers.Wrapper,this._writer=new o.Writers.Writer(this._measurer,this._wrapper)},i.prototype._rescale=function(){return this.redraw()},i.prototype.requestedSpace=function(t,e){var i=this._isHorizontal()?0:this._maxLabelTickLength()+this.tickLabelPadding()+this.margin(),n=this._isHorizontal()?this._maxLabelTickLength()+this.tickLabelPadding()+this.margin():0;if(0===this._scale.domain().length)return{minWidth:0,minHeight:0};if(this.annotationsEnabled()){var r=this._annotationTierHeight()*this.annotationTierCount();this._isHorizontal()?n+=r:i+=r}var o=this._scale,a=this._measureTicks(t,e,o,o.domain());return{minWidth:a.usedWidth+i,minHeight:a.usedHeight+n}},i.prototype._coreSize=function(){var t=this._isHorizontal()?this.height():this.width(),e=this._isHorizontal()?this.requestedSpace(this.width(),this.height()).minHeight:this.requestedSpace(this.width(),this.height()).minWidth,i=this.margin()+this._annotationTierHeight(),n=e-i;return Math.min(n,t)},i.prototype._getTickValues=function(){return this._scale.domain()},i.prototype.tickLabelAngle=function(t){if(null==t)return this._tickLabelAngle;if(0!==t&&90!==t&&-90!==t)throw new Error("Angle "+t+" not supported; only 0, 90, and -90 are valid values");return this._tickLabelAngle=t,this.redraw(),this},i.prototype._drawTicks=function(t,e,i,n){var r,o,a=this;switch(this.tickLabelAngle()){case 0:r={left:"right",right:"left",top:"center",bottom:"center"},o={left:"center",right:"center",top:"bottom",bottom:"top"};break;case 90:r={left:"center",right:"center",top:"right",bottom:"left"},o={left:"top",right:"bottom",top:"center",bottom:"center"};break;case-90:r={left:"center",right:"center",top:"left",bottom:"right"},o={left:"bottom",right:"top",top:"center",bottom:"center"}}n.each(function(n){var s=i.stepWidth(),l=a._isHorizontal()?s:t-a._maxLabelTickLength()-a.tickLabelPadding(),c=a._isHorizontal()?e-a._maxLabelTickLength()-a.tickLabelPadding():s,h={selection:d3.select(this),xAlign:r[a.orientation()],yAlign:o[a.orientation()],textRotation:a.tickLabelAngle()};a._writer.write(a.formatter()(n),l,c,h)})},i.prototype._measureTicks=function(e,i,n,r){var a=this,s=this._isHorizontal()?e:i,l=2*n.outerPadding(),c=(r.length-1)*n.innerPadding(),h=s/(l+c+r.length),u=h*(1+n.innerPadding()),p=r.map(function(t){var n=e-a._maxLabelTickLength()-a.tickLabelPadding();a._isHorizontal()&&(n=u,0!==a._tickLabelAngle&&(n=i-a._maxLabelTickLength()-a.tickLabelPadding()),n=Math.max(n,0));var r=u;return a._isHorizontal()&&(r=i-a._maxLabelTickLength()-a.tickLabelPadding(),0!==a._tickLabelAngle&&(r=e-a._maxLabelTickLength()-a.tickLabelPadding()),r=Math.max(r,0)),a._wrapper.wrap(a.formatter()(t),a._measurer,n,r)}),d=this._isHorizontal()&&0===this._tickLabelAngle?d3.sum:t.Utils.Math.max,_=this._isHorizontal()&&0===this._tickLabelAngle?t.Utils.Math.max:d3.sum,f=p.every(function(t){return!o.Utils.StringMethods.isNotEmptyString(t.truncatedText)&&1===t.noLines}),y=d(p,function(t){return a._measurer.measure(t.wrappedText).width},0),m=_(p,function(t){return a._measurer.measure(t.wrappedText).height},0);if(0!==this._tickLabelAngle){var g=m;m=y,y=g}return{textFits:f,usedWidth:y,usedHeight:m}},i.prototype.renderImmediately=function(){var i=this;e.prototype.renderImmediately.call(this);var n=this._scale,r=this._tickLabelContainer.selectAll("."+t.Axis.TICK_LABEL_CLASS).data(this._scale.domain(),function(t){return t}),o=function(t,e){var r=n.stepWidth()-n.rangeBand(),o=n.scale(t)-n.rangeBand()/2-r/2,a=i._isHorizontal()?o:0,s=i._isHorizontal()?0:o;return"translate("+a+","+s+")"};r.enter().append("g").classed(t.Axis.TICK_LABEL_CLASS,!0),r.exit().remove(),r.attr("transform",o),r.text(""),this._drawTicks(this.width(),this.height(),n,r);var a="right"===this.orientation()?this._maxLabelTickLength()+this.tickLabelPadding():0,s="bottom"===this.orientation()?this._maxLabelTickLength()+this.tickLabelPadding():0;return t.Utils.DOM.translate(this._tickLabelContainer,a,s),this},i.prototype.computeLayout=function(t,i,n){return this._measurer.reset(),e.prototype.computeLayout.call(this,t,i,n),this._isHorizontal()||this._scale.range([0,this.height()]),this},i}(t.Axis);e.Category=i}(e=t.Axes||(t.Axes={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(t){function e(e,i){void 0===e&&(e=""),void 0===i&&(i=0),t.call(this),this.addClass("label"),this.text(e),this.angle(i),this.xAlignment("center").yAlignment("center"),this._padding=0}return r(e,t),e.prototype.requestedSpace=function(t,e){var i=this._measurer.measure(this._text),n=(0===this.angle()?i.width:i.height)+2*this.padding(),r=(0===this.angle()?i.height:i.width)+2*this.padding();return{minWidth:n,minHeight:r}},e.prototype._setup=function(){t.prototype._setup.call(this),this._textContainer=this.content().append("g"),this._measurer=new o.Measurers.Measurer(this._textContainer),this._wrapper=new o.Wrappers.Wrapper,this._writer=new o.Writers.Writer(this._measurer,this._wrapper),this.text(this._text)},e.prototype.text=function(t){if(null==t)return this._text;if("string"!=typeof t)throw new Error("Label.text() only takes strings as input");return this._text=t,this.redraw(),this},e.prototype.angle=function(t){if(null==t)return this._angle;if(t%=360,t>180?t-=360:-180>t&&(t+=360),-90!==t&&0!==t&&90!==t)throw new Error(t+" is not a valid angle for Label");return this._angle=t,this.redraw(),this},e.prototype.padding=function(t){if(null==t)return this._padding;if(t=+t,0>t)throw new Error(t+" is not a valid padding value. Cannot be less than 0.");return this._padding=t,this.redraw(),this},e.prototype.fixedWidth=function(){return!0},e.prototype.fixedHeight=function(){return!0},e.prototype.renderImmediately=function(){t.prototype.renderImmediately.call(this),this._textContainer.selectAll("g").remove();var e=this._measurer.measure(this._text),i=Math.max(Math.min((this.height()-e.height)/2,this.padding()),0),n=Math.max(Math.min((this.width()-e.width)/2,this.padding()),0);this._textContainer.attr("transform","translate("+n+","+i+")");var r=this.width()-2*n,o=this.height()-2*i,a={selection:this._textContainer,xAlign:this.xAlignment(),yAlign:this.yAlignment(),textRotation:this.angle()};return this._writer.write(this._text,r,o,a),this},e}(t.Component);e.Label=i;var n=function(t){function e(i,n){t.call(this,i,n),this.addClass(e.TITLE_LABEL_CLASS)}return r(e,t),e.TITLE_LABEL_CLASS="title-label",e}(i);e.TitleLabel=n;var a=function(t){function e(i,n){t.call(this,i,n),this.addClass(e.AXIS_LABEL_CLASS)}return r(e,t),e.AXIS_LABEL_CLASS="axis-label",e}(i);e.AxisLabel=a}(e=t.Components||(t.Components={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(i){var n=this;if(e.call(this),this._padding=5,this.addClass("legend"),this.maxEntriesPerRow(1),null==i)throw new Error("Legend requires a colorScale");this._colorScale=i,this._redrawCallback=function(t){return n.redraw()},this._colorScale.onUpdate(this._redrawCallback),this._formatter=t.Formatters.identity(),this.xAlignment("right").yAlignment("top"),this.comparator(function(t,e){var i=n._colorScale.domain().slice().map(function(t){return n._formatter(t)});return i.indexOf(t)-i.indexOf(e)}),this._symbolFactoryAccessor=function(){return t.SymbolFactories.circle()},this._symbolOpacityAccessor=function(){return 1}}return r(i,e),i.prototype._setup=function(){e.prototype._setup.call(this);var n=this.content().append("g").classed(i.LEGEND_ROW_CLASS,!0),r=n.append("g").classed(i.LEGEND_ENTRY_CLASS,!0);r.append("text"),this._measurer=new o.Measurers.Measurer(n),this._wrapper=(new o.Wrappers.Wrapper).maxLines(1),this._writer=new o.Writers.Writer(this._measurer,this._wrapper).addTitleElement(t.Configs.ADD_TITLE_ELEMENTS)},i.prototype.formatter=function(t){return null==t?this._formatter:(this._formatter=t,this.redraw(),this)},i.prototype.maxEntriesPerRow=function(t){return null==t?this._maxEntriesPerRow:(this._maxEntriesPerRow=t,this.redraw(),this)},i.prototype.comparator=function(t){return null==t?this._comparator:(this._comparator=t,this.redraw(),this)},i.prototype.colorScale=function(t){return null!=t?(this._colorScale.offUpdate(this._redrawCallback),this._colorScale=t,this._colorScale.onUpdate(this._redrawCallback),this.redraw(),this):this._colorScale},i.prototype.destroy=function(){e.prototype.destroy.call(this),this._colorScale.offUpdate(this._redrawCallback)},i.prototype._calculateLayoutInfo=function(t,e){var i=this,n=this._measurer.measure().height,r=Math.max(0,t-this._padding),o=this._colorScale.domain().slice().sort(function(t,e){return i._comparator(i._formatter(t),i._formatter(e))}),a=d3.map(),s=d3.map();o.forEach(function(t){var e=n+i._measurer.measure(i._formatter(t)).width+i._padding,o=Math.min(e,r);a.set(t,o),s.set(t,e)});var l=this._packRows(r,o,a),c=Math.floor((e-2*this._padding)/n);return c!==c&&(c=0),{textHeight:n,entryLengths:a,untruncatedEntryLengths:s,rows:l,numRowsToDraw:Math.max(Math.min(c,l.length),0)}},i.prototype.requestedSpace=function(e,i){var n=this._calculateLayoutInfo(e,i),r=n.rows.map(function(t){return d3.sum(t,function(t){return n.untruncatedEntryLengths.get(t)})}),o=t.Utils.Math.max(r,0);return{minWidth:this._padding+o,minHeight:n.rows.length*n.textHeight+2*this._padding}},i.prototype._packRows=function(t,e,i){var n=this,r=[],o=[],a=t;return e.forEach(function(e){var s=i.get(e);(s>a||o.length===n._maxEntriesPerRow)&&(r.push(o),o=[],a=t),o.push(e),a-=s}),0!==o.length&&r.push(o),r},i.prototype.entitiesAt=function(t){if(!this._isSetup)return[];var e=[],n=this._calculateLayoutInfo(this.width(),this.height()),r=this._padding,o=this;return this.content().selectAll("g."+i.LEGEND_ROW_CLASS).each(function(a,s){var l=s*n.textHeight+r,c=(s+1)*n.textHeight+r,h=(l+c)/2,u=r,p=r;d3.select(this).selectAll("g."+i.LEGEND_ENTRY_CLASS).each(function(i){p+=n.entryLengths.get(i);var r=u+n.textHeight/2;if(p>=t.x&&u<=t.x&&c>=t.y&&l<=t.y){var a=d3.select(this),s=a.datum();e.push({datum:s,position:{x:r,y:h},selection:a,component:o})}u+=n.entryLengths.get(i)})}),e},i.prototype.renderImmediately=function(){var t=this;e.prototype.renderImmediately.call(this);var n=this._calculateLayoutInfo(this.width(),this.height()),r=n.rows.slice(0,n.numRowsToDraw),o=this.content().selectAll("g."+i.LEGEND_ROW_CLASS).data(r);o.enter().append("g").classed(i.LEGEND_ROW_CLASS,!0),o.exit().remove(),o.attr("transform",function(e,i){return"translate(0, "+(i*n.textHeight+t._padding)+")"});var a=o.selectAll("g."+i.LEGEND_ENTRY_CLASS).data(function(t){return t}),s=a.enter().append("g").classed(i.LEGEND_ENTRY_CLASS,!0);s.append("path"),s.append("g").classed("text-container",!0),a.exit().remove();var l=this._padding;o.each(function(t){var e=l,r=d3.select(this).selectAll("g."+i.LEGEND_ENTRY_CLASS);r.attr("transform",function(t,i){var r="translate("+e+", 0)";return e+=n.entryLengths.get(t),r})}),a.select("path").attr("d",function(e,i,r){return t.symbol()(e,r)(.6*n.textHeight)}).attr("transform","translate("+n.textHeight/2+","+n.textHeight/2+")").attr("fill",function(e){return t._colorScale.scale(e)}).attr("opacity",function(e,i,n){return t.symbolOpacity()(e,n)}).classed(i.LEGEND_SYMBOL_CLASS,!0);var c=this._padding,h=a.select("g.text-container");h.text("");var u=this;return h.attr("transform","translate("+n.textHeight+", 0)").each(function(t){var e=d3.select(this),i=n.entryLengths.get(t)-n.textHeight-c,r={selection:e,xAlign:"left",yAlign:"top",textRotation:0};u._writer.write(u._formatter(t),i,u.height(),r)}),this},i.prototype.symbol=function(t){return null==t?this._symbolFactoryAccessor:(this._symbolFactoryAccessor=t,this.render(),this)},i.prototype.symbolOpacity=function(t){return null==t?this._symbolOpacityAccessor:("number"==typeof t?this._symbolOpacityAccessor=function(){return t}:this._symbolOpacityAccessor=t,this.render(),this)},i.prototype.fixedWidth=function(){return!0},i.prototype.fixedHeight=function(){return!0},i.LEGEND_ROW_CLASS="legend-row",i.LEGEND_ENTRY_CLASS="legend-entry",i.LEGEND_SYMBOL_CLASS="legend-symbol",i}(t.Component);e.Legend=i}(e=t.Components||(t.Components={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(i){var n=this;if(e.call(this),this._textPadding=5,null==i)throw new Error("InterpolatedColorLegend requires a interpolatedColorScale");this._scale=i,this._redrawCallback=function(t){return n.redraw()},this._scale.onUpdate(this._redrawCallback),this._formatter=t.Formatters.general(),this._orientation="horizontal",this._expands=!1,this.addClass("legend"),this.addClass("interpolated-color-legend")}return r(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._scale.offUpdate(this._redrawCallback)},i.prototype.formatter=function(t){return void 0===t?this._formatter:(this._formatter=t,this.redraw(),this)},i.prototype.expands=function(t){return null==t?this._expands:(this._expands=t,this.redraw(),this)},i._ensureOrientation=function(t){if(t=t.toLowerCase(),"horizontal"===t||"left"===t||"right"===t)return t;throw new Error('"'+t+'" is not a valid orientation for InterpolatedColorLegend')},i.prototype.orientation=function(t){return null==t?this._orientation:(this._orientation=i._ensureOrientation(t),this.redraw(),this)},i.prototype.fixedWidth=function(){return!this.expands()||this._isVertical()},i.prototype.fixedHeight=function(){return!this.expands()||!this._isVertical()},i.prototype._generateTicks=function(t){void 0===t&&(t=i._DEFAULT_NUM_SWATCHES);var e=this._scale.domain();if(1===t)return[e[0]];for(var n=(e[1]-e[0])/(t-1),r=[],o=0;t>o;o++)r.push(e[0]+n*o);return r},i.prototype._setup=function(){e.prototype._setup.call(this),this._swatchContainer=this.content().append("g").classed("swatch-container",!0),this._swatchBoundingBox=this.content().append("rect").classed("swatch-bounding-box",!0),this._lowerLabel=this.content().append("g").classed(i.LEGEND_LABEL_CLASS,!0),this._upperLabel=this.content().append("g").classed(i.LEGEND_LABEL_CLASS,!0),this._measurer=new o.Measurers.Measurer(this.content()),this._wrapper=new o.Wrappers.Wrapper,this._writer=new o.Writers.Writer(this._measurer,this._wrapper)},i.prototype.requestedSpace=function(e,n){var r,o,a=this,s=this._measurer.measure().height,l=s,c=this._scale.domain(),h=c.map(function(t){return a._measurer.measure(a._formatter(t)).width}),u=i._DEFAULT_NUM_SWATCHES;if(this._isVertical()){var p=t.Utils.Math.max(h,0);o=l+s+this._textPadding+p+this._textPadding,r=u*s}else r=l+s+l,o=this._textPadding+h[0]+u*s+h[1]+this._textPadding;return{minWidth:o,minHeight:r}},i.prototype._isVertical=function(){return"horizontal"!==this._orientation},i.prototype.renderImmediately=function(){var i=this;e.prototype.renderImmediately.call(this);var n,r,o,a,s,l,c=this._scale.domain(),h=this._formatter(c[0]),u=this._measurer.measure(h).width,p=this._formatter(c[1]),d=this._measurer.measure(p).width,_=this._measurer.measure().height,f=this._textPadding,y={x:0,y:0},m={x:0,y:0},g={selection:this._lowerLabel,xAlign:"center",yAlign:"center",textRotation:0},v={selection:this._upperLabel,xAlign:"center",yAlign:"center",textRotation:0},x={x:0,y:0,width:0,height:0};if(this._isVertical()){l=Math.floor(this.height());var b=Math.max(u,d);s=(this.width()-b-2*this._textPadding)/2,n=Math.max(this.width()-s-2*f-b,0),r=1,a=function(t,e){return i.height()-(e+1)},v.yAlign="top",y.y=0,g.yAlign="bottom",m.y=0,"left"===this._orientation?(o=function(t,e){return f+b+f},v.xAlign="right",y.x=-(s+n+f),g.xAlign="right",m.x=-(s+n+f)):(o=function(t,e){return s},v.xAlign="left",y.x=s+n+f,g.xAlign="left",m.x=s+n+f),x.width=n,x.height=l*r}else s=Math.max(f,(this.height()-_)/2),l=Math.max(Math.floor(this.width()-4*f-u-d),0),n=1,r=Math.max(this.height()-2*s,0),o=function(t,e){return Math.floor(u+2*f)+e},a=function(t,e){return s},v.xAlign="right",y.x=-f,g.xAlign="left",m.x=f,x.y=s,x.width=l*n,x.height=r;x.x=o(null,0),this._upperLabel.text(""),this._writer.write(p,this.width(),this.height(),v);var E="translate("+y.x+", "+y.y+")";this._upperLabel.attr("transform",E),this._lowerLabel.text(""),this._writer.write(h,this.width(),this.height(),g);var A="translate("+m.x+", "+m.y+")";this._lowerLabel.attr("transform",A),this._swatchBoundingBox.attr(x);var C=this._generateTicks(l),w=this._swatchContainer.selectAll("rect.swatch").data(C),T=w.enter().append("rect").classed("swatch",!0);return w.exit().remove(),w.attr({fill:function(t,e){return i._scale.scale(t)},width:n,height:r,x:o,y:a,"shape-rendering":"crispEdges"}),t.Configs.ADD_TITLE_ELEMENTS&&T.append("title").text(function(t){return i._formatter(t)}),this},i._DEFAULT_NUM_SWATCHES=11,i.LEGEND_LABEL_CLASS="legend-label",i}(t.Component);e.InterpolatedColorLegend=i}(e=t.Components||(t.Components={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(i,n){var r=this;if(null!=i&&!t.QuantitativeScale.prototype.isPrototypeOf(i))throw new Error("xScale needs to inherit from Scale.QuantitativeScale");if(null!=n&&!t.QuantitativeScale.prototype.isPrototypeOf(n))throw new Error("yScale needs to inherit from Scale.QuantitativeScale");e.call(this),this.addClass("gridlines"),this._xScale=i,this._yScale=n,this._renderCallback=function(t){return r.render()},this._xScale&&this._xScale.onUpdate(this._renderCallback),this._yScale&&this._yScale.onUpdate(this._renderCallback)}return r(i,e),i.prototype.destroy=function(){return e.prototype.destroy.call(this),this._xScale&&this._xScale.offUpdate(this._renderCallback),this._yScale&&this._yScale.offUpdate(this._renderCallback),this},i.prototype._setup=function(){e.prototype._setup.call(this),this._xLinesContainer=this.content().append("g").classed("x-gridlines",!0),this._yLinesContainer=this.content().append("g").classed("y-gridlines",!0)},i.prototype.renderImmediately=function(){return e.prototype.renderImmediately.call(this),this._redrawXLines(),this._redrawYLines(),this},i.prototype.computeLayout=function(t,i,n){return e.prototype.computeLayout.call(this,t,i,n),null!=this._xScale&&this._xScale.range([0,this.width()]),null!=this._yScale&&this._yScale.range([this.height(),0]),this},i.prototype._redrawXLines=function(){var t=this;if(this._xScale){var e=this._xScale.ticks(),i=function(e){return t._xScale.scale(e)},n=this._xLinesContainer.selectAll("line").data(e);n.enter().append("line"),n.attr("x1",i).attr("y1",0).attr("x2",i).attr("y2",this.height()).classed("zeroline",function(t){return 0===t}),n.exit().remove()}},i.prototype._redrawYLines=function(){var t=this;if(this._yScale){var e=this._yScale.ticks(),i=function(e){return t._yScale.scale(e);
},n=this._yLinesContainer.selectAll("line").data(e);n.enter().append("line"),n.attr("x1",0).attr("y1",i).attr("x2",this.width()).attr("y2",i).classed("zeroline",function(t){return 0===t}),n.exit().remove()}},i}(t.Component);e.Gridlines=i}(e=t.Components||(t.Components={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(t){var i=this;void 0===t&&(t=[]),e.call(this),this._rowPadding=0,this._columnPadding=0,this._rows=[],this._rowWeights=[],this._columnWeights=[],this._nRows=0,this._nCols=0,this._calculatedLayout=null,this.addClass("table"),t.forEach(function(t,e){t.forEach(function(t,n){null!=t&&i.add(t,e,n)})})}return r(i,e),i.prototype._forEach=function(t){for(var e=0;e<this._nRows;e++)for(var i=0;i<this._nCols;i++)null!=this._rows[e][i]&&t(this._rows[e][i])},i.prototype.has=function(t){for(var e=0;e<this._nRows;e++)for(var i=0;i<this._nCols;i++)if(this._rows[e][i]===t)return!0;return!1},i.prototype.componentAt=function(t,e){return 0>t||t>=this._nRows||0>e||e>=this._nCols?null:this._rows[t][e]},i.prototype.add=function(t,e,i){if(null==t)throw Error("Cannot add null to a table cell");if(!this.has(t)){var n=this._rows[e]&&this._rows[e][i];if(null!=n)throw new Error("cell is occupied");t.detach(),this._nRows=Math.max(e+1,this._nRows),this._nCols=Math.max(i+1,this._nCols),this._padTableToSize(this._nRows,this._nCols),this._rows[e][i]=t,this._adoptAndAnchor(t),this.redraw()}return this},i.prototype._remove=function(t){for(var e=0;e<this._nRows;e++)for(var i=0;i<this._nCols;i++)if(this._rows[e][i]===t)return this._rows[e][i]=null,!0;return!1},i.prototype._iterateLayout=function(e,n,r){void 0===r&&(r=!1);for(var o,a,s,l,c,h=this._rows,u=d3.transpose(this._rows),p=e-this._columnPadding*(this._nCols-1),d=n-this._rowPadding*(this._nRows-1),_=i._calcComponentWeights(this._rowWeights,h,function(t){return null==t||t.fixedHeight()}),f=i._calcComponentWeights(this._columnWeights,u,function(t){return null==t||t.fixedWidth()}),y=f.map(function(t){return 0===t?.5:t}),m=_.map(function(t){return 0===t?.5:t}),g=i._calcProportionalSpace(y,p),v=i._calcProportionalSpace(m,d),x=t.Utils.Array.createFilledArray(0,this._nCols),b=t.Utils.Array.createFilledArray(0,this._nRows),E=0;;){var A=t.Utils.Array.add(b,v),C=t.Utils.Array.add(x,g);s=this._determineGuarantees(C,A,r),x=s.guaranteedWidths,b=s.guaranteedHeights,l=s.wantsWidthArr.some(function(t){return t}),c=s.wantsHeightArr.some(function(t){return t});var w=o,T=a;o=p-d3.sum(s.guaranteedWidths),a=d-d3.sum(s.guaranteedHeights);var S=void 0;l?(S=s.wantsWidthArr.map(function(t){return t?.1:0}),S=t.Utils.Array.add(S,f)):S=f;var k=void 0;c?(k=s.wantsHeightArr.map(function(t){return t?.1:0}),k=t.Utils.Array.add(k,_)):k=_,g=i._calcProportionalSpace(S,o),v=i._calcProportionalSpace(k,a),E++;var D=o>0&&o!==w,L=a>0&&a!==T;if(!D&&!L)break;if(E>5)break}return o=p-d3.sum(s.guaranteedWidths),a=d-d3.sum(s.guaranteedHeights),g=i._calcProportionalSpace(f,o),v=i._calcProportionalSpace(_,a),{colProportionalSpace:g,rowProportionalSpace:v,guaranteedWidths:s.guaranteedWidths,guaranteedHeights:s.guaranteedHeights,wantsWidth:l,wantsHeight:c}},i.prototype._determineGuarantees=function(e,i,n){void 0===n&&(n=!1);var r=t.Utils.Array.createFilledArray(0,this._nCols),o=t.Utils.Array.createFilledArray(0,this._nRows),a=t.Utils.Array.createFilledArray(!1,this._nCols),s=t.Utils.Array.createFilledArray(!1,this._nRows);return this._rows.forEach(function(t,l){t.forEach(function(t,c){var h;h=null!=t?t.requestedSpace(e[c],i[l]):{minWidth:0,minHeight:0};var u=n?Math.min(h.minWidth,e[c]):h.minWidth;r[c]=Math.max(r[c],u);var p=n?Math.min(h.minHeight,i[l]):h.minHeight;o[l]=Math.max(o[l],p);var d=h.minWidth>e[c];a[c]=a[c]||d;var _=h.minHeight>i[l];s[l]=s[l]||_})}),{guaranteedWidths:r,guaranteedHeights:o,wantsWidthArr:a,wantsHeightArr:s}},i.prototype.requestedSpace=function(t,e){return this._calculatedLayout=this._iterateLayout(t,e),{minWidth:d3.sum(this._calculatedLayout.guaranteedWidths),minHeight:d3.sum(this._calculatedLayout.guaranteedHeights)}},i.prototype.computeLayout=function(i,n,r){var o=this;e.prototype.computeLayout.call(this,i,n,r);var a=d3.sum(this._calculatedLayout.guaranteedWidths),s=d3.sum(this._calculatedLayout.guaranteedHeights),l=this._calculatedLayout;(a>this.width()||s>this.height())&&(l=this._iterateLayout(this.width(),this.height(),!0));var c=0,h=t.Utils.Array.add(l.rowProportionalSpace,l.guaranteedHeights),u=t.Utils.Array.add(l.colProportionalSpace,l.guaranteedWidths);return this._rows.forEach(function(t,e){var i=0;t.forEach(function(t,n){null!=t&&t.computeLayout({x:i,y:c},u[n],h[e]),i+=u[n]+o._columnPadding}),c+=h[e]+o._rowPadding}),this},i.prototype.rowPadding=function(e){if(null==e)return this._rowPadding;if(!t.Utils.Math.isValidNumber(e)||0>e)throw Error("rowPadding must be a non-negative finite value");return this._rowPadding=e,this.redraw(),this},i.prototype.columnPadding=function(e){if(null==e)return this._columnPadding;if(!t.Utils.Math.isValidNumber(e)||0>e)throw Error("columnPadding must be a non-negative finite value");return this._columnPadding=e,this.redraw(),this},i.prototype.rowWeight=function(e,i){if(null==i)return this._rowWeights[e];if(!t.Utils.Math.isValidNumber(i)||0>i)throw Error("rowWeight must be a non-negative finite value");return this._rowWeights[e]=i,this.redraw(),this},i.prototype.columnWeight=function(e,i){if(null==i)return this._columnWeights[e];if(!t.Utils.Math.isValidNumber(i)||0>i)throw Error("columnWeight must be a non-negative finite value");return this._columnWeights[e]=i,this.redraw(),this},i.prototype.fixedWidth=function(){var t=d3.transpose(this._rows);return i._fixedSpace(t,function(t){return null==t||t.fixedWidth()})},i.prototype.fixedHeight=function(){return i._fixedSpace(this._rows,function(t){return null==t||t.fixedHeight()})},i.prototype._padTableToSize=function(t,e){for(var i=0;t>i;i++){void 0===this._rows[i]&&(this._rows[i]=[],this._rowWeights[i]=null);for(var n=0;e>n;n++)void 0===this._rows[i][n]&&(this._rows[i][n]=null)}for(var n=0;e>n;n++)void 0===this._columnWeights[n]&&(this._columnWeights[n]=null)},i._calcComponentWeights=function(t,e,i){return t.map(function(t,n){if(null!=t)return t;var r=e[n].map(i),o=r.reduce(function(t,e){return t&&e},!0);return o?0:1})},i._calcProportionalSpace=function(e,i){var n=d3.sum(e);return 0===n?t.Utils.Array.createFilledArray(0,e.length):e.map(function(t){return i*t/n})},i._fixedSpace=function(t,e){var i=function(t){return t.reduce(function(t,e){return t&&e},!0)},n=function(t){return i(t.map(e))};return i(t.map(n))},i}(t.ComponentContainer);e.Table=i}(e=t.Components||(t.Components={}))}(n||(n={}));var n;!function(t){var e;!function(e){!function(t){t[t.VALUE=0]="VALUE",t[t.PIXEL=1]="PIXEL"}(e.PropertyMode||(e.PropertyMode={}));var i=e.PropertyMode,n=function(e){function n(){var t=this;e.call(this),this._boxVisible=!1,this._boxBounds={topLeft:{x:0,y:0},bottomRight:{x:0,y:0}},this._xBoundsMode=i.PIXEL,this._yBoundsMode=i.PIXEL,this.addClass("selection-box-layer"),this._adjustBoundsCallback=function(){t.render()},this._clipPathEnabled=!0,this._xExtent=[void 0,void 0],this._yExtent=[void 0,void 0]}return r(n,e),n.prototype._setup=function(){e.prototype._setup.call(this),this._box=this.content().append("g").classed("selection-box",!0).remove(),this._boxArea=this._box.append("rect").classed("selection-area",!0)},n.prototype._sizeFromOffer=function(t,e){return{width:t,height:e}},n.prototype.bounds=function(t){return null==t?this._getBounds():(this._setBounds(t),this._xBoundsMode=i.PIXEL,this._yBoundsMode=i.PIXEL,this.render(),this)},n.prototype._setBounds=function(t){var e={x:Math.min(t.topLeft.x,t.bottomRight.x),y:Math.min(t.topLeft.y,t.bottomRight.y)},i={x:Math.max(t.topLeft.x,t.bottomRight.x),y:Math.max(t.topLeft.y,t.bottomRight.y)};this._boxBounds={topLeft:e,bottomRight:i}},n.prototype._getBounds=function(){return{topLeft:{x:this._xBoundsMode===i.PIXEL?this._boxBounds.topLeft.x:null==this._xScale?0:Math.min(this.xScale().scale(this.xExtent()[0]),this.xScale().scale(this.xExtent()[1])),y:this._yBoundsMode===i.PIXEL?this._boxBounds.topLeft.y:null==this._yScale?0:Math.min(this.yScale().scale(this.yExtent()[0]),this.yScale().scale(this.yExtent()[1]))},bottomRight:{x:this._xBoundsMode===i.PIXEL?this._boxBounds.bottomRight.x:null==this._xScale?0:Math.max(this.xScale().scale(this.xExtent()[0]),this.xScale().scale(this.xExtent()[1])),y:this._yBoundsMode===i.PIXEL?this._boxBounds.bottomRight.y:null==this._yScale?0:Math.max(this.yScale().scale(this.yExtent()[0]),this.yScale().scale(this.yExtent()[1]))}}},n.prototype.renderImmediately=function(){if(e.prototype.renderImmediately.call(this),this._boxVisible){var i=this.bounds(),n=i.topLeft.y,r=i.bottomRight.y,o=i.topLeft.x,a=i.bottomRight.x;if(!(t.Utils.Math.isValidNumber(n)&&t.Utils.Math.isValidNumber(r)&&t.Utils.Math.isValidNumber(o)&&t.Utils.Math.isValidNumber(a)))throw new Error("bounds have not been properly set");this._boxArea.attr({x:o,y:n,width:a-o,height:r-n}),this.content().node().appendChild(this._box.node())}else this._box.remove();return this},n.prototype.boxVisible=function(t){return null==t?this._boxVisible:(this._boxVisible=t,this.render(),this)},n.prototype.fixedWidth=function(){return!0},n.prototype.fixedHeight=function(){return!0},n.prototype.xScale=function(t){return null==t?this._xScale:(null!=this._xScale&&this._xScale.offUpdate(this._adjustBoundsCallback),this._xScale=t,this._xBoundsMode=i.VALUE,this._xScale.onUpdate(this._adjustBoundsCallback),this.render(),this)},n.prototype.yScale=function(t){return null==t?this._yScale:(null!=this._yScale&&this._yScale.offUpdate(this._adjustBoundsCallback),this._yScale=t,this._yBoundsMode=i.VALUE,this._yScale.onUpdate(this._adjustBoundsCallback),this.render(),this)},n.prototype.xExtent=function(t){return null==t?this._getXExtent():(this._setXExtent(t),this._xBoundsMode=i.VALUE,this.render(),this)},n.prototype._getXExtent=function(){return this._xBoundsMode===i.VALUE?this._xExtent:null==this._xScale?[void 0,void 0]:[this._xScale.invert(this._boxBounds.topLeft.x),this._xScale.invert(this._boxBounds.bottomRight.x)]},n.prototype._setXExtent=function(t){this._xExtent=t},n.prototype.yExtent=function(t){return null==t?this._getYExtent():(this._setYExtent(t),this._yBoundsMode=i.VALUE,this.render(),this)},n.prototype._getYExtent=function(){return this._yBoundsMode===i.VALUE?this._yExtent:null==this._yScale?[void 0,void 0]:[this._yScale.invert(this._boxBounds.topLeft.y),this._yScale.invert(this._boxBounds.bottomRight.y)]},n.prototype._setYExtent=function(t){this._yExtent=t},n.prototype.destroy=function(){e.prototype.destroy.call(this),null!=this._xScale&&this.xScale().offUpdate(this._adjustBoundsCallback),null!=this._yScale&&this.yScale().offUpdate(this._adjustBoundsCallback)},n}(t.Component);e.SelectionBoxLayer=n}(e=t.Components||(t.Components={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i;!function(t){t[t.VALUE=0]="VALUE",t[t.PIXEL=1]="PIXEL"}(i||(i={}));var n=function(e){function n(t){var r=this;if(e.call(this),this._mode=i.VALUE,t!==n.ORIENTATION_VERTICAL&&t!==n.ORIENTATION_HORIZONTAL)throw new Error(t+" is not a valid orientation for GuideLineLayer");this._orientation=t,this._clipPathEnabled=!0,this.addClass("guide-line-layer"),this._isVertical()?this.addClass("vertical"):this.addClass("horizontal"),this._scaleUpdateCallback=function(){r._syncPixelPositionAndValue(),r.render()}}return r(n,e),n.prototype._setup=function(){e.prototype._setup.call(this),this._guideLine=this.content().append("line").classed("guide-line",!0)},n.prototype._sizeFromOffer=function(t,e){return{width:t,height:e}},n.prototype._isVertical=function(){return this._orientation===n.ORIENTATION_VERTICAL},n.prototype.fixedWidth=function(){return!0},n.prototype.fixedHeight=function(){return!0},n.prototype.computeLayout=function(t,i,n){return e.prototype.computeLayout.call(this,t,i,n),null!=this.scale()&&(this._isVertical()?this.scale().range([0,this.width()]):this.scale().range([this.height(),0])),this},n.prototype.renderImmediately=function(){return e.prototype.renderImmediately.call(this),this._syncPixelPositionAndValue(),this._guideLine.attr({x1:this._isVertical()?this.pixelPosition():0,y1:this._isVertical()?0:this.pixelPosition(),x2:this._isVertical()?this.pixelPosition():this.width(),y2:this._isVertical()?this.height():this.pixelPosition()}),this},n.prototype._syncPixelPositionAndValue=function(){null!=this.scale()&&(this._mode===i.VALUE&&null!=this.value()?this._pixelPosition=this.scale().scale(this.value()):this._mode===i.PIXEL&&null!=this.pixelPosition()&&(this._value=this.scale().invert(this.pixelPosition())))},n.prototype._setPixelPositionWithoutChangingMode=function(t){this._pixelPosition=t,null!=this.scale()&&(this._value=this.scale().invert(this.pixelPosition())),this.render()},n.prototype.scale=function(t){if(null==t)return this._scale;var e=this._scale;return null!=e&&e.offUpdate(this._scaleUpdateCallback),this._scale=t,this._scale.onUpdate(this._scaleUpdateCallback),this._syncPixelPositionAndValue(),this.redraw(),this},n.prototype.value=function(t){return null==t?this._value:(this._value=t,this._mode=i.VALUE,this._syncPixelPositionAndValue(),this.render(),this)},n.prototype.pixelPosition=function(e){if(null==e)return this._pixelPosition;if(!t.Utils.Math.isValidNumber(e))throw new Error("pixelPosition must be a finite number");return this._pixelPosition=e,this._mode=i.PIXEL,this._syncPixelPositionAndValue(),this.render(),this},n.prototype.destroy=function(){e.prototype.destroy.call(this),null!=this.scale()&&this.scale().offUpdate(this._scaleUpdateCallback)},n.ORIENTATION_VERTICAL="vertical",n.ORIENTATION_HORIZONTAL="horizontal",n}(t.Component);e.GuideLineLayer=n}(e=t.Components||(t.Components={}))}(n||(n={}));var n;!function(t){var e;!function(t){var e;!function(t){t.MAIN="main",t.RESET="reset"}(e=t.Animator||(t.Animator={}))}(e=t.Plots||(t.Plots={}))}(n||(n={}));var n;!function(t){var e=function(e){function i(){var n=this;e.call(this),this._dataChanged=!1,this._animate=!1,this._animators={},this._clipPathEnabled=!0,this.addClass("plot"),this._datasetToDrawer=new t.Utils.Map,this._attrBindings=d3.map(),this._attrExtents=d3.map(),this._includedValuesProvider=function(t){return n._includedValuesForScale(t)},this._renderCallback=function(t){return n.render()},this._onDatasetUpdateCallback=function(){return n._onDatasetUpdate()},this._propertyBindings=d3.map(),this._propertyExtents=d3.map();var r=(new t.Animators.Easing).maxTotalDuration(i._ANIMATION_MAX_DURATION);this.animator(t.Plots.Animator.MAIN,r),this.animator(t.Plots.Animator.RESET,new t.Animators.Null)}return r(i,e),i.prototype.anchor=function(t){return e.prototype.anchor.call(this,t),this._dataChanged=!0,this._updateExtents(),this},i.prototype._setup=function(){var t=this;e.prototype._setup.call(this),this._renderArea=this.content().append("g").classed("render-area",!0),this.datasets().forEach(function(e){return t._createNodesForDataset(e)})},i.prototype.destroy=function(){var t=this;e.prototype.destroy.call(this),this._scales().forEach(function(e){return e.offUpdate(t._renderCallback)}),this.datasets([])},i.prototype._createNodesForDataset=function(t){var e=this._datasetToDrawer.get(t);return e.renderArea(this._renderArea.append("g")),e},i.prototype._createDrawer=function(e){return new t.Drawer(e)},i.prototype._getAnimator=function(e){return this._animateOnNextRender()?this._animators[e]||new t.Animators.Null:new t.Animators.Null},i.prototype._onDatasetUpdate=function(){this._updateExtents(),this._dataChanged=!0,this.render()},i.prototype.attr=function(t,e,i){return null==e?this._attrBindings.get(t):(this._bindAttr(t,e,i),this.render(),this)},i.prototype._bindProperty=function(t,e,i){var n=this._propertyBindings.get(t),r=null!=n?n.scale:null;this._propertyBindings.set(t,{accessor:d3.functor(e),scale:i}),this._updateExtentsForProperty(t),null!=r&&this._uninstallScaleForKey(r,t),null!=i&&this._installScaleForKey(i,t)},i.prototype._bindAttr=function(t,e,i){var n=this._attrBindings.get(t),r=null!=n?n.scale:null;this._attrBindings.set(t,{accessor:d3.functor(e),scale:i}),this._updateExtentsForAttr(t),null!=r&&this._uninstallScaleForKey(r,t),null!=i&&this._installScaleForKey(i,t)},i.prototype._generateAttrToProjector=function(){var t={};this._attrBindings.forEach(function(e,i){var n=i.accessor,r=i.scale,o=r?function(t,e,i){return r.scale(n(t,e,i))}:n;t[e]=o});var e=this._propertyProjectors();return Object.keys(e).forEach(function(i){null==t[i]&&(t[i]=e[i])}),t},i.prototype.renderImmediately=function(){return e.prototype.renderImmediately.call(this),this._isAnchored&&(this._paint(),this._dataChanged=!1),this},i.prototype.animated=function(t){return null==t?this._animate:(this._animate=t,this)},i.prototype.detach=function(){return e.prototype.detach.call(this),this._updateExtents(),this},i.prototype._scales=function(){var t=[];return this._attrBindings.forEach(function(e,i){var n=i.scale;null!=n&&-1===t.indexOf(n)&&t.push(n)}),this._propertyBindings.forEach(function(e,i){var n=i.scale;null!=n&&-1===t.indexOf(n)&&t.push(n)}),t},i.prototype._updateExtents=function(){var t=this;this._attrBindings.forEach(function(e){return t._updateExtentsForAttr(e)}),this._propertyExtents.forEach(function(e){return t._updateExtentsForProperty(e)}),this._scales().forEach(function(e){return e.addIncludedValuesProvider(t._includedValuesProvider)})},i.prototype._updateExtentsForAttr=function(t){this._updateExtentsForKey(t,this._attrBindings,this._attrExtents,null)},i.prototype._updateExtentsForProperty=function(t){this._updateExtentsForKey(t,this._propertyBindings,this._propertyExtents,this._filterForProperty(t))},i.prototype._filterForProperty=function(t){return null},i.prototype._updateExtentsForKey=function(t,e,i,n){var r=this,o=e.get(t);null!=o&&null!=o.accessor&&i.set(t,this.datasets().map(function(t){return r._computeExtent(t,o,n)}))},i.prototype._computeExtent=function(t,e,i){var n=e.accessor,r=e.scale;if(null==r)return[];var o=t.data();null!=i&&(o=o.filter(function(e,n){return i(e,n,t)}));var a=function(e,i){return n(e,i,t)},s=o.map(a);return r.extentOfValues(s)},i.prototype._extentsForProperty=function(t){return this._propertyExtents.get(t)},i.prototype._includedValuesForScale=function(t){var e=this;if(!this._isAnchored)return[];var i=[];return this._attrBindings.forEach(function(n,r){if(r.scale===t){var o=e._attrExtents.get(n);null!=o&&(i=i.concat(d3.merge(o)))}}),this._propertyBindings.forEach(function(n,r){if(r.scale===t){var o=e._extentsForProperty(n);null!=o&&(i=i.concat(d3.merge(o)))}}),i},i.prototype.animator=function(t,e){return void 0===e?this._animators[t]:(this._animators[t]=e,this)},i.prototype.addDataset=function(t){return this._addDataset(t),this._onDatasetUpdate(),this},i.prototype._addDataset=function(t){this._removeDataset(t);var e=this._createDrawer(t);return this._datasetToDrawer.set(t,e),this._isSetup&&this._createNodesForDataset(t),t.onUpdate(this._onDatasetUpdateCallback),this},i.prototype.removeDataset=function(t){return this._removeDataset(t),this._onDatasetUpdate(),this},i.prototype._removeDataset=function(t){return-1===this.datasets().indexOf(t)?this:(this._removeDatasetNodes(t),t.offUpdate(this._onDatasetUpdateCallback),this._datasetToDrawer["delete"](t),this)},i.prototype._removeDatasetNodes=function(t){var e=this._datasetToDrawer.get(t);e.remove()},i.prototype.datasets=function(t){var e=this,i=[];return this._datasetToDrawer.forEach(function(t,e){return i.push(e)}),null==t?i:(i.forEach(function(t){return e._removeDataset(t)}),t.forEach(function(t){return e._addDataset(t)}),this._onDatasetUpdate(),this)},i.prototype._getDrawersInOrder=function(){var t=this;return this.datasets().map(function(e){return t._datasetToDrawer.get(e)})},i.prototype._generateDrawSteps=function(){return[{attrToProjector:this._generateAttrToProjector(),animator:new t.Animators.Null}]},i.prototype._additionalPaint=function(t){},i.prototype._getDataToDraw=function(){var e=new t.Utils.Map;return this.datasets().forEach(function(t){return e.set(t,t.data())}),e},i.prototype._paint=function(){var e=this._generateDrawSteps(),i=this._getDataToDraw(),n=this._getDrawersInOrder();this.datasets().forEach(function(t,r){return n[r].draw(i.get(t),e)});var r=this.datasets().map(function(t,r){return n[r].totalDrawTime(i.get(t),e)}),o=t.Utils.Math.max(r,0);this._additionalPaint(o)},i.prototype.selections=function(t){var e=this;void 0===t&&(t=this.datasets());var i=[];return t.forEach(function(t){var n=e._datasetToDrawer.get(t);null!=n&&n.renderArea().selectAll(n.selector()).each(function(){i.push(this)})}),d3.selectAll(i)},i.prototype.entities=function(t){var e=this;return void 0===t&&(t=this.datasets()),this._lightweightEntities(t).map(function(t){return e._lightweightPlotEntityToPlotEntity(t)})},i.prototype._lightweightEntities=function(e){var i=this;void 0===e&&(e=this.datasets());var n=[];return e.forEach(function(e){var r=i._datasetToDrawer.get(e),o=0;e.data().forEach(function(a,s){var l=i._pixelPoint(a,s,e);t.Utils.Math.isNaN(l.x)||t.Utils.Math.isNaN(l.y)||(n.push({datum:a,index:s,dataset:e,position:l,component:i,drawer:r,validDatumIndex:o}),o++)})}),n},i.prototype._lightweightPlotEntityToPlotEntity=function(t){var e={datum:t.datum,position:t.position,dataset:t.dataset,index:t.index,component:t.component,selection:t.drawer.selectionForIndex(t.validDatumIndex)};return e},i.prototype.entityNearest=function(e){var i,n=this,r=1/0,o=this._lightweightEntities();return o.forEach(function(o){if(n._entityVisibleOnPlot(o.position,o.datum,o.index,o.dataset)){var a=t.Utils.Math.distanceSquared(o.position,e);r>a&&(r=a,i=o)}}),void 0!==i?this._lightweightPlotEntityToPlotEntity(i):void 0},i.prototype._entityVisibleOnPlot=function(t,e,i,n){return!(t.x<0||t.y<0||t.x>this.width()||t.y>this.height())},i.prototype._uninstallScaleForKey=function(t,e){t.offUpdate(this._renderCallback),t.removeIncludedValuesProvider(this._includedValuesProvider)},i.prototype._installScaleForKey=function(t,e){t.onUpdate(this._renderCallback),t.addIncludedValuesProvider(this._includedValuesProvider)},i.prototype._propertyProjectors=function(){return{}},i._scaledAccessor=function(t){return null==t.scale?t.accessor:function(e,i,n){return t.scale.scale(t.accessor(e,i,n))}},i.prototype._pixelPoint=function(t,e,i){return{x:0,y:0}},i.prototype._animateOnNextRender=function(){return this._animate&&this._dataChanged},i._ANIMATION_MAX_DURATION=600,i}(t.Component);t.Plot=e}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(){var i=this;e.call(this),this._labelFormatter=t.Formatters.identity(),this._labelsEnabled=!1,this.innerRadius(0),this.outerRadius(function(){return Math.min(i.width(),i.height())/2}),this.addClass("pie-plot"),this.attr("fill",function(t,e){return String(e)},new t.Scales.Color),this._strokeDrawers=new t.Utils.Map}return r(i,e),i.prototype._setup=function(){var t=this;e.prototype._setup.call(this),this._strokeDrawers.forEach(function(e){return e.renderArea(t._renderArea.append("g"))})},i.prototype.computeLayout=function(t,i,n){e.prototype.computeLayout.call(this,t,i,n),this._renderArea.attr("transform","translate("+this.width()/2+","+this.height()/2+")");var r=Math.min(this.width(),this.height())/2;return null!=this.innerRadius().scale&&this.innerRadius().scale.range([0,r]),null!=this.outerRadius().scale&&this.outerRadius().scale.range([0,r]),this},i.prototype.addDataset=function(t){return e.prototype.addDataset.call(this,t),this},i.prototype._addDataset=function(i){if(1===this.datasets().length)return t.Utils.Window.warn("Only one dataset is supported in Pie plots"),this;this._updatePieAngles();var n=new t.Drawers.ArcOutline(i);return this._isSetup&&n.renderArea(this._renderArea.append("g")),this._strokeDrawers.set(i,n),e.prototype._addDataset.call(this,i),this},i.prototype.removeDataset=function(t){return e.prototype.removeDataset.call(this,t),this},i.prototype._removeDatasetNodes=function(t){e.prototype._removeDatasetNodes.call(this,t),this._strokeDrawers.get(t).remove()},i.prototype._removeDataset=function(t){return e.prototype._removeDataset.call(this,t),this._startAngles=[],this._endAngles=[],this},i.prototype.selections=function(t){var i=this;void 0===t&&(t=this.datasets());var n=e.prototype.selections.call(this,t)[0];return t.forEach(function(t){var e=i._strokeDrawers.get(t);null!=e&&e.renderArea().selectAll(e.selector()).each(function(){n.push(this)})}),d3.selectAll(n)},i.prototype._onDatasetUpdate=function(){this._updatePieAngles(),e.prototype._onDatasetUpdate.call(this)},i.prototype._createDrawer=function(e){return new t.Drawers.Arc(e)},i.prototype.entities=function(t){var i=this;void 0===t&&(t=this.datasets());var n=e.prototype.entities.call(this,t);return n.forEach(function(t){t.position.x+=i.width()/2,t.position.y+=i.height()/2;var e=i._strokeDrawers.get(t.dataset).selectionForIndex(t.index);t.selection[0].push(e[0][0])}),n},i.prototype.sectorValue=function(t,e){return null==t?this._propertyBindings.get(i._SECTOR_VALUE_KEY):(this._bindProperty(i._SECTOR_VALUE_KEY,t,e),this._updatePieAngles(),this.render(),this)},i.prototype.innerRadius=function(t,e){return null==t?this._propertyBindings.get(i._INNER_RADIUS_KEY):(this._bindProperty(i._INNER_RADIUS_KEY,t,e),this.render(),this)},i.prototype.outerRadius=function(t,e){return null==t?this._propertyBindings.get(i._OUTER_RADIUS_KEY):(this._bindProperty(i._OUTER_RADIUS_KEY,t,e),this.render(),this)},i.prototype.labelsEnabled=function(t){return null==t?this._labelsEnabled:(this._labelsEnabled=t,this.render(),this)},i.prototype.labelFormatter=function(t){return null==t?this._labelFormatter:(this._labelFormatter=t,this.render(),this)},i.prototype.entitiesAt=function(t){var e={x:this.width()/2,y:this.height()/2},i={x:t.x-e.x,y:t.y-e.y},n=this._sliceIndexForPoint(i);return null==n?[]:[this.entities()[n]]},i.prototype._propertyProjectors=function(){var i=this,n=e.prototype._propertyProjectors.call(this),r=t.Plot._scaledAccessor(this.innerRadius()),o=t.Plot._scaledAccessor(this.outerRadius());return n.d=function(t,e,n){return d3.svg.arc().innerRadius(r(t,e,n)).outerRadius(o(t,e,n)).startAngle(i._startAngles[e]).endAngle(i._endAngles[e])(t,e)},n},i.prototype._updatePieAngles=function(){if(null!=this.sectorValue()&&0!==this.datasets().length){var e=t.Plot._scaledAccessor(this.sectorValue()),i=this.datasets()[0],n=this._getDataToDraw().get(i),r=d3.layout.pie().sort(null).value(function(t,n){return e(t,n,i)})(n);this._startAngles=r.map(function(t){return t.startAngle}),this._endAngles=r.map(function(t){return t.endAngle})}},i.prototype._getDataToDraw=function(){var n=e.prototype._getDataToDraw.call(this);if(0===this.datasets().length)return n;var r=t.Plot._scaledAccessor(this.sectorValue()),o=this.datasets()[0],a=n.get(o),s=a.filter(function(t,e){return i._isValidData(r(t,e,o))});return n.set(o,s),n},i._isValidData=function(e){return t.Utils.Math.isValidNumber(e)&&e>=0},i.prototype._pixelPoint=function(e,n,r){var o=t.Plot._scaledAccessor(this.sectorValue());if(!i._isValidData(o(e,n,r)))return{x:NaN,y:NaN};var a=t.Plot._scaledAccessor(this.innerRadius())(e,n,r),s=t.Plot._scaledAccessor(this.outerRadius())(e,n,r),l=(a+s)/2,c=d3.layout.pie().sort(null).value(function(t,e){var n=o(t,e,r);return i._isValidData(n)?n:0})(r.data()),h=c[n].startAngle,u=c[n].endAngle,p=(h+u)/2;return{x:l*Math.sin(p),y:-l*Math.cos(p)}},i.prototype._additionalPaint=function(e){var i=this;this._renderArea.select(".label-area").remove(),this._labelsEnabled&&t.Utils.Window.setTimeout(function(){return i._drawLabels()},e);var n=this._generateStrokeDrawSteps(),r=this._getDataToDraw();this.datasets().forEach(function(t){return i._strokeDrawers.get(t).draw(r.get(t),n)})},i.prototype._generateStrokeDrawSteps=function(){var e=this._generateAttrToProjector();return[{attrToProjector:e,animator:new t.Animators.Null}]},i.prototype._sliceIndexForPoint=function(t){var e=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),i=Math.acos(-t.y/e);t.x<0&&(i=2*Math.PI-i);for(var n,r=0;r<this._startAngles.length;r++)if(this._startAngles[r]<i&&this._endAngles[r]>i){n=r;break}if(void 0!==n){var o=this.datasets()[0],a=o.data()[n],s=this.innerRadius().accessor(a,n,o),l=this.outerRadius().accessor(a,n,o);if(e>s&&l>e)return n}return null},i.prototype._drawLabels=function(){var e=this,i=this._generateAttrToProjector(),n=this._renderArea.append("g").classed("label-area",!0),r=new o.Measurers.Measurer(n),a=new o.Writers.Writer(r),s=this.datasets()[0],l=this._getDataToDraw().get(s);l.forEach(function(o,l){var c=e.sectorValue().accessor(o,l,s);if(t.Utils.Math.isValidNumber(c)){c=e._labelFormatter(c);var h=r.measure(c),u=(e._endAngles[l]+e._startAngles[l])/2,p=e.outerRadius().accessor(o,l,s);e.outerRadius().scale&&(p=e.outerRadius().scale.scale(p));var d=e.innerRadius().accessor(o,l,s);e.innerRadius().scale&&(d=e.innerRadius().scale.scale(d));var _=(p+d)/2,f=Math.sin(u)*_-h.width/2,y=-Math.cos(u)*_-h.height/2,m=[{x:f,y:y},{x:f,y:y+h.height},{x:f+h.width,y:y},{x:f+h.width,y:y+h.height}],g=m.every(function(t){return Math.abs(t.x)<=e.width()/2&&Math.abs(t.y)<=e.height()/2});if(g){var v=m.map(function(t){return e._sliceIndexForPoint(t)});g=v.every(function(t){return t===l})}var x=i.fill(o,l,s),b=1.6*t.Utils.Color.contrast("white",x)<t.Utils.Color.contrast("black",x),E=n.append("g").attr("transform","translate("+f+","+y+")"),A=b?"dark-label":"light-label";E.classed(A,!0),E.style("visibility",g?"inherit":"hidden"),a.write(c,h.width,h.height,{selection:E,xAlign:"center",yAlign:"center",textRotation:0})}})},i._INNER_RADIUS_KEY="inner-radius",i._OUTER_RADIUS_KEY="outer-radius",i._SECTOR_VALUE_KEY="sector-value",i}(t.Plot);e.Pie=i}(e=t.Plots||(t.Plots={}))}(n||(n={}));var n;!function(t){var e=function(e){function i(){var t=this;e.call(this),this._autoAdjustXScaleDomain=!1,this._autoAdjustYScaleDomain=!1,this._deferredRendering=!1,this._cachedDomainX=[null,null],this._cachedDomainY=[null,null],this.addClass("xy-plot"),this._adjustYDomainOnChangeFromXCallback=function(e){return t._adjustYDomainOnChangeFromX()},this._adjustXDomainOnChangeFromYCallback=function(e){return t._adjustXDomainOnChangeFromY()};var i=0,n=0,r=1,o=1,a=[null,null],s=[null,null],l=0,c=500,h=function(){null!=t._renderArea&&(t._renderArea.attr("transform","translate("+i+", "+n+")scale("+r+", "+o+")"),clearTimeout(l),l=setTimeout(function(){t._cachedDomainX=a,t._cachedDomainY=s,i=0,n=0,r=1,o=1,t.render(),t._renderArea.attr("transform","translate(0, 0) scale(1, 1)")},c))},u=function(e){t._isAnchored&&(a=e.domain(),r=(e.scale(t._cachedDomainX[1])-e.scale(t._cachedDomainX[0]))/(e.scale(a[1])-e.scale(a[0]))||1,i=e.scale(t._cachedDomainX[0])-e.scale(a[0])||0,h())},p=function(e){t._isAnchored&&(s=e.domain(),o=(e.scale(t._cachedDomainY[1])-e.scale(t._cachedDomainY[0]))/(e.scale(s[1])-e.scale(s[0]))||1,n=e.scale(t._cachedDomainY[0])-e.scale(s[0])*o||0,h())};this._renderCallback=function(e){t.deferredRendering()&&t.x()&&t.x().scale===e?u(e):t.deferredRendering()&&t.y()&&t.y().scale===e?p(e):t.render()}}return r(i,e),i.prototype.deferredRendering=function(t){return null==t?this._deferredRendering:(t&&this._isAnchored&&(this.x()&&this.x().scale&&(this._cachedDomainX=this.x().scale.domain()),this.y()&&this.y().scale&&(this._cachedDomainY=this.y().scale.domain())),this._deferredRendering=t,this)},i.prototype.x=function(t,e){if(null==t)return this._propertyBindings.get(i._X_KEY);this._bindProperty(i._X_KEY,t,e);var n=this.width();return null!=e&&null!=n&&e.range([0,n]),this._autoAdjustYScaleDomain&&this._updateYExtentsAndAutodomain(),this.render(),this},i.prototype.y=function(e,n){if(null==e)return this._propertyBindings.get(i._Y_KEY);this._bindProperty(i._Y_KEY,e,n);var r=this.height();return null!=n&&null!=r&&(n instanceof t.Scales.Category?n.range([0,r]):n.range([r,0])),this._autoAdjustXScaleDomain&&this._updateXExtentsAndAutodomain(),this.render(),this},i.prototype._filterForProperty=function(t){return"x"===t&&this._autoAdjustXScaleDomain?this._makeFilterByProperty("y"):"y"===t&&this._autoAdjustYScaleDomain?this._makeFilterByProperty("x"):null;
},i.prototype._makeFilterByProperty=function(e){var i=this._propertyBindings.get(e);if(null!=i){var n=i.accessor,r=i.scale;if(null!=r)return function(e,i,o){var a=r.range();return t.Utils.Math.inRange(r.scale(n(e,i,o)),a[0],a[1])}}return null},i.prototype._uninstallScaleForKey=function(t,n){e.prototype._uninstallScaleForKey.call(this,t,n);var r=n===i._X_KEY?this._adjustYDomainOnChangeFromXCallback:this._adjustXDomainOnChangeFromYCallback;t.offUpdate(r)},i.prototype._installScaleForKey=function(t,n){e.prototype._installScaleForKey.call(this,t,n);var r=n===i._X_KEY?this._adjustYDomainOnChangeFromXCallback:this._adjustXDomainOnChangeFromYCallback;t.onUpdate(r)},i.prototype.destroy=function(){return e.prototype.destroy.call(this),this.x().scale&&this.x().scale.offUpdate(this._adjustYDomainOnChangeFromXCallback),this.y().scale&&this.y().scale.offUpdate(this._adjustXDomainOnChangeFromYCallback),this},i.prototype.autorangeMode=function(t){if(null==t)return this._autoAdjustXScaleDomain?"x":this._autoAdjustYScaleDomain?"y":"none";switch(t){case"x":this._autoAdjustXScaleDomain=!0,this._autoAdjustYScaleDomain=!1,this._adjustXDomainOnChangeFromY();break;case"y":this._autoAdjustXScaleDomain=!1,this._autoAdjustYScaleDomain=!0,this._adjustYDomainOnChangeFromX();break;case"none":this._autoAdjustXScaleDomain=!1,this._autoAdjustYScaleDomain=!1;break;default:throw new Error("Invalid scale name '"+t+"', must be 'x', 'y' or 'none'")}return this},i.prototype.computeLayout=function(i,n,r){e.prototype.computeLayout.call(this,i,n,r);var o=this.x(),a=o&&o.scale;null!=a&&a.range([0,this.width()]);var s=this.y(),l=s&&s.scale;return null!=l&&(l instanceof t.Scales.Category?l.range([0,this.height()]):l.range([this.height(),0])),this},i.prototype._updateXExtentsAndAutodomain=function(){this._updateExtentsForProperty("x");var t=this.x().scale;null!=t&&t.autoDomain()},i.prototype._updateYExtentsAndAutodomain=function(){this._updateExtentsForProperty("y");var t=this.y().scale;null!=t&&t.autoDomain()},i.prototype.showAllData=function(){return this._updateXExtentsAndAutodomain(),this._updateYExtentsAndAutodomain(),this},i.prototype._adjustYDomainOnChangeFromX=function(){this._projectorsReady()&&this._autoAdjustYScaleDomain&&this._updateYExtentsAndAutodomain()},i.prototype._adjustXDomainOnChangeFromY=function(){this._projectorsReady()&&this._autoAdjustXScaleDomain&&this._updateXExtentsAndAutodomain()},i.prototype._projectorsReady=function(){var t=this.x(),e=this.y();return null!=t&&null!=t.accessor&&null!=e&&null!=e.accessor},i.prototype._pixelPoint=function(e,i,n){var r=t.Plot._scaledAccessor(this.x()),o=t.Plot._scaledAccessor(this.y());return{x:r(e,i,n),y:o(e,i,n)}},i.prototype._getDataToDraw=function(){var i=this,n=e.prototype._getDataToDraw.call(this),r=function(e,n,r){var o=t.Plot._scaledAccessor(i.x())(e,n,r),a=t.Plot._scaledAccessor(i.y())(e,n,r);return t.Utils.Math.isValidNumber(o)&&t.Utils.Math.isValidNumber(a)};return this.datasets().forEach(function(t){n.set(t,n.get(t).filter(function(e,i){return r(e,i,t)}))}),n},i._X_KEY="x",i._Y_KEY="y",i}(t.Plot);t.XYPlot=e}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this._labelsEnabled=!1,this._label=null,this.animator("rectangles",new t.Animators.Null),this.addClass("rectangle-plot"),this.attr("fill",(new t.Scales.Color).range()[0])}return r(i,e),i.prototype._createDrawer=function(e){return new t.Drawers.Rectangle(e)},i.prototype._generateAttrToProjector=function(){var n=this,r=e.prototype._generateAttrToProjector.call(this),o=t.Plot._scaledAccessor(this.x()),a=r[i._X2_KEY],s=t.Plot._scaledAccessor(this.y()),l=r[i._Y2_KEY],c=this.x().scale,h=this.y().scale;return null!=a?(r.width=function(t,e,i){return Math.abs(a(t,e,i)-o(t,e,i))},r.x=function(t,e,i){return Math.min(a(t,e,i),o(t,e,i))}):(r.width=function(t,e,i){return n._rectangleWidth(c)},r.x=function(t,e,i){return o(t,e,i)-.5*r.width(t,e,i)}),null!=l?(r.height=function(t,e,i){return Math.abs(l(t,e,i)-s(t,e,i))},r.y=function(t,e,i){return Math.max(l(t,e,i),s(t,e,i))-r.height(t,e,i)}):(r.height=function(t,e,i){return n._rectangleWidth(h)},r.y=function(t,e,i){return s(t,e,i)-.5*r.height(t,e,i)}),delete r[i._X2_KEY],delete r[i._Y2_KEY],r},i.prototype._generateDrawSteps=function(){return[{attrToProjector:this._generateAttrToProjector(),animator:this._getAnimator("rectangles")}]},i.prototype._updateExtentsForProperty=function(t){e.prototype._updateExtentsForProperty.call(this,t),"x"===t?e.prototype._updateExtentsForProperty.call(this,"x2"):"y"===t&&e.prototype._updateExtentsForProperty.call(this,"y2")},i.prototype._filterForProperty=function(t){return"x2"===t?e.prototype._filterForProperty.call(this,"x"):"y2"===t?e.prototype._filterForProperty.call(this,"y"):e.prototype._filterForProperty.call(this,t)},i.prototype.x=function(n,r){if(null==n)return e.prototype.x.call(this);if(null==r?e.prototype.x.call(this,n):e.prototype.x.call(this,n,r),null!=r){var o=this.x2(),a=o&&o.accessor;null!=a&&this._bindProperty(i._X2_KEY,a,r)}return r instanceof t.Scales.Category&&r.innerPadding(0).outerPadding(0),this},i.prototype.x2=function(t){if(null==t)return this._propertyBindings.get(i._X2_KEY);var e=this.x(),n=e&&e.scale;return this._bindProperty(i._X2_KEY,t,n),this.render(),this},i.prototype.y=function(n,r){if(null==n)return e.prototype.y.call(this);if(null==r?e.prototype.y.call(this,n):e.prototype.y.call(this,n,r),null!=r){var o=this.y2(),a=o&&o.accessor;null!=a&&this._bindProperty(i._Y2_KEY,a,r)}return r instanceof t.Scales.Category&&r.innerPadding(0).outerPadding(0),this},i.prototype.y2=function(t){if(null==t)return this._propertyBindings.get(i._Y2_KEY);var e=this.y(),n=e&&e.scale;return this._bindProperty(i._Y2_KEY,t,n),this.render(),this},i.prototype.entitiesAt=function(t){var e=this._generateAttrToProjector();return this.entities().filter(function(i){var n=i.datum,r=i.index,o=i.dataset,a=e.x(n,r,o),s=e.y(n,r,o),l=e.width(n,r,o),c=e.height(n,r,o);return a<=t.x&&t.x<=a+l&&s<=t.y&&t.y<=s+c})},i.prototype.entitiesIn=function(t,e){var i,n;if(null==e){var r=t;i={min:r.topLeft.x,max:r.bottomRight.x},n={min:r.topLeft.y,max:r.bottomRight.y}}else i=t,n=e;return this._entitiesIntersecting(i,n)},i.prototype._entityBBox=function(t,e,i,n){return{x:n.x(t,e,i),y:n.y(t,e,i),width:n.width(t,e,i),height:n.height(t,e,i)}},i.prototype._entitiesIntersecting=function(e,i){var n=this,r=[],o=this._generateAttrToProjector();return this.entities().forEach(function(a){t.Utils.DOM.intersectsBBox(e,i,n._entityBBox(a.datum,a.index,a.dataset,o))&&r.push(a)}),r},i.prototype.label=function(t){return null==t?this._label:(this._label=t,this.render(),this)},i.prototype.labelsEnabled=function(t){return null==t?this._labelsEnabled:(this._labelsEnabled=t,this.render(),this)},i.prototype._propertyProjectors=function(){var i=e.prototype._propertyProjectors.call(this);return null!=this.x2()&&(i.x2=t.Plot._scaledAccessor(this.x2())),null!=this.y2()&&(i.y2=t.Plot._scaledAccessor(this.y2())),i},i.prototype._pixelPoint=function(t,e,i){var n=this._generateAttrToProjector(),r=n.x(t,e,i),o=n.y(t,e,i),a=n.width(t,e,i),s=n.height(t,e,i),l=r+a/2,c=o+s/2;return{x:l,y:c}},i.prototype._rectangleWidth=function(e){if(e instanceof t.Scales.Category)return e.rangeBand();var i=e===this.x().scale?this.x().accessor:this.y().accessor,n=d3.set(t.Utils.Array.flatten(this.datasets().map(function(t){return t.data().map(function(e,n){return i(e,n,t).valueOf()})}))).values().map(function(t){return+t}),r=t.Utils.Math.min(n,0),o=t.Utils.Math.max(n,0),a=e.scale(r),s=e.scale(o);return(s-a)/Math.abs(o-r)},i.prototype._getDataToDraw=function(){var e=new t.Utils.Map,i=this._generateAttrToProjector();return this.datasets().forEach(function(n){var r=n.data().filter(function(e,r){return t.Utils.Math.isValidNumber(i.x(e,r,n))&&t.Utils.Math.isValidNumber(i.y(e,r,n))&&t.Utils.Math.isValidNumber(i.width(e,r,n))&&t.Utils.Math.isValidNumber(i.height(e,r,n))});e.set(n,r)}),e},i.prototype._additionalPaint=function(e){var i=this;this._renderArea.selectAll(".label-area").remove(),this._labelsEnabled&&null!=this.label()&&t.Utils.Window.setTimeout(function(){return i._drawLabels()},e)},i.prototype._drawLabels=function(){var t=this,e=this._getDataToDraw();this.datasets().forEach(function(i,n){return t._drawLabel(e,i,n)})},i.prototype._drawLabel=function(e,i,n){var r=this,a=this._generateAttrToProjector(),s=this._renderArea.append("g").classed("label-area",!0),l=new o.Measurers.Measurer(s),c=new o.Writers.Writer(l),h=this.x().scale.range(),u=this.y().scale.range(),p=Math.min.apply(null,h),d=Math.max.apply(null,h),_=Math.min.apply(null,u),f=Math.max.apply(null,u),y=e.get(i);y.forEach(function(o,h){var u=""+r.label()(o,h,i),y=l.measure(u),m=a.x(o,h,i),g=a.y(o,h,i),v=a.width(o,h,i),x=a.height(o,h,i);if(y.height<=x&&y.width<=v){var b=(v-y.width)/2,E=(x-y.height)/2;m+=b,g+=E;var A={min:m,max:m+y.width},C={min:g,max:g+y.height};if(A.min<p||A.max>d||C.min<_||C.max>f)return;if(r._overlayLabel(A,C,h,n,e))return;var w=a.fill(o,h,i),T=1.6*t.Utils.Color.contrast("white",w)<t.Utils.Color.contrast("black",w),S=s.append("g").attr("transform","translate("+m+","+g+")"),k=T?"dark-label":"light-label";S.classed(k,!0),c.write(u,y.width,y.height,{selection:S,xAlign:"center",yAlign:"center",textRotation:0})}})},i.prototype._overlayLabel=function(e,i,n,r,o){for(var a=this._generateAttrToProjector(),s=this.datasets(),l=r;l<s.length;l++)for(var c=s[l],h=o.get(c),u=l===r?n+1:0;u<h.length;u++)if(t.Utils.DOM.intersectsBBox(e,i,this._entityBBox(h[u],u,c,a)))return!0;return!1},i._X2_KEY="x2",i._Y2_KEY="y2",i}(t.XYPlot);e.Rectangle=i}(e=t.Plots||(t.Plots={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(i){function n(){i.call(this),this.addClass("scatter-plot");var n=new t.Animators.Easing;n.startDelay(5),n.stepDuration(250),n.maxTotalDuration(t.Plot._ANIMATION_MAX_DURATION),this.animator(e.Animator.MAIN,n),this.attr("opacity",.6),this.attr("fill",(new t.Scales.Color).range()[0]),this.size(6);var r=t.SymbolFactories.circle();this.symbol(function(){return r})}return r(n,i),n.prototype._createDrawer=function(e){return new t.Drawers.Symbol(e)},n.prototype.size=function(t,e){return null==t?this._propertyBindings.get(n._SIZE_KEY):(this._bindProperty(n._SIZE_KEY,t,e),this.render(),this)},n.prototype.symbol=function(t){return null==t?this._propertyBindings.get(n._SYMBOL_KEY):(this._propertyBindings.set(n._SYMBOL_KEY,{accessor:t}),this.render(),this)},n.prototype._generateDrawSteps=function(){var t=[];if(this._animateOnNextRender()){var i=this._generateAttrToProjector();i.d=function(){return""},t.push({attrToProjector:i,animator:this._getAnimator(e.Animator.RESET)})}return t.push({attrToProjector:this._generateAttrToProjector(),animator:this._getAnimator(e.Animator.MAIN)}),t},n.prototype._entityVisibleOnPlot=function(e,i,n,r){var o={min:0,max:this.width()},a={min:0,max:this.height()},s=t.Plot._scaledAccessor(this.size())(i,n,r),l={x:e.x-s,y:e.y-s,width:s,height:s};return t.Utils.DOM.intersectsBBox(o,a,l)},n.prototype._propertyProjectors=function(){var e=i.prototype._propertyProjectors.call(this),n=t.Plot._scaledAccessor(this.x()),r=t.Plot._scaledAccessor(this.y()),o=t.Plot._scaledAccessor(this.size());e.transform=function(t,e,i){return"translate("+n(t,e,i)+","+r(t,e,i)+")"};var a=t.Plot._scaledAccessor(this.symbol());return e.d=function(t,e,i){return a(t,e,i)(o(t,e,i))},e},n.prototype.entitiesIn=function(e,i){var n,r;if(null==i){var o=e;n={min:o.topLeft.x,max:o.bottomRight.x},r={min:o.topLeft.y,max:o.bottomRight.y}}else n=e,r=i;var a=t.Plot._scaledAccessor(this.x()),s=t.Plot._scaledAccessor(this.y());return this.entities().filter(function(t){var e=t.datum,i=t.index,o=t.dataset,l=a(e,i,o),c=s(e,i,o);return n.min<=l&&l<=n.max&&r.min<=c&&c<=r.max})},n.prototype.entitiesAt=function(e){var i=t.Plot._scaledAccessor(this.x()),n=t.Plot._scaledAccessor(this.y()),r=t.Plot._scaledAccessor(this.size());return this.entities().filter(function(t){var o=t.datum,a=t.index,s=t.dataset,l=i(o,a,s),c=n(o,a,s),h=r(o,a,s);return l-h/2<=e.x&&e.x<=l+h/2&&c-h/2<=e.y&&e.y<=c+h/2})},n._SIZE_KEY="size",n._SYMBOL_KEY="symbol",n}(t.XYPlot);e.Scatter=i}(e=t.Plots||(t.Plots={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(i){function n(e){var r=this;if(void 0===e&&(e=n.ORIENTATION_VERTICAL),i.call(this),this._labelFormatter=t.Formatters.identity(),this._labelsEnabled=!1,this._hideBarsIfAnyAreTooWide=!0,this._barPixelWidth=0,this.addClass("bar-plot"),e!==n.ORIENTATION_VERTICAL&&e!==n.ORIENTATION_HORIZONTAL)throw new Error(e+" is not a valid orientation for Plots.Bar");this._isVertical=e===n.ORIENTATION_VERTICAL,this.animator("baseline",new t.Animators.Null),this.attr("fill",(new t.Scales.Color).range()[0]),this.attr("width",function(){return r._barPixelWidth}),this._labelConfig=new t.Utils.Map,this._baselineValueProvider=function(){return[r.baselineValue()]},this._updateBarPixelWidthCallback=function(){return r._updateBarPixelWidth()}}return r(n,i),n.prototype.x=function(t,e){return null==t?i.prototype.x.call(this):(null==e?i.prototype.x.call(this,t):(i.prototype.x.call(this,t,e),e.onUpdate(this._updateBarPixelWidthCallback)),this._updateValueScale(),this)},n.prototype.y=function(t,e){return null==t?i.prototype.y.call(this):(null==e?i.prototype.y.call(this,t):(i.prototype.y.call(this,t,e),e.onUpdate(this._updateBarPixelWidthCallback)),this._updateValueScale(),this)},n.prototype.orientation=function(){return this._isVertical?n.ORIENTATION_VERTICAL:n.ORIENTATION_HORIZONTAL},n.prototype.render=function(){return this._updateBarPixelWidth(),this._updateExtents(),i.prototype.render.call(this),this},n.prototype._createDrawer=function(e){return new t.Drawers.Rectangle(e)},n.prototype._setup=function(){i.prototype._setup.call(this),this._baseline=this._renderArea.append("line").classed("baseline",!0)},n.prototype.baselineValue=function(e){if(null==e){if(null!=this._baselineValue)return this._baselineValue;if(!this._projectorsReady())return 0;var i=this._isVertical?this.y().scale:this.x().scale;return i&&i instanceof t.Scales.Time?new Date(0):0}return this._baselineValue=e,this._updateValueScale(),this.render(),this},n.prototype.addDataset=function(t){return i.prototype.addDataset.call(this,t),this._updateBarPixelWidth(),this},n.prototype._addDataset=function(t){return t.onUpdate(this._updateBarPixelWidthCallback),i.prototype._addDataset.call(this,t),this},n.prototype.removeDataset=function(t){return t.offUpdate(this._updateBarPixelWidthCallback),i.prototype.removeDataset.call(this,t),this._updateBarPixelWidth(),this},n.prototype._removeDataset=function(t){return t.offUpdate(this._updateBarPixelWidthCallback),i.prototype._removeDataset.call(this,t),this},n.prototype.datasets=function(t){return null==t?i.prototype.datasets.call(this):(i.prototype.datasets.call(this,t),this._updateBarPixelWidth(),this)},n.prototype.labelsEnabled=function(t){return null==t?this._labelsEnabled:(this._labelsEnabled=t,this.render(),this)},n.prototype.labelFormatter=function(t){return null==t?this._labelFormatter:(this._labelFormatter=t,this.render(),this)},n.prototype._createNodesForDataset=function(t){var e=i.prototype._createNodesForDataset.call(this,t);e.renderArea().classed(n._BAR_AREA_CLASS,!0);var r=this._renderArea.append("g").classed(n._LABEL_AREA_CLASS,!0),a=new o.Measurers.CacheCharacterMeasurer(r),s=new o.Writers.Writer(a);return this._labelConfig.set(t,{labelArea:r,measurer:a,writer:s}),e},n.prototype._removeDatasetNodes=function(t){i.prototype._removeDatasetNodes.call(this,t);var e=this._labelConfig.get(t);null!=e&&(e.labelArea.remove(),this._labelConfig["delete"](t))},n.prototype.entityNearest=function(e){var i,n=this,r=1/0,o=1/0,a=this._isVertical?e.x:e.y,s=this._isVertical?e.y:e.x,l=.5;return this.entities().forEach(function(c){if(n._entityVisibleOnPlot(c.position,c.datum,c.index,c.dataset)){var h=0,u=0,p=c.position,d=t.Utils.DOM.elementBBox(c.selection);if(!t.Utils.DOM.intersectsBBox(e.x,e.y,d,l)){var _=n._isVertical?p.x:p.y;h=Math.abs(a-_);var f=n._isVertical?d.y:d.x,y=f+(n._isVertical?d.height:d.width);if(s>=f-l&&y+l>=s)u=0;else{var m=n._isVertical?p.y:p.x;u=Math.abs(s-m)}}(r>h||h===r&&o>u)&&(i=c,r=h,o=u)}}),i},n.prototype._entityVisibleOnPlot=function(e,i,n,r){var o={min:0,max:this.width()},a={min:0,max:this.height()},s=this._generateAttrToProjector(),l={x:s.x(i,n,r),y:s.y(i,n,r),width:s.width(i,n,r),height:s.height(i,n,r)};return t.Utils.DOM.intersectsBBox(o,a,l)},n.prototype.entitiesAt=function(t){return this._entitiesIntersecting(t.x,t.y)},n.prototype.entitiesIn=function(t,e){var i,n;if(null==e){var r=t;i={min:r.topLeft.x,max:r.bottomRight.x},n={min:r.topLeft.y,max:r.bottomRight.y}}else i=t,n=e;return this._entitiesIntersecting(i,n)},n.prototype._entitiesIntersecting=function(e,i){var n=[];return this.entities().forEach(function(r){t.Utils.DOM.intersectsBBox(e,i,t.Utils.DOM.elementBBox(r.selection))&&n.push(r)}),n},n.prototype._updateValueScale=function(){if(this._projectorsReady()){var e=this._isVertical?this.y().scale:this.x().scale;if(e instanceof t.QuantitativeScale){var i=e;i.addPaddingExceptionsProvider(this._baselineValueProvider),i.addIncludedValuesProvider(this._baselineValueProvider)}}},n.prototype._additionalPaint=function(e){var i=this,n=this._isVertical?this.y().scale:this.x().scale,r=n.scale(this.baselineValue()),o={x1:this._isVertical?0:r,y1:this._isVertical?r:0,x2:this._isVertical?this.width():r,y2:this._isVertical?r:this.height()};this._getAnimator("baseline").animate(this._baseline,o),this.datasets().forEach(function(t){return i._labelConfig.get(t).labelArea.selectAll("g").remove()}),this._labelsEnabled&&t.Utils.Window.setTimeout(function(){return i._drawLabels()},e)},n.prototype._extentsForProperty=function(e){var n,r=this,o=i.prototype._extentsForProperty.call(this,e);if("x"===e&&this._isVertical)n=this.x();else{if("y"!==e||this._isVertical)return o;n=this.y()}if(!(n&&n.scale&&n.scale instanceof t.QuantitativeScale))return o;var a=n.scale;return o=o.map(function(t){return d3.extent([a.invert(a.scale(t[0])-r._barPixelWidth/2),a.invert(a.scale(t[0])+r._barPixelWidth/2),a.invert(a.scale(t[1])-r._barPixelWidth/2),a.invert(a.scale(t[1])+r._barPixelWidth/2)])})},n.prototype._drawLabels=function(){var t=this,e=this._getDataToDraw(),i=!1;this.datasets().forEach(function(n){return i=i||t._drawLabel(e.get(n),n)}),this._hideBarsIfAnyAreTooWide&&i&&this.datasets().forEach(function(e){return t._labelConfig.get(e).labelArea.selectAll("g").remove()})},n.prototype._drawLabel=function(e,i){var r=this,o=this._generateAttrToProjector(),a=this._labelConfig.get(i),s=a.labelArea,l=a.measurer,c=a.writer,h=function(e,a){var h,u=r._isVertical?r.y().accessor:r.x().accessor,p=u(e,a,i),d=r._isVertical?r.y().scale:r.x().scale,_=null!=d?d.scale(p):p,f=null!=d?d.scale(r.baselineValue()):r.baselineValue(),y=o.width(e,a,i),m=o.height(e,a,i),g=r._labelFormatter(u(e,a,i)),v=l.measure(g),x="center",b="center",E={x:o.x(e,a,i),y:o.y(e,a,i)},A=y,C=m,w={x:E.x,y:E.y};if(r._isVertical){w.x+=A/2-v.width/2;var T=o.y(e,a,i),S=m;T+m>r.height()?S=r.height()-T:0>T&&(S=T+m);var k=n._LABEL_VERTICAL_PADDING;h=v.height+2*k<=S,h?f>_?(E.y+=k,b="top",w.y+=k):(E.y-=k,b="bottom",w.y+=C-k-v.height):(C=m+k+v.height,f>=_?(E.y-=k+v.height,b="top",w.y-=k+v.height):(b="bottom",w.y+=m+k))}else{w.y+=C/2-v.height/2;var D=o.x(e,a,i),L=y;D+y>r.width()?L=r.width()-D:0>D&&(L=D+y);var k=n._LABEL_HORIZONTAL_PADDING;h=v.width+2*k<=L,h?f>_?(E.x+=k,x="left",w.x+=k):(E.x-=k,x="right",w.x+=A-k-v.width):(A=y+k+v.width,f>_?(E.x-=k+v.width,x="left",w.x-=k+v.width):(x="right",w.x+=y+k))}var M=s.append("g").attr("transform","translate("+E.x+", "+E.y+")");if(h){M.classed("on-bar-label",!0);var P=o.fill(e,a,i),I=1.6*t.Utils.Color.contrast("white",P)<t.Utils.Color.contrast("black",P);M.classed(I?"dark-label":"light-label",!0)}else M.classed("off-bar-label",!0);var N=w.x<0||w.y<0||w.x+v.width>r.width()||w.y+v.height>r.height();M.style("visibility",N?"hidden":"inherit");var R={selection:M,xAlign:x,yAlign:b,textRotation:0};c.write(g,A,C,R);var U=r._isVertical?y<v.width:m<v.height;return U},u=e.map(h);return u.some(function(t){return t})},n.prototype._generateDrawSteps=function(){var t=[];if(this._animateOnNextRender()){var i=this._generateAttrToProjector(),n=this._isVertical?this.y().scale:this.x().scale,r=n.scale(this.baselineValue()),o=this._isVertical?"y":"x",a=this._isVertical?"height":"width";i[o]=function(){return r},i[a]=function(){return 0},t.push({attrToProjector:i,animator:this._getAnimator(e.Animator.RESET)})}return t.push({attrToProjector:this._generateAttrToProjector(),animator:this._getAnimator(e.Animator.MAIN)}),t},n.prototype._generateAttrToProjector=function(){var e=i.prototype._generateAttrToProjector.call(this),n=this._isVertical?this.y().scale:this.x().scale,r=this._isVertical?"y":"x",o=this._isVertical?"x":"y",a=n.scale(this.baselineValue()),s=this._isVertical?t.Plot._scaledAccessor(this.x()):t.Plot._scaledAccessor(this.y()),l=e.width,c=this._isVertical?t.Plot._scaledAccessor(this.y()):t.Plot._scaledAccessor(this.x()),h=function(t,e,i){return Math.abs(a-c(t,e,i))};return e.width=this._isVertical?l:h,e.height=this._isVertical?h:l,e[o]=function(t,e,i){return s(t,e,i)-l(t,e,i)/2},e[r]=function(t,e,i){var n=c(t,e,i);return n>a?a:n},e},n.prototype._getBarPixelWidth=function(){if(!this._projectorsReady())return 0;var e,i=this._isVertical?this.x().scale:this.y().scale;if(i instanceof t.Scales.Category)e=i.rangeBand();else{var r=this._isVertical?this.x().accessor:this.y().accessor,o=d3.set(t.Utils.Array.flatten(this.datasets().map(function(t){return t.data().map(function(e,i){return r(e,i,t)}).filter(function(t){return null!=t}).map(function(t){return t.valueOf()})}))).values().map(function(t){return+t});o.sort(function(t,e){return t-e});var a=o.map(function(t){return i.scale(t)}),s=d3.pairs(a),l=this._isVertical?this.width():this.height();e=t.Utils.Math.min(s,function(t,e){return Math.abs(t[1]-t[0])},l*n._SINGLE_BAR_DIMENSION_RATIO),e*=n._BAR_WIDTH_RATIO}return e},n.prototype._updateBarPixelWidth=function(){this._barPixelWidth=this._getBarPixelWidth()},n.prototype.entities=function(t){if(void 0===t&&(t=this.datasets()),!this._projectorsReady())return[];var e=i.prototype.entities.call(this,t);return e},n.prototype._pixelPoint=function(e,i,n){var r,o,a=this._generateAttrToProjector(),s=a.x(e,i,n),l=a.y(e,i,n),c=a.width(e,i,n),h=a.height(e,i,n),u=(this._isVertical?t.Plot._scaledAccessor(this.y()):t.Plot._scaledAccessor(this.x()))(e,i,n),p=(this._isVertical?this.y().scale:this.x().scale).scale(this.baselineValue());return this._isVertical?(r=s+c/2,o=p>=u?l:l+h):(r=u>=p?s+c:s,o=l+h/2),{x:r,y:o}},n.prototype._uninstallScaleForKey=function(t,e){t.offUpdate(this._updateBarPixelWidthCallback),i.prototype._uninstallScaleForKey.call(this,t,e)},n.prototype._getDataToDraw=function(){var e=new t.Utils.Map,i=this._generateAttrToProjector();return this.datasets().forEach(function(n){var r=n.data().filter(function(e,r){return t.Utils.Math.isValidNumber(i.x(e,r,n))&&t.Utils.Math.isValidNumber(i.y(e,r,n))&&t.Utils.Math.isValidNumber(i.width(e,r,n))&&t.Utils.Math.isValidNumber(i.height(e,r,n))});e.set(n,r)}),e},n.ORIENTATION_VERTICAL="vertical",n.ORIENTATION_HORIZONTAL="horizontal",n._BAR_WIDTH_RATIO=.95,n._SINGLE_BAR_DIMENSION_RATIO=.4,n._BAR_AREA_CLASS="bar-area",n._LABEL_AREA_CLASS="bar-label-text-area",n._LABEL_VERTICAL_PADDING=5,n._LABEL_HORIZONTAL_PADDING=5,n}(t.XYPlot);e.Bar=i}(e=t.Plots||(t.Plots={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(i){function n(){i.call(this),this._interpolator="linear",this._autorangeSmooth=!1,this._croppedRenderingEnabled=!0,this._downsamplingEnabled=!1,this.addClass("line-plot");var n=new t.Animators.Easing;n.stepDuration(t.Plot._ANIMATION_MAX_DURATION),n.easingMode("exp-in-out"),n.maxTotalDuration(t.Plot._ANIMATION_MAX_DURATION),this.animator(e.Animator.MAIN,n),this.attr("stroke",(new t.Scales.Color).range()[0]),this.attr("stroke-width","2px")}return r(n,i),n.prototype.x=function(t,e){return null==t?i.prototype.x.call(this):(null==e?i.prototype.x.call(this,t):i.prototype.x.call(this,t,e),this._setScaleSnapping(),this)},n.prototype.y=function(t,e){return null==t?i.prototype.y.call(this):(i.prototype.y.call(this,t,e),this._setScaleSnapping(),this)},n.prototype.autorangeMode=function(t){return null==t?i.prototype.autorangeMode.call(this):(i.prototype.autorangeMode.call(this,t),this._setScaleSnapping(),this)},n.prototype.autorangeSmooth=function(t){return null==t?this._autorangeSmooth:(this._autorangeSmooth=t,this._setScaleSnapping(),this)},n.prototype._setScaleSnapping=function(){"x"===this.autorangeMode()&&this.x()&&this.x().scale&&this.x().scale instanceof t.QuantitativeScale&&this.x().scale.snappingDomainEnabled(!this.autorangeSmooth()),"y"===this.autorangeMode()&&this.y()&&this.y().scale&&this.y().scale instanceof t.QuantitativeScale&&this.y().scale.snappingDomainEnabled(!this.autorangeSmooth())},n.prototype.interpolator=function(t){return null==t?this._interpolator:(this._interpolator=t,this.render(),this)},n.prototype.downsamplingEnabled=function(t){return null==t?this._downsamplingEnabled:(this._downsamplingEnabled=t,this)},n.prototype.croppedRenderingEnabled=function(t){return null==t?this._croppedRenderingEnabled:(this._croppedRenderingEnabled=t,this.render(),this)},n.prototype._createDrawer=function(e){return new t.Drawers.Line(e)},n.prototype._extentsForProperty=function(t){var e=i.prototype._extentsForProperty.call(this,t);if(!this._autorangeSmooth)return e;if(this.autorangeMode()!==t)return e;if("x"!==this.autorangeMode()&&"y"!==this.autorangeMode())return e;var n,r=this._getEdgeIntersectionPoints();return n="y"===this.autorangeMode()?r.left.concat(r.right).map(function(t){return t.y}):r.top.concat(r.bottom).map(function(t){return t.x}),e.map(function(t){return d3.extent(d3.merge([t,n]))})},n.prototype._getEdgeIntersectionPoints=function(){var e=this;if(!(this.y().scale instanceof t.QuantitativeScale&&this.x().scale instanceof t.QuantitativeScale))return{left:[],right:[],top:[],bottom:[]};var i=this.y().scale,n=this.x().scale,r={left:[],right:[],top:[],bottom:[]},o=n.scale(n.domain()[0]),a=n.scale(n.domain()[1]),s=i.scale(i.domain()[0]),l=i.scale(i.domain()[1]);return this.datasets().forEach(function(t){for(var c,h,u,p,d,_,f,y,m=t.data(),g=1;g<m.length;g++)d=f||n.scale(e.x().accessor(m[g-1],g-1,t)),_=y||i.scale(e.y().accessor(m[g-1],g-1,t)),f=n.scale(e.x().accessor(m[g],g,t)),y=i.scale(e.y().accessor(m[g],g,t)),o>d==f>=o&&(c=o-d,h=f-d,p=y-_,u=c*p/h,r.left.push({x:o,y:i.invert(_+u)})),a>d==f>=a&&(c=a-d,h=f-d,p=y-_,u=c*p/h,r.right.push({x:a,y:i.invert(_+u)})),l>_==y>=l&&(h=f-d,u=l-_,p=y-_,c=u*h/p,r.top.push({x:n.invert(d+c),y:l})),s>_==y>=s&&(h=f-d,u=s-_,p=y-_,c=u*h/p,r.bottom.push({x:n.invert(d+c),y:s}))}),r},n.prototype._getResetYFunction=function(){var t=this.y().scale.domain(),e=Math.max(t[0],t[1]),i=Math.min(t[0],t[1]),n=0>e&&e||i>0&&i||0,r=this.y().scale.scale(n);return function(t,e,i){return r}},n.prototype._generateDrawSteps=function(){var i=[];if(this._animateOnNextRender()){var n=this._generateAttrToProjector();n.d=this._constructLineProjector(t.Plot._scaledAccessor(this.x()),this._getResetYFunction()),i.push({attrToProjector:n,animator:this._getAnimator(e.Animator.RESET)})}return i.push({attrToProjector:this._generateAttrToProjector(),animator:this._getAnimator(e.Animator.MAIN)}),i},n.prototype._generateAttrToProjector=function(){var t=i.prototype._generateAttrToProjector.call(this);return Object.keys(t).forEach(function(e){if("d"!==e){var i=t[e];t[e]=function(t,e,n){return t.length>0?i(t[0],e,n):null}}}),t},n.prototype.entityNearest=function(t){var e,i=this,n=1/0,r=1/0;return this.entities().forEach(function(o){if(i._entityVisibleOnPlot(o.position,o.datum,o.index,o.dataset)){var a=Math.abs(t.x-o.position.x),s=Math.abs(t.y-o.position.y);(n>a||a===n&&r>s)&&(e=o,n=a,r=s)}}),e},n.prototype._propertyProjectors=function(){var e=i.prototype._propertyProjectors.call(this);return e.d=this._constructLineProjector(t.Plot._scaledAccessor(this.x()),t.Plot._scaledAccessor(this.y())),e},n.prototype._constructLineProjector=function(e,i){var n=this,r=function(e,i,r){var o=t.Plot._scaledAccessor(n.x())(e,i,r),a=t.Plot._scaledAccessor(n.y())(e,i,r);return null!=o&&!t.Utils.Math.isNaN(o)&&null!=a&&!t.Utils.Math.isNaN(a)};return function(t,o,a){return d3.svg.line().x(function(t,i){return e(t,i,a)}).y(function(t,e){return i(t,e,a)}).interpolate(n.interpolator()).defined(function(t,e){return r(t,e,a)})(t)}},n.prototype._getDataToDraw=function(){var e=this,i=new t.Utils.Map;return this.datasets().forEach(function(t){var n=t.data();if(!e._croppedRenderingEnabled&&!e._downsamplingEnabled)return void i.set(t,[n]);var r=n.map(function(t,e){return e});e._croppedRenderingEnabled&&(r=e._filterCroppedRendering(t,r)),e._downsamplingEnabled&&(r=e._filterDownsampling(t,r)),i.set(t,[r.map(function(t,e){return n[t]})])}),i},n.prototype._filterCroppedRendering=function(e,i){for(var n=this,r=t.Plot._scaledAccessor(this.x()),o=t.Plot._scaledAccessor(this.y()),a=e.data(),s=[],l=function(e,i){return t.Utils.Math.inRange(e,0,n.width())&&t.Utils.Math.inRange(i,0,n.height())},c=0;c<i.length;c++){var h=r(a[i[c]],i[c],e),u=o(a[i[c]],i[c],e),p=l(h,u);if(!p&&null!=i[c-1]&&null!=a[i[c-1]]){var d=r(a[i[c-1]],i[c-1],e),_=o(a[i[c-1]],i[c-1],e);p=p||l(d,_)}if(!p&&null!=i[c+1]&&null!=a[i[c+1]]){var f=r(a[i[c+1]],i[c+1],e),y=o(a[i[c+1]],i[c+1],e);p=p||l(f,y)}p&&s.push(i[c])}return s},n.prototype._filterDownsampling=function(e,i){if(0===i.length)return[];for(var n=e.data(),r=t.Plot._scaledAccessor(this.x()),o=t.Plot._scaledAccessor(this.y()),a=[i[0]],s=function(t,a){var s=r(n[i[t]],i[t],e),l=o(n[i[t]],i[t],e),c=r(n[i[t+1]],i[t+1],e),h=o(n[i[t+1]],i[t+1],e);if(a===1/0)return Math.floor(s)===Math.floor(c);var u=l+(c-s)*a;return Math.floor(h)===Math.floor(u)},l=0;l<i.length-1;){for(var c=i[l],h=r(n[i[l]],i[l],e),u=o(n[i[l]],i[l],e),p=r(n[i[l+1]],i[l+1],e),d=o(n[i[l+1]],i[l+1],e),_=Math.floor(h)===Math.floor(p)?1/0:(d-u)/(p-h),f=i[l],y=_===1/0?u:h,m=f,g=y,v=!0;l<i.length-1&&(v||s(l,_));){l++,v=!1;var x=_===1/0?o(n[i[l]],i[l],e):r(n[i[l]],i[l],e);x>g&&(g=x,m=i[l]),y>x&&(y=x,f=i[l])}var b=i[l];f!==c&&a.push(f),m!==f&&m!==c&&a.push(m),b!==c&&b!==f&&b!==m&&a.push(b)}return a},n}(t.XYPlot);e.Line=i}(e=t.Plots||(t.Plots={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(i){function n(){i.call(this),this.addClass("area-plot"),this.y0(0),this.attr("fill-opacity",.25),this.attr("fill",(new t.Scales.Color).range()[0]),this._lineDrawers=new t.Utils.Map}return r(n,i),n.prototype._setup=function(){var t=this;i.prototype._setup.call(this),this._lineDrawers.forEach(function(e){return e.renderArea(t._renderArea.append("g"))})},n.prototype.y=function(t,e){if(null==t)return i.prototype.y.call(this);if(null==e?i.prototype.y.call(this,t):i.prototype.y.call(this,t,e),null!=e){var r=this.y0().accessor;null!=r&&this._bindProperty(n._Y0_KEY,r,e),this._updateYScale()}return this},n.prototype.y0=function(t){if(null==t)return this._propertyBindings.get(n._Y0_KEY);var e=this.y(),i=e&&e.scale;return this._bindProperty(n._Y0_KEY,t,i),this._updateYScale(),this.render(),this},n.prototype._onDatasetUpdate=function(){i.prototype._onDatasetUpdate.call(this),this._updateYScale()},n.prototype.addDataset=function(t){return i.prototype.addDataset.call(this,t),this},n.prototype._addDataset=function(e){var n=new t.Drawers.Line(e);return this._isSetup&&n.renderArea(this._renderArea.append("g")),this._lineDrawers.set(e,n),i.prototype._addDataset.call(this,e),this},n.prototype._removeDatasetNodes=function(t){i.prototype._removeDatasetNodes.call(this,t),this._lineDrawers.get(t).remove()},n.prototype._additionalPaint=function(){var t=this,e=this._generateLineDrawSteps(),i=this._getDataToDraw();this.datasets().forEach(function(n){return t._lineDrawers.get(n).draw(i.get(n),e)})},n.prototype._generateLineDrawSteps=function(){var i=[];if(this._animateOnNextRender()){var n=this._generateLineAttrToProjector();
n.d=this._constructLineProjector(t.Plot._scaledAccessor(this.x()),this._getResetYFunction()),i.push({attrToProjector:n,animator:this._getAnimator(e.Animator.RESET)})}return i.push({attrToProjector:this._generateLineAttrToProjector(),animator:this._getAnimator(e.Animator.MAIN)}),i},n.prototype._generateLineAttrToProjector=function(){var e=this._generateAttrToProjector();return e.d=this._constructLineProjector(t.Plot._scaledAccessor(this.x()),t.Plot._scaledAccessor(this.y())),e},n.prototype._createDrawer=function(e){return new t.Drawers.Area(e)},n.prototype._generateDrawSteps=function(){var i=[];if(this._animateOnNextRender()){var n=this._generateAttrToProjector();n.d=this._constructAreaProjector(t.Plot._scaledAccessor(this.x()),this._getResetYFunction(),t.Plot._scaledAccessor(this.y0())),i.push({attrToProjector:n,animator:this._getAnimator(e.Animator.RESET)})}return i.push({attrToProjector:this._generateAttrToProjector(),animator:this._getAnimator(e.Animator.MAIN)}),i},n.prototype._updateYScale=function(){var e=this._propertyExtents.get("y0"),i=t.Utils.Array.flatten(e),n=t.Utils.Array.uniq(i),r=1===n.length?n[0]:null,o=this.y(),a=o&&o.scale;null!=a&&(null!=this._constantBaselineValueProvider&&(a.removePaddingExceptionsProvider(this._constantBaselineValueProvider),this._constantBaselineValueProvider=null),null!=r&&(this._constantBaselineValueProvider=function(){return[r]},a.addPaddingExceptionsProvider(this._constantBaselineValueProvider)))},n.prototype._getResetYFunction=function(){return t.Plot._scaledAccessor(this.y0())},n.prototype._propertyProjectors=function(){var e=i.prototype._propertyProjectors.call(this);return e.d=this._constructAreaProjector(t.Plot._scaledAccessor(this.x()),t.Plot._scaledAccessor(this.y()),t.Plot._scaledAccessor(this.y0())),e},n.prototype.selections=function(t){var e=this;void 0===t&&(t=this.datasets());var n=i.prototype.selections.call(this,t)[0],r=t.map(function(t){return e._lineDrawers.get(t)}).filter(function(t){return null!=t});return r.forEach(function(t,e){return n.push(t.selectionForIndex(e).node())}),d3.selectAll(n)},n.prototype._constructAreaProjector=function(e,i,n){var r=this,o=function(e,i,n){var o=t.Plot._scaledAccessor(r.x())(e,i,n),a=t.Plot._scaledAccessor(r.y())(e,i,n);return t.Utils.Math.isValidNumber(o)&&t.Utils.Math.isValidNumber(a)};return function(t,a,s){var l=d3.svg.area().x(function(t,i){return e(t,i,s)}).y1(function(t,e){return i(t,e,s)}).y0(function(t,e){return n(t,e,s)}).interpolate(r.interpolator()).defined(function(t,e){return o(t,e,s)});return l(t)}},n._Y0_KEY="y0",n}(e.Line);e.Area=i}(e=t.Plots||(t.Plots={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(i){function n(n){void 0===n&&(n=e.Bar.ORIENTATION_VERTICAL),i.call(this,n),this._clusterOffsets=new t.Utils.Map}return r(n,i),n.prototype._generateAttrToProjector=function(){var t=this,e=i.prototype._generateAttrToProjector.call(this),n=this._makeInnerScale(),r=function(t,e){return n.rangeBand()};e.width=this._isVertical?r:e.width,e.height=this._isVertical?e.height:r;var o=e.x,a=e.y;return e.x=this._isVertical?function(e,i,n){return o(e,i,n)+t._clusterOffsets.get(n)}:function(t,e,i){return o(t,e,i)},e.y=this._isVertical?function(t,e,i){return a(t,e,i)}:function(e,i,n){return a(e,i,n)+t._clusterOffsets.get(n)},e},n.prototype._updateClusterPosition=function(){var t=this,e=this._makeInnerScale();this.datasets().forEach(function(i,n){return t._clusterOffsets.set(i,e.scale(String(n))-e.rangeBand()/2)})},n.prototype._makeInnerScale=function(){var e=new t.Scales.Category;e.domain(this.datasets().map(function(t,e){return String(e)}));var i=t.Plot._scaledAccessor(this.attr("width"));return e.range([0,i(null,0,null)]),e},n.prototype._getDataToDraw=function(){return this._updateClusterPosition(),i.prototype._getDataToDraw.call(this)},n}(e.Bar);e.ClusteredBar=i}(e=t.Plots||(t.Plots={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(){var i=this;e.call(this),this._baselineValue=0,this.addClass("stacked-area-plot"),this.attr("fill-opacity",1),this._stackingResult=new t.Utils.Map,this._stackedExtent=[],this._baselineValueProvider=function(){return[i._baselineValue]},this.croppedRenderingEnabled(!1)}return r(i,e),i.prototype.croppedRenderingEnabled=function(i){return null==i?e.prototype.croppedRenderingEnabled.call(this):i===!0?(t.Utils.Window.warn("Warning: Stacked Area Plot does not support cropped rendering."),this):e.prototype.croppedRenderingEnabled.call(this,i)},i.prototype._getAnimator=function(e){return new t.Animators.Null},i.prototype._setup=function(){e.prototype._setup.call(this),this._baseline=this._renderArea.append("line").classed("baseline",!0)},i.prototype.x=function(t,i){return null==t?e.prototype.x.call(this):(null==i?e.prototype.x.call(this,t):e.prototype.x.call(this,t,i),this._updateStackExtentsAndOffsets(),this)},i.prototype.y=function(t,i){return null==t?e.prototype.y.call(this):(null==i?e.prototype.y.call(this,t):e.prototype.y.call(this,t,i),this._updateStackExtentsAndOffsets(),this)},i.prototype.downsamplingEnabled=function(i){return null==i?e.prototype.downsamplingEnabled.call(this):(t.Utils.Window.warn("Warning: Stacked Area Plot does not support downsampling"),this)},i.prototype._additionalPaint=function(){var t=this.y().scale.scale(this._baselineValue),e={x1:0,y1:t,x2:this.width(),y2:t};this._getAnimator("baseline").animate(this._baseline,e)},i.prototype._updateYScale=function(){var t=this.y(),e=t&&t.scale;null!=e&&(e.addPaddingExceptionsProvider(this._baselineValueProvider),e.addIncludedValuesProvider(this._baselineValueProvider))},i.prototype._onDatasetUpdate=function(){return this._updateStackExtentsAndOffsets(),e.prototype._onDatasetUpdate.call(this),this},i.prototype._updateExtentsForProperty=function(t){e.prototype._updateExtentsForProperty.call(this,t),"x"!==t&&"y"!==t||!this._projectorsReady()||this._updateStackExtentsAndOffsets()},i.prototype._extentsForProperty=function(t){var i="y";return t===i?[this._stackedExtent]:e.prototype._extentsForProperty.call(this,t)},i.prototype._updateStackExtentsAndOffsets=function(){if(this._projectorsReady()){var e=this.datasets(),i=this.x().accessor,n=this.y().accessor,r=this._filterForProperty("y");this._checkSameDomain(e,i),this._stackingResult=t.Utils.Stacking.stack(e,i,n),this._stackedExtent=t.Utils.Stacking.stackedExtent(this._stackingResult,i,r)}},i.prototype._checkSameDomain=function(e,n){var r=e.map(function(t){return d3.set(t.data().map(function(e,i){return n(e,i,t).toString()})).values()}),o=i._domainKeys(e,n);r.some(function(t){return t.length!==o.length})&&t.Utils.Window.warn("the domains across the datasets are not the same. Plot may produce unintended behavior.")},i._domainKeys=function(t,e){var i=d3.set();return t.forEach(function(t){t.data().forEach(function(n,r){i.add(e(n,r,t))})}),i.values()},i.prototype._propertyProjectors=function(){var i=this,n=e.prototype._propertyProjectors.call(this),r=this.y().accessor,o=this.x().accessor,a=function(e,i,n){return t.Utils.Stacking.normalizeKey(o(e,i,n))},s=function(t,e,n){return i.y().scale.scale(+r(t,e,n)+i._stackingResult.get(n).get(a(t,e,n)).offset)},l=function(t,e,n){return i.y().scale.scale(i._stackingResult.get(n).get(a(t,e,n)).offset)};return n.d=this._constructAreaProjector(t.Plot._scaledAccessor(this.x()),s,l),n},i.prototype._pixelPoint=function(i,n,r){var o=e.prototype._pixelPoint.call(this,i,n,r),a=this.x().accessor(i,n,r),s=this.y().accessor(i,n,r),l=this.y().scale.scale(+s+this._stackingResult.get(r).get(t.Utils.Stacking.normalizeKey(a)).offset);return{x:o.x,y:l}},i}(e.Area);e.StackedArea=i}(e=t.Plots||(t.Plots={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(i){function n(n){void 0===n&&(n=e.Bar.ORIENTATION_VERTICAL),i.call(this,n),this.addClass("stacked-bar-plot"),this._stackingResult=new t.Utils.Map,this._stackedExtent=[]}return r(n,i),n.prototype.x=function(t,e){return null==t?i.prototype.x.call(this):(null==e?i.prototype.x.call(this,t):i.prototype.x.call(this,t,e),this._updateStackExtentsAndOffsets(),this)},n.prototype.y=function(t,e){return null==t?i.prototype.y.call(this):(null==e?i.prototype.y.call(this,t):i.prototype.y.call(this,t,e),this._updateStackExtentsAndOffsets(),this)},n.prototype._generateAttrToProjector=function(){var e=this,n=i.prototype._generateAttrToProjector.call(this),r=this._isVertical?"y":"x",o=this._isVertical?"x":"y",a=this._isVertical?this.y().scale:this.x().scale,s=this._propertyBindings.get(r).accessor,l=this._propertyBindings.get(o).accessor,c=function(e,i,n){return t.Utils.Stacking.normalizeKey(l(e,i,n))},h=function(t,i,n){return a.scale(e._stackingResult.get(n).get(c(t,i,n)).offset)},u=function(t,i,n){return a.scale(+s(t,i,n)+e._stackingResult.get(n).get(c(t,i,n)).offset)},p=function(t,e,i){return Math.abs(u(t,e,i)-h(t,e,i))};n[this._isVertical?"height":"width"]=p;var d=function(t,e,i){return+s(t,e,i)<0?h(t,e,i):u(t,e,i)};return n[r]=function(t,i,n){return e._isVertical?d(t,i,n):d(t,i,n)-p(t,i,n)},n},n.prototype._onDatasetUpdate=function(){return this._updateStackExtentsAndOffsets(),i.prototype._onDatasetUpdate.call(this),this},n.prototype._updateExtentsForProperty=function(t){i.prototype._updateExtentsForProperty.call(this,t),"x"!==t&&"y"!==t||!this._projectorsReady()||this._updateStackExtentsAndOffsets()},n.prototype._extentsForProperty=function(t){var e=this._isVertical?"y":"x";return t===e?[this._stackedExtent]:i.prototype._extentsForProperty.call(this,t)},n.prototype._updateStackExtentsAndOffsets=function(){if(this._projectorsReady()){var e=this.datasets(),i=this._isVertical?this.x().accessor:this.y().accessor,n=this._isVertical?this.y().accessor:this.x().accessor,r=this._filterForProperty(this._isVertical?"y":"x");this._stackingResult=t.Utils.Stacking.stack(e,i,n),this._stackedExtent=t.Utils.Stacking.stackedExtent(this._stackingResult,i,r)}},n}(e.Bar);e.StackedBar=i}(e=t.Plots||(t.Plots={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this.addClass("segment-plot"),this.attr("stroke",(new t.Scales.Color).range()[0]),this.attr("stroke-width","2px")}return r(i,e),i.prototype._createDrawer=function(e){return new t.Drawers.Segment(e)},i.prototype._generateDrawSteps=function(){return[{attrToProjector:this._generateAttrToProjector(),animator:new t.Animators.Null}]},i.prototype._updateExtentsForProperty=function(t){e.prototype._updateExtentsForProperty.call(this,t),"x"===t?e.prototype._updateExtentsForProperty.call(this,"x2"):"y"===t&&e.prototype._updateExtentsForProperty.call(this,"y2")},i.prototype._filterForProperty=function(t){return"x2"===t?e.prototype._filterForProperty.call(this,"x"):"y2"===t?e.prototype._filterForProperty.call(this,"y"):e.prototype._filterForProperty.call(this,t)},i.prototype.x=function(t,n){if(null==t)return e.prototype.x.call(this);if(null==n)e.prototype.x.call(this,t);else{e.prototype.x.call(this,t,n);var r=this.x2(),o=r&&r.accessor;null!=o&&this._bindProperty(i._X2_KEY,o,n)}return this},i.prototype.x2=function(t){if(null==t)return this._propertyBindings.get(i._X2_KEY);var e=this.x(),n=e&&e.scale;return this._bindProperty(i._X2_KEY,t,n),this.render(),this},i.prototype.y=function(t,n){if(null==t)return e.prototype.y.call(this);if(null==n)e.prototype.y.call(this,t);else{e.prototype.y.call(this,t,n);var r=this.y2(),o=r&&r.accessor;null!=o&&this._bindProperty(i._Y2_KEY,o,n)}return this},i.prototype.y2=function(t){if(null==t)return this._propertyBindings.get(i._Y2_KEY);var e=this.y(),n=e&&e.scale;return this._bindProperty(i._Y2_KEY,t,n),this.render(),this},i.prototype._propertyProjectors=function(){var i=e.prototype._propertyProjectors.call(this);return i.x1=t.Plot._scaledAccessor(this.x()),i.x2=null==this.x2()?t.Plot._scaledAccessor(this.x()):t.Plot._scaledAccessor(this.x2()),i.y1=t.Plot._scaledAccessor(this.y()),i.y2=null==this.y2()?t.Plot._scaledAccessor(this.y()):t.Plot._scaledAccessor(this.y2()),i},i.prototype.entitiesIn=function(t,e){var i,n;if(null==e){var r=t;i={min:r.topLeft.x,max:r.bottomRight.x},n={min:r.topLeft.y,max:r.bottomRight.y}}else i=t,n=e;return this._entitiesIntersecting(i,n)},i.prototype._entitiesIntersecting=function(t,e){var i=this,n=[],r=this._generateAttrToProjector();return this.entities().forEach(function(o){i._lineIntersectsBox(o,t,e,r)&&n.push(o)}),n},i.prototype._lineIntersectsBox=function(t,e,i,n){var r=this,o=n.x1(t.datum,t.index,t.dataset),a=n.x2(t.datum,t.index,t.dataset),s=n.y1(t.datum,t.index,t.dataset),l=n.y2(t.datum,t.index,t.dataset);if(e.min<=o&&o<=e.max&&i.min<=s&&s<=i.max||e.min<=a&&a<=e.max&&i.min<=l&&l<=i.max)return!0;var c={x:o,y:s},h={x:a,y:l},u=[{x:e.min,y:i.min},{x:e.min,y:i.max},{x:e.max,y:i.max},{x:e.max,y:i.min}],p=u.filter(function(t,e){return 0!==e?r._lineIntersectsSegment(c,h,t,u[e-1])&&r._lineIntersectsSegment(t,u[e-1],c,h):void 0});return p.length>0},i.prototype._lineIntersectsSegment=function(t,e,i,n){var r=function(t,e,i){return(e.x-t.x)*(i.y-e.y)-(e.y-t.y)*(i.x-e.x)};return r(t,e,i)*r(t,e,n)<0},i._X2_KEY="x2",i._Y2_KEY="y2",i}(t.XYPlot);e.Segment=i}(e=t.Plots||(t.Plots={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this._connectorsEnabled=!1,this.addClass("waterfall-plot")}return r(i,e),i.prototype.connectorsEnabled=function(t){return null==t?this._connectorsEnabled:(this._connectorsEnabled=t,this)},i.prototype.total=function(t){return null==t?this._propertyBindings.get(i._TOTAL_KEY):(this._bindProperty(i._TOTAL_KEY,t,null),this)},i.prototype._additionalPaint=function(e){var i=this;this._connectorArea.selectAll("line").remove(),this._connectorsEnabled&&t.Utils.Window.setTimeout(function(){return i._drawConnectors()},e)},i.prototype._createNodesForDataset=function(t){var n=e.prototype._createNodesForDataset.call(this,t);return this._connectorArea=this._renderArea.append("g").classed(i._CONNECTOR_AREA_CLASS,!0),n},i.prototype._extentsForProperty=function(t){var i="y";return t===i?[this._extent]:e.prototype._extentsForProperty.call(this,t)},i.prototype._generateAttrToProjector=function(){var n=this,r=e.prototype._generateAttrToProjector.call(this),o=this.y().scale,a=t.Plot._scaledAccessor(this.total()),s=this.attr("y");null==s&&(r.y=function(t,e,i){var r=n.y().accessor(t,e,i),s=a(t,e,i);if(s)return Math.min(o.scale(r),o.scale(0));var l=n._subtotals[e];if(0===e)return 0>r?o.scale(l-r):o.scale(l);var c=n._subtotals[e-1];return l>c?o.scale(l):o.scale(c)});var l=this.attr("height");return null==l&&(r.height=function(t,e,i){var r=a(t,e,i),s=n.y().accessor(t,e,i);if(r)return Math.abs(o.scale(s)-o.scale(0));var l=n._subtotals[e];if(0===e)return Math.abs(o.scale(l)-o.scale(l-s));var c=n._subtotals[e-1];return Math.abs(o.scale(l)-o.scale(c))}),r["class"]=function(t,e,r){var o="";null!=n.attr("class")&&(o=n.attr("class").accessor(t,e,r)+" ");var s=a(t,e,r);if(s)return o+i._BAR_TOTAL_CLASS;var l=n.y().accessor(t,e,r);return o+(l>0?i._BAR_GROWTH_CLASS:i._BAR_DECLINE_CLASS)},r},i.prototype._onDatasetUpdate=function(){return this._updateSubtotals(),e.prototype._onDatasetUpdate.call(this),this},i.prototype._calculateSubtotalsAndExtent=function(t){var e=this,i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=0,o=!1;t.data().forEach(function(a,s){var l=e.y().accessor(a,s,t),c=e.total().accessor(a,s,t);if(c&&0!==s||(r+=l),e._subtotals.push(r),i>r&&(i=r),r>n&&(n=r),c&&(i>l&&(i=l),l>n&&(n=l)),!o&&c){for(var h=l-r,u=0;u<e._subtotals.length;u++)e._subtotals[u]+=h;o=!0,r+=h,i+=h,n+=h}}),this._extent=[i,n]},i.prototype._drawConnectors=function(){for(var t=this._generateAttrToProjector(),e=this.datasets()[0],n=1;n<e.data().length;n++){var r=n-1,o=e.data()[n],a=e.data()[r],s=t.x(a,r,e),l=t.x(o,n,e)+t.width(o,n,e),c=t.y(o,n,e);(this._subtotals[n]>0&&this._subtotals[n]>this._subtotals[r]||this._subtotals[n]<0&&this._subtotals[n]>=this._subtotals[r])&&(c=t.y(o,n,e)+t.height(o,n,e)),this._connectorArea.append("line").classed(i._CONNECTOR_CLASS,!0).attr("x1",s).attr("x2",l).attr("y1",c).attr("y2",c)}},i.prototype._updateSubtotals=function(){var t=this.datasets();if(t.length>0){var e=t[t.length-1];this._subtotals=new Array,this._calculateSubtotalsAndExtent(e)}},i._BAR_DECLINE_CLASS="waterfall-decline",i._BAR_GROWTH_CLASS="waterfall-growth",i._BAR_TOTAL_CLASS="waterfall-total",i._CONNECTOR_CLASS="connector",i._CONNECTOR_AREA_CLASS="connector-area",i._TOTAL_KEY="total",i}(e.Bar);e.Waterfall=i}(e=t.Plots||(t.Plots={}))}(n||(n={}));var n;!function(t){var e;!function(t){var e=function(){function t(){}return t.prototype.totalTime=function(t){return 0},t.prototype.animate=function(t,e){return t.attr(e)},t}();t.Null=e}(e=t.Animators||(t.Animators={}))}(n||(n={}));var n;!function(t){var e;!function(t){var e=function(){function t(){this._startDelay=t._DEFAULT_START_DELAY_MILLISECONDS,this._stepDuration=t._DEFAULT_STEP_DURATION_MILLISECONDS,this._stepDelay=t._DEFAULT_ITERATIVE_DELAY_MILLISECONDS,this._maxTotalDuration=t._DEFAULT_MAX_TOTAL_DURATION_MILLISECONDS,this._easingMode=t._DEFAULT_EASING_MODE}return t.prototype.totalTime=function(t){var e=this._getAdjustedIterativeDelay(t);return this.startDelay()+e*Math.max(t-1,0)+this.stepDuration()},t.prototype.animate=function(t,e){var i=this,n=t[0].length,r=this._getAdjustedIterativeDelay(n);return t.transition().ease(this.easingMode()).duration(this.stepDuration()).delay(function(t,e){return i.startDelay()+r*e}).attr(e)},t.prototype.startDelay=function(t){return null==t?this._startDelay:(this._startDelay=t,this)},t.prototype.stepDuration=function(t){return null==t?Math.min(this._stepDuration,this._maxTotalDuration):(this._stepDuration=t,this)},t.prototype.stepDelay=function(t){return null==t?this._stepDelay:(this._stepDelay=t,this)},t.prototype.maxTotalDuration=function(t){return null==t?this._maxTotalDuration:(this._maxTotalDuration=t,this)},t.prototype.easingMode=function(t){return null==t?this._easingMode:(this._easingMode=t,this)},t.prototype._getAdjustedIterativeDelay=function(t){var e=this.maxTotalDuration()-this.stepDuration();e=Math.max(e,0);var i=e/Math.max(t-1,1);return Math.min(this.stepDelay(),i)},t._DEFAULT_START_DELAY_MILLISECONDS=0,t._DEFAULT_STEP_DURATION_MILLISECONDS=300,t._DEFAULT_ITERATIVE_DELAY_MILLISECONDS=15,t._DEFAULT_MAX_TOTAL_DURATION_MILLISECONDS=1/0,t._DEFAULT_EASING_MODE="exp-out",t}();t.Easing=e}(e=t.Animators||(t.Animators={}))}(n||(n={}));var n;!function(t){var e=function(){function e(){this._eventToProcessingFunction={},this._eventNameToCallbackSet={},this._connected=!1}return e.prototype._hasNoCallbacks=function(){for(var t=Object.keys(this._eventNameToCallbackSet),e=0;e<t.length;e++)if(0!==this._eventNameToCallbackSet[t[e]].size)return!1;return!0},e.prototype._connect=function(){var t=this;this._connected||(Object.keys(this._eventToProcessingFunction).forEach(function(e){var i=t._eventToProcessingFunction[e];document.addEventListener(e,i)}),this._connected=!0)},e.prototype._disconnect=function(){var t=this;this._connected&&this._hasNoCallbacks()&&(Object.keys(this._eventToProcessingFunction).forEach(function(e){var i=t._eventToProcessingFunction[e];document.removeEventListener(e,i)}),this._connected=!1)},e.prototype._addCallbackForEvent=function(e,i){null==this._eventNameToCallbackSet[e]&&(this._eventNameToCallbackSet[e]=new t.Utils.CallbackSet),this._eventNameToCallbackSet[e].add(i),this._connect()},e.prototype._removeCallbackForEvent=function(t,e){null!=this._eventNameToCallbackSet[t]&&this._eventNameToCallbackSet[t]["delete"](e),this._disconnect()},e.prototype._callCallbacksForEvent=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=this._eventNameToCallbackSet[t];null!=n&&n.callCallbacks.apply(n,e)},e}();t.Dispatcher=e}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(n){var r=this;e.call(this),this._translator=t.Utils.ClientToSVGTranslator.getTranslator(n),this._lastMousePosition={x:-1,y:-1};var o=function(t){return r._measureAndDispatch(t,i._MOUSEMOVE_EVENT_NAME,"page")};this._eventToProcessingFunction[i._MOUSEOVER_EVENT_NAME]=o,this._eventToProcessingFunction[i._MOUSEMOVE_EVENT_NAME]=o,this._eventToProcessingFunction[i._MOUSEOUT_EVENT_NAME]=o,this._eventToProcessingFunction[i._MOUSEDOWN_EVENT_NAME]=function(t){return r._measureAndDispatch(t,i._MOUSEDOWN_EVENT_NAME)},this._eventToProcessingFunction[i._MOUSEUP_EVENT_NAME]=function(t){return r._measureAndDispatch(t,i._MOUSEUP_EVENT_NAME,"page")},this._eventToProcessingFunction[i._WHEEL_EVENT_NAME]=function(t){return r._measureAndDispatch(t,i._WHEEL_EVENT_NAME)},this._eventToProcessingFunction[i._DBLCLICK_EVENT_NAME]=function(t){return r._measureAndDispatch(t,i._DBLCLICK_EVENT_NAME)}}return r(i,e),i.getDispatcher=function(e){var n=t.Utils.DOM.boundingSVG(e),r=n[i._DISPATCHER_KEY];return null==r&&(r=new i(n),n[i._DISPATCHER_KEY]=r),r},i.prototype.onMouseMove=function(t){return this._addCallbackForEvent(i._MOUSEMOVE_EVENT_NAME,t),this},i.prototype.offMouseMove=function(t){return this._removeCallbackForEvent(i._MOUSEMOVE_EVENT_NAME,t),this},i.prototype.onMouseDown=function(t){return this._addCallbackForEvent(i._MOUSEDOWN_EVENT_NAME,t),this},i.prototype.offMouseDown=function(t){return this._removeCallbackForEvent(i._MOUSEDOWN_EVENT_NAME,t),this},i.prototype.onMouseUp=function(t){return this._addCallbackForEvent(i._MOUSEUP_EVENT_NAME,t),this},i.prototype.offMouseUp=function(t){return this._removeCallbackForEvent(i._MOUSEUP_EVENT_NAME,t),this},i.prototype.onWheel=function(t){return this._addCallbackForEvent(i._WHEEL_EVENT_NAME,t),this},i.prototype.offWheel=function(t){return this._removeCallbackForEvent(i._WHEEL_EVENT_NAME,t),this},i.prototype.onDblClick=function(t){return this._addCallbackForEvent(i._DBLCLICK_EVENT_NAME,t),this},i.prototype.offDblClick=function(t){return this._removeCallbackForEvent(i._DBLCLICK_EVENT_NAME,t),this},i.prototype._measureAndDispatch=function(t,e,i){if(void 0===i&&(i="element"),"page"!==i&&"element"!==i)throw new Error("Invalid scope '"+i+"', must be 'element' or 'page'");if("page"===i||this.eventInsideSVG(t)){var n=this._translator.computePosition(t.clientX,t.clientY);null!=n&&(this._lastMousePosition=n,this._callCallbacksForEvent(e,this.lastMousePosition(),t))}},i.prototype.eventInsideSVG=function(t){return this._translator.insideSVG(t)},i.prototype.lastMousePosition=function(){return this._lastMousePosition},i._DISPATCHER_KEY="__Plottable_Dispatcher_Mouse",i._MOUSEOVER_EVENT_NAME="mouseover",i._MOUSEMOVE_EVENT_NAME="mousemove",i._MOUSEOUT_EVENT_NAME="mouseout",i._MOUSEDOWN_EVENT_NAME="mousedown",i._MOUSEUP_EVENT_NAME="mouseup",i._WHEEL_EVENT_NAME="wheel",i._DBLCLICK_EVENT_NAME="dblclick",i}(t.Dispatcher);e.Mouse=i}(e=t.Dispatchers||(t.Dispatchers={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(n){var r=this;e.call(this),this._translator=t.Utils.ClientToSVGTranslator.getTranslator(n),this._eventToProcessingFunction[i._TOUCHSTART_EVENT_NAME]=function(t){return r._measureAndDispatch(t,i._TOUCHSTART_EVENT_NAME,"page")},this._eventToProcessingFunction[i._TOUCHMOVE_EVENT_NAME]=function(t){return r._measureAndDispatch(t,i._TOUCHMOVE_EVENT_NAME,"page")},this._eventToProcessingFunction[i._TOUCHEND_EVENT_NAME]=function(t){return r._measureAndDispatch(t,i._TOUCHEND_EVENT_NAME,"page")},this._eventToProcessingFunction[i._TOUCHCANCEL_EVENT_NAME]=function(t){return r._measureAndDispatch(t,i._TOUCHCANCEL_EVENT_NAME,"page")}}return r(i,e),i.getDispatcher=function(e){var n=t.Utils.DOM.boundingSVG(e),r=n[i._DISPATCHER_KEY];return null==r&&(r=new i(n),n[i._DISPATCHER_KEY]=r),r},i.prototype.onTouchStart=function(t){return this._addCallbackForEvent(i._TOUCHSTART_EVENT_NAME,t),this},i.prototype.offTouchStart=function(t){return this._removeCallbackForEvent(i._TOUCHSTART_EVENT_NAME,t),this},i.prototype.onTouchMove=function(t){return this._addCallbackForEvent(i._TOUCHMOVE_EVENT_NAME,t),this},i.prototype.offTouchMove=function(t){return this._removeCallbackForEvent(i._TOUCHMOVE_EVENT_NAME,t),this},i.prototype.onTouchEnd=function(t){return this._addCallbackForEvent(i._TOUCHEND_EVENT_NAME,t),this},i.prototype.offTouchEnd=function(t){return this._removeCallbackForEvent(i._TOUCHEND_EVENT_NAME,t),this},i.prototype.onTouchCancel=function(t){return this._addCallbackForEvent(i._TOUCHCANCEL_EVENT_NAME,t),this},i.prototype.offTouchCancel=function(t){return this._removeCallbackForEvent(i._TOUCHCANCEL_EVENT_NAME,t),this},i.prototype._measureAndDispatch=function(t,e,i){if(void 0===i&&(i="element"),"page"!==i&&"element"!==i)throw new Error("Invalid scope '"+i+"', must be 'element' or 'page'");if("element"!==i||this.eventInsideSVG(t)){for(var n=t.changedTouches,r={},o=[],a=0;a<n.length;a++){var s=n[a],l=s.identifier,c=this._translator.computePosition(s.clientX,s.clientY);null!=c&&(r[l]=c,o.push(l))}o.length>0&&this._callCallbacksForEvent(e,o,r,t)}},i.prototype.eventInsideSVG=function(t){return this._translator.insideSVG(t)},i._DISPATCHER_KEY="__Plottable_Dispatcher_Touch",i._TOUCHSTART_EVENT_NAME="touchstart",i._TOUCHMOVE_EVENT_NAME="touchmove",i._TOUCHEND_EVENT_NAME="touchend",i._TOUCHCANCEL_EVENT_NAME="touchcancel",i}(t.Dispatcher);e.Touch=i}(e=t.Dispatchers||(t.Dispatchers={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(t){function e(){var i=this;t.call(this),this._eventToProcessingFunction[e._KEYDOWN_EVENT_NAME]=function(t){return i._processKeydown(t)},this._eventToProcessingFunction[e._KEYUP_EVENT_NAME]=function(t){return i._processKeyup(t)}}return r(e,t),e.getDispatcher=function(){var t=document[e._DISPATCHER_KEY];return null==t&&(t=new e,document[e._DISPATCHER_KEY]=t),t},e.prototype._processKeydown=function(t){this._callCallbacksForEvent(e._KEYDOWN_EVENT_NAME,t.keyCode,t)},e.prototype._processKeyup=function(t){this._callCallbacksForEvent(e._KEYUP_EVENT_NAME,t.keyCode,t)},e.prototype.onKeyDown=function(t){return this._addCallbackForEvent(e._KEYDOWN_EVENT_NAME,t),this},e.prototype.offKeyDown=function(t){return this._removeCallbackForEvent(e._KEYDOWN_EVENT_NAME,t),this},e.prototype.onKeyUp=function(t){return this._addCallbackForEvent(e._KEYUP_EVENT_NAME,t),this},e.prototype.offKeyUp=function(t){return this._removeCallbackForEvent(e._KEYUP_EVENT_NAME,t),this},e._DISPATCHER_KEY="__Plottable_Dispatcher_Key",e._KEYDOWN_EVENT_NAME="keydown",e._KEYUP_EVENT_NAME="keyup",e}(t.Dispatcher);e.Key=i}(e=t.Dispatchers||(t.Dispatchers={}))}(n||(n={}));var n;!function(t){var e=function(){function t(){var t=this;this._anchorCallback=function(e){return t._anchor(e)},this._enabled=!0}return t.prototype._anchor=function(t){this._isAnchored=!0},t.prototype._unanchor=function(){this._isAnchored=!1},t.prototype.attachTo=function(t){return this._disconnect(),this._componentAttachedTo=t,this._connect(),this},t.prototype._connect=function(){this.enabled()&&null!=this._componentAttachedTo&&!this._isAnchored&&this._componentAttachedTo.onAnchor(this._anchorCallback)},t.prototype.detachFrom=function(t){return this._disconnect(),this._componentAttachedTo=null,this},t.prototype._disconnect=function(){this._isAnchored&&this._unanchor(),null!=this._componentAttachedTo&&this._componentAttachedTo.offAnchor(this._anchorCallback)},t.prototype.enabled=function(t){return null==t?this._enabled:(this._enabled=t,this._enabled?this._connect():this._disconnect(),this)},t.prototype._translateToComponentSpace=function(t){var e=this._componentAttachedTo.originToSVG();return{x:t.x-e.x,y:t.y-e.y}},t.prototype._isInsideComponent=function(t){return 0<=t.x&&0<=t.y&&t.x<=this._componentAttachedTo.width()&&t.y<=this._componentAttachedTo.height()},t}();t.Interaction=e}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(){var i=this;e.apply(this,arguments),this._clickedDown=!1,this._onClickCallbacks=new t.Utils.CallbackSet,this._mouseDownCallback=function(t){return i._handleClickDown(t)},this._mouseUpCallback=function(t){return i._handleClickUp(t)},this._touchStartCallback=function(t,e){return i._handleClickDown(e[t[0]])},this._touchEndCallback=function(t,e){return i._handleClickUp(e[t[0]])},this._touchCancelCallback=function(t,e){return i._clickedDown=!1}}return r(i,e),i.prototype._anchor=function(i){e.prototype._anchor.call(this,i),this._mouseDispatcher=t.Dispatchers.Mouse.getDispatcher(i.content().node()),this._mouseDispatcher.onMouseDown(this._mouseDownCallback),this._mouseDispatcher.onMouseUp(this._mouseUpCallback),this._touchDispatcher=t.Dispatchers.Touch.getDispatcher(i.content().node()),this._touchDispatcher.onTouchStart(this._touchStartCallback),this._touchDispatcher.onTouchEnd(this._touchEndCallback),this._touchDispatcher.onTouchCancel(this._touchCancelCallback)},i.prototype._unanchor=function(){e.prototype._unanchor.call(this),this._mouseDispatcher.offMouseDown(this._mouseDownCallback),this._mouseDispatcher.offMouseUp(this._mouseUpCallback),this._mouseDispatcher=null,this._touchDispatcher.offTouchStart(this._touchStartCallback),this._touchDispatcher.offTouchEnd(this._touchEndCallback),this._touchDispatcher.offTouchCancel(this._touchCancelCallback),this._touchDispatcher=null},i.prototype._handleClickDown=function(t){var e=this._translateToComponentSpace(t);this._isInsideComponent(e)&&(this._clickedDown=!0)},i.prototype._handleClickUp=function(t){var e=this._translateToComponentSpace(t);this._clickedDown&&this._isInsideComponent(e)&&this._onClickCallbacks.callCallbacks(e),this._clickedDown=!1},i.prototype.onClick=function(t){return this._onClickCallbacks.add(t),this},i.prototype.offClick=function(t){return this._onClickCallbacks["delete"](t),this},i}(t.Interaction);e.Click=i}(e=t.Interactions||(t.Interactions={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i;!function(t){t[t.NotClicked=0]="NotClicked",t[t.SingleClicked=1]="SingleClicked",t[t.DoubleClicked=2]="DoubleClicked"}(i||(i={}));var n=function(e){function n(){var n=this;e.apply(this,arguments),this._clickState=i.NotClicked,this._clickedDown=!1,this._onDoubleClickCallbacks=new t.Utils.CallbackSet,this._mouseDownCallback=function(t){return n._handleClickDown(t)},this._mouseUpCallback=function(t){return n._handleClickUp(t)},this._dblClickCallback=function(t){return n._handleDblClick()},this._touchStartCallback=function(t,e){return n._handleClickDown(e[t[0]])},this._touchEndCallback=function(t,e){return n._handleClickUp(e[t[0]])},this._touchCancelCallback=function(t,e){return n._handleClickCancel()}}return r(n,e),n.prototype._anchor=function(i){e.prototype._anchor.call(this,i),this._mouseDispatcher=t.Dispatchers.Mouse.getDispatcher(i.content().node()),this._mouseDispatcher.onMouseDown(this._mouseDownCallback),this._mouseDispatcher.onMouseUp(this._mouseUpCallback),this._mouseDispatcher.onDblClick(this._dblClickCallback),this._touchDispatcher=t.Dispatchers.Touch.getDispatcher(i.content().node()),this._touchDispatcher.onTouchStart(this._touchStartCallback),this._touchDispatcher.onTouchEnd(this._touchEndCallback),this._touchDispatcher.onTouchCancel(this._touchCancelCallback)},n.prototype._unanchor=function(){e.prototype._unanchor.call(this),this._mouseDispatcher.offMouseDown(this._mouseDownCallback),this._mouseDispatcher.offMouseUp(this._mouseUpCallback),this._mouseDispatcher.offDblClick(this._dblClickCallback),this._mouseDispatcher=null,this._touchDispatcher.offTouchStart(this._touchStartCallback),this._touchDispatcher.offTouchEnd(this._touchEndCallback),this._touchDispatcher.offTouchCancel(this._touchCancelCallback),this._touchDispatcher=null},n.prototype._handleClickDown=function(t){var e=this._translateToComponentSpace(t);this._isInsideComponent(e)&&(this._clickState===i.SingleClicked&&n._pointsEqual(e,this._clickedPoint)||(this._clickState=i.NotClicked),this._clickedPoint=e,this._clickedDown=!0)},n.prototype._handleClickUp=function(t){var e=this._translateToComponentSpace(t);this._clickedDown&&n._pointsEqual(e,this._clickedPoint)?this._clickState=this._clickState===i.NotClicked?i.SingleClicked:i.DoubleClicked:this._clickState=i.NotClicked,this._clickedDown=!1},n.prototype._handleDblClick=function(){this._clickState===i.DoubleClicked&&(this._onDoubleClickCallbacks.callCallbacks(this._clickedPoint),
this._clickState=i.NotClicked)},n.prototype._handleClickCancel=function(){this._clickState=i.NotClicked,this._clickedDown=!1},n._pointsEqual=function(t,e){return t.x===e.x&&t.y===e.y},n.prototype.onDoubleClick=function(t){return this._onDoubleClickCallbacks.add(t),this},n.prototype.offDoubleClick=function(t){return this._onDoubleClickCallbacks["delete"](t),this},n}(t.Interaction);e.DoubleClick=n}(e=t.Interactions||(t.Interactions={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(){var i=this;e.apply(this,arguments),this._keyPressCallbacks={},this._keyReleaseCallbacks={},this._mouseMoveCallback=function(t){return!1},this._downedKeys=new t.Utils.Set,this._keyDownCallback=function(t,e){return i._handleKeyDownEvent(t,e)},this._keyUpCallback=function(t){return i._handleKeyUpEvent(t)}}return r(i,e),i.prototype._anchor=function(i){e.prototype._anchor.call(this,i),this._positionDispatcher=t.Dispatchers.Mouse.getDispatcher(this._componentAttachedTo._element.node()),this._positionDispatcher.onMouseMove(this._mouseMoveCallback),this._keyDispatcher=t.Dispatchers.Key.getDispatcher(),this._keyDispatcher.onKeyDown(this._keyDownCallback),this._keyDispatcher.onKeyUp(this._keyUpCallback)},i.prototype._unanchor=function(){e.prototype._unanchor.call(this),this._positionDispatcher.offMouseMove(this._mouseMoveCallback),this._positionDispatcher=null,this._keyDispatcher.offKeyDown(this._keyDownCallback),this._keyDispatcher.offKeyUp(this._keyUpCallback),this._keyDispatcher=null},i.prototype._handleKeyDownEvent=function(t,e){var i=this._translateToComponentSpace(this._positionDispatcher.lastMousePosition());this._isInsideComponent(i)&&!e.repeat&&(this._keyPressCallbacks[t]&&this._keyPressCallbacks[t].callCallbacks(t),this._downedKeys.add(t))},i.prototype._handleKeyUpEvent=function(t){this._downedKeys.has(t)&&this._keyReleaseCallbacks[t]&&this._keyReleaseCallbacks[t].callCallbacks(t),this._downedKeys["delete"](t)},i.prototype.onKeyPress=function(e,i){return this._keyPressCallbacks[e]||(this._keyPressCallbacks[e]=new t.Utils.CallbackSet),this._keyPressCallbacks[e].add(i),this},i.prototype.offKeyPress=function(t,e){return this._keyPressCallbacks[t]["delete"](e),0===this._keyPressCallbacks[t].size&&delete this._keyPressCallbacks[t],this},i.prototype.onKeyRelease=function(e,i){return this._keyReleaseCallbacks[e]||(this._keyReleaseCallbacks[e]=new t.Utils.CallbackSet),this._keyReleaseCallbacks[e].add(i),this},i.prototype.offKeyRelease=function(t,e){return this._keyReleaseCallbacks[t]["delete"](e),0===this._keyReleaseCallbacks[t].size&&delete this._keyReleaseCallbacks[t],this},i}(t.Interaction);e.Key=i}(e=t.Interactions||(t.Interactions={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(){var i=this;e.apply(this,arguments),this._overComponent=!1,this._pointerEnterCallbacks=new t.Utils.CallbackSet,this._pointerMoveCallbacks=new t.Utils.CallbackSet,this._pointerExitCallbacks=new t.Utils.CallbackSet,this._mouseMoveCallback=function(t,e){return i._handleMouseEvent(t,e)},this._touchStartCallback=function(t,e,n){return i._handleTouchEvent(e[t[0]],n)}}return r(i,e),i.prototype._anchor=function(i){e.prototype._anchor.call(this,i),this._mouseDispatcher=t.Dispatchers.Mouse.getDispatcher(this._componentAttachedTo.content().node()),this._mouseDispatcher.onMouseMove(this._mouseMoveCallback),this._touchDispatcher=t.Dispatchers.Touch.getDispatcher(this._componentAttachedTo.content().node()),this._touchDispatcher.onTouchStart(this._touchStartCallback)},i.prototype._unanchor=function(){e.prototype._unanchor.call(this),this._mouseDispatcher.offMouseMove(this._mouseMoveCallback),this._mouseDispatcher=null,this._touchDispatcher.offTouchStart(this._touchStartCallback),this._touchDispatcher=null},i.prototype._handleMouseEvent=function(t,e){var i=this._mouseDispatcher.eventInsideSVG(e);this._handlePointerEvent(t,i)},i.prototype._handleTouchEvent=function(t,e){var i=this._touchDispatcher.eventInsideSVG(e);this._handlePointerEvent(t,i)},i.prototype._handlePointerEvent=function(t,e){var i=this._translateToComponentSpace(t),n=this._isInsideComponent(i);n&&e?(this._overComponent||this._pointerEnterCallbacks.callCallbacks(i),this._pointerMoveCallbacks.callCallbacks(i)):this._overComponent&&this._pointerExitCallbacks.callCallbacks(i),this._overComponent=n&&e},i.prototype.onPointerEnter=function(t){return this._pointerEnterCallbacks.add(t),this},i.prototype.offPointerEnter=function(t){return this._pointerEnterCallbacks["delete"](t),this},i.prototype.onPointerMove=function(t){return this._pointerMoveCallbacks.add(t),this},i.prototype.offPointerMove=function(t){return this._pointerMoveCallbacks["delete"](t),this},i.prototype.onPointerExit=function(t){return this._pointerExitCallbacks.add(t),this},i.prototype.offPointerExit=function(t){return this._pointerExitCallbacks["delete"](t),this},i}(t.Interaction);e.Pointer=i}(e=t.Interactions||(t.Interactions={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(i){function n(n,r){var o=this;i.call(this),this._wheelCallback=function(t,e){return o._handleWheelEvent(t,e)},this._touchStartCallback=function(t,e,i){return o._handleTouchStart(t,e,i)},this._touchMoveCallback=function(t,e,i){return o._handlePinch(t,e,i)},this._touchEndCallback=function(t,e,i){return o._handleTouchEnd(t,e,i)},this._touchCancelCallback=function(t,e,i){return o._handleTouchEnd(t,e,i)},this._xScales=new t.Utils.Set,this._yScales=new t.Utils.Set,this._dragInteraction=new e.Drag,this._setupDragInteraction(),this._touchIds=d3.map(),this._minDomainExtents=new t.Utils.Map,this._maxDomainExtents=new t.Utils.Map,null!=n&&this.addXScale(n),null!=r&&this.addYScale(r)}return r(n,i),n.prototype._anchor=function(e){i.prototype._anchor.call(this,e),this._dragInteraction.attachTo(e),this._mouseDispatcher=t.Dispatchers.Mouse.getDispatcher(this._componentAttachedTo.content().node()),this._mouseDispatcher.onWheel(this._wheelCallback),this._touchDispatcher=t.Dispatchers.Touch.getDispatcher(this._componentAttachedTo.content().node()),this._touchDispatcher.onTouchStart(this._touchStartCallback),this._touchDispatcher.onTouchMove(this._touchMoveCallback),this._touchDispatcher.onTouchEnd(this._touchEndCallback),this._touchDispatcher.onTouchCancel(this._touchCancelCallback)},n.prototype._unanchor=function(){i.prototype._unanchor.call(this),this._mouseDispatcher.offWheel(this._wheelCallback),this._mouseDispatcher=null,this._touchDispatcher.offTouchStart(this._touchStartCallback),this._touchDispatcher.offTouchMove(this._touchMoveCallback),this._touchDispatcher.offTouchEnd(this._touchEndCallback),this._touchDispatcher.offTouchCancel(this._touchCancelCallback),this._touchDispatcher=null,this._dragInteraction.detachFrom(this._componentAttachedTo)},n.prototype._handleTouchStart=function(t,e,i){for(var n=0;n<t.length&&this._touchIds.size()<2;n++){var r=t[n];this._touchIds.set(r.toString(),this._translateToComponentSpace(e[r]))}},n.prototype._handlePinch=function(t,e,i){var r=this;if(!(this._touchIds.size()<2)){var o=this._touchIds.values();if(this._isInsideComponent(this._translateToComponentSpace(o[0]))&&this._isInsideComponent(this._translateToComponentSpace(o[1]))){var a=n._pointDistance(o[0],o[1]);if(0!==a){t.forEach(function(t){r._touchIds.has(t.toString())&&r._touchIds.set(t.toString(),r._translateToComponentSpace(e[t]))});var s=this._touchIds.values(),l=n._pointDistance(s[0],s[1]);if(0!==l){var c=a/l,h=s.map(function(t,e){return{x:(t.x-o[e].x)/c,y:(t.y-o[e].y)/c}});this.xScales().forEach(function(t){c=r._constrainedZoomAmount(t,c)}),this.yScales().forEach(function(t){c=r._constrainedZoomAmount(t,c)});var u=o.map(function(t,e){return{x:h[e].x*c+t.x,y:h[e].y*c+t.y}}),p=n._centerPoint(o[0],o[1]),d=p.x-(u[0].x+u[1].x)/2;this.xScales().forEach(function(t){r._magnifyScale(t,c,p.x),r._translateScale(t,d)});var _=p.y-(u[0].y+u[1].y)/2;this.yScales().forEach(function(t){r._magnifyScale(t,c,p.y),r._translateScale(t,_)})}}}}},n._centerPoint=function(t,e){var i=Math.min(t.x,e.x),n=Math.max(t.x,e.x),r=Math.min(t.y,e.y),o=Math.max(t.y,e.y);return{x:(i+n)/2,y:(o+r)/2}},n._pointDistance=function(t,e){var i=Math.min(t.x,e.x),n=Math.max(t.x,e.x),r=Math.min(t.y,e.y),o=Math.max(t.y,e.y);return Math.sqrt(Math.pow(n-i,2)+Math.pow(o-r,2))},n.prototype._handleTouchEnd=function(t,e,i){var n=this;t.forEach(function(t){n._touchIds.remove(t.toString())})},n.prototype._magnifyScale=function(t,e,i){var n=function(n){return t.invert(i-(i-n)*e)};t.domain(t.range().map(n))},n.prototype._translateScale=function(t,e){var i=function(i){return t.invert(i+e)};t.domain(t.range().map(i))},n.prototype._handleWheelEvent=function(t,e){var i=this,r=this._translateToComponentSpace(t);if(this._isInsideComponent(r)){e.preventDefault();var o=e.deltaY*(e.deltaMode?n._PIXELS_PER_LINE:1),a=Math.pow(2,.002*o);this.xScales().forEach(function(t){a=i._constrainedZoomAmount(t,a)}),this.yScales().forEach(function(t){a=i._constrainedZoomAmount(t,a)}),this.xScales().forEach(function(t){i._magnifyScale(t,a,r.x)}),this.yScales().forEach(function(t){i._magnifyScale(t,a,r.y)})}},n.prototype._constrainedZoomAmount=function(t,e){var i=e>1,n=i?this.maxDomainExtent(t):this.minDomainExtent(t);if(null==n)return e;var r=t.domain(),o=Math.abs(r[1]-r[0]),a=i?Math.min:Math.max;return a(e,n/o)},n.prototype._setupDragInteraction=function(){var t=this;this._dragInteraction.constrainedToComponent(!1);var e;this._dragInteraction.onDragStart(function(){return e=null}),this._dragInteraction.onDrag(function(i,n){if(!(t._touchIds.size()>=2)){var r=(null==e?i.x:e.x)-n.x;t.xScales().forEach(function(e){t._translateScale(e,r)});var o=(null==e?i.y:e.y)-n.y;t.yScales().forEach(function(e){t._translateScale(e,o)}),e=n}})},n.prototype._nonLinearScaleWithExtents=function(e){return!(null==this.minDomainExtent(e)||null==this.maxDomainExtent(e)||e instanceof t.Scales.Linear||e instanceof t.Scales.Time)},n.prototype.xScales=function(e){var i=this;if(null==e){var n=[];return this._xScales.forEach(function(t){n.push(t)}),n}return this._xScales=new t.Utils.Set,e.forEach(function(t){i.addXScale(t)}),this},n.prototype.yScales=function(e){var i=this;if(null==e){var n=[];return this._yScales.forEach(function(t){n.push(t)}),n}return this._yScales=new t.Utils.Set,e.forEach(function(t){i.addYScale(t)}),this},n.prototype.addXScale=function(t){return this._xScales.add(t),this},n.prototype.removeXScale=function(t){return this._xScales["delete"](t),this._minDomainExtents["delete"](t),this._maxDomainExtents["delete"](t),this},n.prototype.addYScale=function(t){return this._yScales.add(t),this},n.prototype.removeYScale=function(t){return this._yScales["delete"](t),this._minDomainExtents["delete"](t),this._maxDomainExtents["delete"](t),this},n.prototype.minDomainExtent=function(e,i){if(null==i)return this._minDomainExtents.get(e);if(i.valueOf()<0)throw new Error("extent must be non-negative");var n=this.maxDomainExtent(e);if(null!=n&&n.valueOf()<i.valueOf())throw new Error("minDomainExtent must be smaller than maxDomainExtent for the same Scale");return this._nonLinearScaleWithExtents(e)&&t.Utils.Window.warn("Panning and zooming with extents on a nonlinear scale may have unintended behavior."),this._minDomainExtents.set(e,i),this},n.prototype.maxDomainExtent=function(e,i){if(null==i)return this._maxDomainExtents.get(e);if(i.valueOf()<=0)throw new Error("extent must be positive");var n=this.minDomainExtent(e);if(null!=n&&i.valueOf()<n.valueOf())throw new Error("maxDomainExtent must be larger than minDomainExtent for the same Scale");return this._nonLinearScaleWithExtents(e)&&t.Utils.Window.warn("Panning and zooming with extents on a nonlinear scale may have unintended behavior."),this._maxDomainExtents.set(e,i),this},n._PIXELS_PER_LINE=120,n}(t.Interaction);e.PanZoom=i}(e=t.Interactions||(t.Interactions={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(){var i=this;e.apply(this,arguments),this._dragging=!1,this._constrainedToComponent=!0,this._dragStartCallbacks=new t.Utils.CallbackSet,this._dragCallbacks=new t.Utils.CallbackSet,this._dragEndCallbacks=new t.Utils.CallbackSet,this._mouseDownCallback=function(t,e){return i._startDrag(t,e)},this._mouseMoveCallback=function(t,e){return i._doDrag(t,e)},this._mouseUpCallback=function(t,e){return i._endDrag(t,e)},this._touchStartCallback=function(t,e,n){return i._startDrag(e[t[0]],n)},this._touchMoveCallback=function(t,e,n){return i._doDrag(e[t[0]],n)},this._touchEndCallback=function(t,e,n){return i._endDrag(e[t[0]],n)}}return r(i,e),i.prototype._anchor=function(i){e.prototype._anchor.call(this,i),this._mouseDispatcher=t.Dispatchers.Mouse.getDispatcher(this._componentAttachedTo.content().node()),this._mouseDispatcher.onMouseDown(this._mouseDownCallback),this._mouseDispatcher.onMouseMove(this._mouseMoveCallback),this._mouseDispatcher.onMouseUp(this._mouseUpCallback),this._touchDispatcher=t.Dispatchers.Touch.getDispatcher(this._componentAttachedTo.content().node()),this._touchDispatcher.onTouchStart(this._touchStartCallback),this._touchDispatcher.onTouchMove(this._touchMoveCallback),this._touchDispatcher.onTouchEnd(this._touchEndCallback)},i.prototype._unanchor=function(){e.prototype._unanchor.call(this),this._mouseDispatcher.offMouseDown(this._mouseDownCallback),this._mouseDispatcher.offMouseMove(this._mouseMoveCallback),this._mouseDispatcher.offMouseUp(this._mouseUpCallback),this._mouseDispatcher=null,this._touchDispatcher.offTouchStart(this._touchStartCallback),this._touchDispatcher.offTouchMove(this._touchMoveCallback),this._touchDispatcher.offTouchEnd(this._touchEndCallback),this._touchDispatcher=null},i.prototype._translateAndConstrain=function(e){var i=this._translateToComponentSpace(e);return this._constrainedToComponent?{x:t.Utils.Math.clamp(i.x,0,this._componentAttachedTo.width()),y:t.Utils.Math.clamp(i.y,0,this._componentAttachedTo.height())}:i},i.prototype._startDrag=function(t,e){if(!(e instanceof MouseEvent&&0!==e.button)){var i=this._translateToComponentSpace(t);this._isInsideComponent(i)&&(e.preventDefault(),this._dragging=!0,this._dragOrigin=i,this._dragStartCallbacks.callCallbacks(this._dragOrigin))}},i.prototype._doDrag=function(t,e){this._dragging&&this._dragCallbacks.callCallbacks(this._dragOrigin,this._translateAndConstrain(t))},i.prototype._endDrag=function(t,e){e instanceof MouseEvent&&0!==e.button||this._dragging&&(this._dragging=!1,this._dragEndCallbacks.callCallbacks(this._dragOrigin,this._translateAndConstrain(t)))},i.prototype.constrainedToComponent=function(t){return null==t?this._constrainedToComponent:(this._constrainedToComponent=t,this)},i.prototype.onDragStart=function(t){return this._dragStartCallbacks.add(t),this},i.prototype.offDragStart=function(t){return this._dragStartCallbacks["delete"](t),this},i.prototype.onDrag=function(t){return this._dragCallbacks.add(t),this},i.prototype.offDrag=function(t){return this._dragCallbacks["delete"](t),this},i.prototype.onDragEnd=function(t){return this._dragEndCallbacks.add(t),this},i.prototype.offDragEnd=function(t){return this._dragEndCallbacks["delete"](t),this},i}(t.Interaction);e.Drag=i}(e=t.Interactions||(t.Interactions={}))}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(i){function n(){i.call(this),this._detectionRadius=3,this._resizable=!1,this._movable=!1,this._hasCorners=!0,this.addClass("drag-box-layer"),this._dragInteraction=new t.Interactions.Drag,this._setUpCallbacks(),this._dragInteraction.attachTo(this),this._dragStartCallbacks=new t.Utils.CallbackSet,this._dragCallbacks=new t.Utils.CallbackSet,this._dragEndCallbacks=new t.Utils.CallbackSet}return r(n,i),n.prototype._setUpCallbacks=function(){var t,i,n,r,o=this,a={newBox:0,resize:1,move:2},s=a.newBox,l=function(l){t=o._getResizingEdges(l);var c=o.bounds(),h=c.topLeft.x<=l.x&&l.x<=c.bottomRight.x&&c.topLeft.y<=l.y&&l.y<=c.bottomRight.y;o.boxVisible()&&(t.top||t.bottom||t.left||t.right)?s=a.resize:o.boxVisible()&&o.movable()&&h?s=a.move:(s=a.newBox,o._setBounds({topLeft:l,bottomRight:l}),o._xBoundsMode===e.PropertyMode.VALUE&&null!=o.xScale()&&o._setXExtent([o.xScale().invert(l.x),o.xScale().invert(l.x)]),o._yBoundsMode===e.PropertyMode.VALUE&&null!=o.yScale()&&o._setYExtent([o.yScale().invert(l.y),o.yScale().invert(l.y)]),o.render()),o.boxVisible(!0),c=o.bounds(),i={x:c.topLeft.x,y:c.topLeft.y},n={x:c.bottomRight.x,y:c.bottomRight.y},r=l,o._dragStartCallbacks.callCallbacks(c)},c=function(l,c){switch(s){case a.newBox:n.x=c.x,n.y=c.y;break;case a.resize:t.bottom?n.y=c.y:t.top&&(i.y=c.y),t.right?n.x=c.x:t.left&&(i.x=c.x);break;case a.move:var h=c.x-r.x,u=c.y-r.y;i.x+=h,i.y+=u,n.x+=h,n.y+=u,r=c}o._setBounds({topLeft:i,bottomRight:n}),o._xBoundsMode===e.PropertyMode.VALUE&&null!=o.xScale()&&o._setXExtent([o.xScale().invert(i.x),o.xScale().invert(n.x)]),o._yBoundsMode===e.PropertyMode.VALUE&&null!=o.yScale()&&o._setYExtent([o.yScale().invert(i.y),o.yScale().invert(n.y)]),o.render(),o._dragCallbacks.callCallbacks(o.bounds())},h=function(t,e){s===a.newBox&&t.x===e.x&&t.y===e.y&&o.boxVisible(!1),o._dragEndCallbacks.callCallbacks(o.bounds())};this._dragInteraction.onDragStart(l),this._dragInteraction.onDrag(c),this._dragInteraction.onDragEnd(h),this._disconnectInteraction=function(){o._dragInteraction.offDragStart(l),o._dragInteraction.offDrag(c),o._dragInteraction.offDragEnd(h),o._dragInteraction.detachFrom(o)}},n.prototype._setup=function(){var t=this;i.prototype._setup.call(this);var e=function(){return t._box.append("line").style({opacity:0,stroke:"pink","pointer-events":"visibleStroke"})};if(this._detectionEdgeT=e().classed("drag-edge-tb",!0),this._detectionEdgeB=e().classed("drag-edge-tb",!0),this._detectionEdgeL=e().classed("drag-edge-lr",!0),this._detectionEdgeR=e().classed("drag-edge-lr",!0),this._hasCorners){var n=function(){return t._box.append("circle").style({opacity:0,fill:"pink","pointer-events":"visibleFill"})};this._detectionCornerTL=n().classed("drag-corner-tl",!0),this._detectionCornerTR=n().classed("drag-corner-tr",!0),this._detectionCornerBL=n().classed("drag-corner-bl",!0),this._detectionCornerBR=n().classed("drag-corner-br",!0)}},n.prototype._getResizingEdges=function(t){var e={top:!1,bottom:!1,left:!1,right:!1};if(!this.resizable())return e;var i=this.bounds(),n=i.topLeft.y,r=i.bottomRight.y,o=i.topLeft.x,a=i.bottomRight.x,s=this._detectionRadius;return o-s<=t.x&&t.x<=a+s&&(e.top=n-s<=t.y&&t.y<=n+s,e.bottom=r-s<=t.y&&t.y<=r+s),n-s<=t.y&&t.y<=r+s&&(e.left=o-s<=t.x&&t.x<=o+s,e.right=a-s<=t.x&&t.x<=a+s),e},n.prototype.renderImmediately=function(){if(i.prototype.renderImmediately.call(this),this.boxVisible()){var t=this.bounds(),e=t.topLeft.y,n=t.bottomRight.y,r=t.topLeft.x,o=t.bottomRight.x;return this._detectionEdgeT.attr({x1:r,y1:e,x2:o,y2:e,"stroke-width":2*this._detectionRadius}),this._detectionEdgeB.attr({x1:r,y1:n,x2:o,y2:n,"stroke-width":2*this._detectionRadius}),this._detectionEdgeL.attr({x1:r,y1:e,x2:r,y2:n,"stroke-width":2*this._detectionRadius}),this._detectionEdgeR.attr({x1:o,y1:e,x2:o,y2:n,"stroke-width":2*this._detectionRadius}),this._hasCorners&&(this._detectionCornerTL.attr({cx:r,cy:e,r:this._detectionRadius}),this._detectionCornerTR.attr({cx:o,cy:e,r:this._detectionRadius}),this._detectionCornerBL.attr({cx:r,cy:n,r:this._detectionRadius}),this._detectionCornerBR.attr({cx:o,cy:n,r:this._detectionRadius})),this}},n.prototype.detectionRadius=function(t){if(null==t)return this._detectionRadius;if(0>t)throw new Error("detection radius cannot be negative.");return this._detectionRadius=t,this.render(),this},n.prototype.resizable=function(t){return null==t?this._resizable:(this._resizable=t,this._setResizableClasses(t),this)},n.prototype._setResizableClasses=function(t){t&&this.enabled()?(this.addClass("x-resizable"),this.addClass("y-resizable")):(this.removeClass("x-resizable"),this.removeClass("y-resizable"))},n.prototype.movable=function(t){return null==t?this._movable:(this._movable=t,this._setMovableClass(),this)},n.prototype._setMovableClass=function(){this.movable()&&this.enabled()?this.addClass("movable"):this.removeClass("movable")},n.prototype.onDragStart=function(t){return this._dragStartCallbacks.add(t),this},n.prototype.offDragStart=function(t){return this._dragStartCallbacks["delete"](t),this},n.prototype.onDrag=function(t){return this._dragCallbacks.add(t),this},n.prototype.offDrag=function(t){return this._dragCallbacks["delete"](t),this},n.prototype.onDragEnd=function(t){return this._dragEndCallbacks.add(t),this},n.prototype.offDragEnd=function(t){return this._dragEndCallbacks["delete"](t),this},n.prototype.dragInteraction=function(){return this._dragInteraction},n.prototype.enabled=function(t){return null==t?this._dragInteraction.enabled():(this._dragInteraction.enabled(t),this._setResizableClasses(this.resizable()),this._setMovableClass(),this)},n.prototype.destroy=function(){var t=this;i.prototype.destroy.call(this),this._dragStartCallbacks.forEach(function(e){return t._dragCallbacks["delete"](e)}),this._dragCallbacks.forEach(function(e){return t._dragCallbacks["delete"](e)}),this._dragEndCallbacks.forEach(function(e){return t._dragEndCallbacks["delete"](e)}),this._disconnectInteraction()},n.prototype.detach=function(){return this._resetState(),this._dragInteraction.detachFrom(this),i.prototype.detach.call(this),this},n.prototype.anchor=function(t){return this._dragInteraction.attachTo(this),i.prototype.anchor.call(this,t),this},n.prototype._resetState=function(){this.bounds({topLeft:{x:0,y:0},bottomRight:{x:0,y:0}})},n}(e.SelectionBoxLayer);e.DragBoxLayer=i}(e=t.Components||(t.Components={}))}(n||(n={}));var n;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this),this.addClass("x-drag-box-layer"),this._hasCorners=!1}return r(e,t),e.prototype.computeLayout=function(e,i,n){return t.prototype.computeLayout.call(this,e,i,n),this._setBounds(this.bounds()),this},e.prototype._setBounds=function(e){t.prototype._setBounds.call(this,{topLeft:{x:e.topLeft.x,y:0},bottomRight:{x:e.bottomRight.x,y:this.height()}})},e.prototype._setResizableClasses=function(t){t&&this.enabled()?this.addClass("x-resizable"):this.removeClass("x-resizable")},e.prototype.yScale=function(e){if(null==e)return t.prototype.yScale.call(this);throw new Error("yScales cannot be set on an XDragBoxLayer")},e.prototype.yExtent=function(e){if(null==e)return t.prototype.yExtent.call(this);throw new Error("XDragBoxLayer has no yExtent")},e}(t.DragBoxLayer);t.XDragBoxLayer=e}(e=t.Components||(t.Components={}))}(n||(n={}));var n;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this),this.addClass("y-drag-box-layer"),this._hasCorners=!1}return r(e,t),e.prototype.computeLayout=function(e,i,n){return t.prototype.computeLayout.call(this,e,i,n),this._setBounds(this.bounds()),this},e.prototype._setBounds=function(e){t.prototype._setBounds.call(this,{topLeft:{x:0,y:e.topLeft.y},bottomRight:{x:this.width(),y:e.bottomRight.y}})},e.prototype._setResizableClasses=function(t){t&&this.enabled()?this.addClass("y-resizable"):this.removeClass("y-resizable")},e.prototype.xScale=function(e){if(null==e)return t.prototype.xScale.call(this);throw new Error("xScales cannot be set on an YDragBoxLayer")},e.prototype.xExtent=function(e){if(null==e)return t.prototype.xExtent.call(this);throw new Error("YDragBoxLayer has no xExtent")},e}(t.DragBoxLayer);t.YDragBoxLayer=e}(e=t.Components||(t.Components={}))}(n||(n={}));var n;!function(t){}(n||(n={}));var n;!function(t){var e;!function(e){var i=function(e){function i(i){var n=this;e.call(this,i),this._detectionRadius=3,this._enabled=!0,this.addClass("drag-line-layer"),this.addClass("enabled"),this._dragInteraction=new t.Interactions.Drag,this._dragInteraction.attachTo(this);var r=function(t){return n._isVertical()&&n.pixelPosition()-n.detectionRadius()<=t.x&&t.x<=n.pixelPosition()+n.detectionRadius()||!n._isVertical()&&n.pixelPosition()-n.detectionRadius()<=t.y&&t.y<=n.pixelPosition()+n.detectionRadius()},o=!1,a=function(t){r(t)&&(o=!0,n._dragStartCallbacks.callCallbacks(n))};this._dragInteraction.onDragStart(a);var s=function(t,e){o&&(n._setPixelPositionWithoutChangingMode(n._isVertical()?e.x:e.y),n._dragCallbacks.callCallbacks(n))};this._dragInteraction.onDrag(s);var l=function(t,e){o&&(o=!1,n._dragEndCallbacks.callCallbacks(n))};this._dragInteraction.onDragEnd(l),this._disconnectInteraction=function(){n._dragInteraction.offDragStart(a),n._dragInteraction.offDrag(s),n._dragInteraction.offDragEnd(l),n._dragInteraction.detachFrom(n)},this._dragStartCallbacks=new t.Utils.CallbackSet,this._dragCallbacks=new t.Utils.CallbackSet,this._dragEndCallbacks=new t.Utils.CallbackSet}return r(i,e),i.prototype._setup=function(){e.prototype._setup.call(this),this._detectionEdge=this.content().append("line").style({opacity:0,stroke:"pink","pointer-events":"visibleStroke"}).classed("drag-edge",!0)},i.prototype.renderImmediately=function(){return e.prototype.renderImmediately.call(this),this._detectionEdge.attr({x1:this._isVertical()?this.pixelPosition():0,y1:this._isVertical()?0:this.pixelPosition(),x2:this._isVertical()?this.pixelPosition():this.width(),y2:this._isVertical()?this.height():this.pixelPosition(),"stroke-width":2*this._detectionRadius}),this},i.prototype.detectionRadius=function(t){if(null==t)return this._detectionRadius;if(0>t)throw new Error("detection radius cannot be negative.");return this._detectionRadius=t,this.render(),this},i.prototype.enabled=function(t){return null==t?this._enabled:(this._enabled=t,t?this.addClass("enabled"):this.removeClass("enabled"),this._dragInteraction.enabled(t),this)},i.prototype.onDragStart=function(t){return this._dragStartCallbacks.add(t),this},i.prototype.offDragStart=function(t){return this._dragStartCallbacks["delete"](t),this},i.prototype.onDrag=function(t){return this._dragCallbacks.add(t),this},i.prototype.offDrag=function(t){return this._dragCallbacks["delete"](t),this},i.prototype.onDragEnd=function(t){return this._dragEndCallbacks.add(t),this},i.prototype.offDragEnd=function(t){return this._dragEndCallbacks["delete"](t),this},i.prototype.destroy=function(){var t=this;e.prototype.destroy.call(this),this._dragStartCallbacks.forEach(function(e){return t._dragStartCallbacks["delete"](e)}),this._dragCallbacks.forEach(function(e){return t._dragCallbacks["delete"](e)}),this._dragEndCallbacks.forEach(function(e){return t._dragEndCallbacks["delete"](e)}),this._disconnectInteraction()},i}(e.GuideLineLayer);e.DragLineLayer=i}(e=t.Components||(t.Components={}))}(n||(n={}));var o;!function(t){var e;!function(t){var e;!function(t){function e(t,e){if(null==t||null==e)return t===e;if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function i(t,i){if(null==t||null==i)return t===i;var n=Object.keys(t).sort(),r=Object.keys(i).sort(),o=n.map(function(e){return t[e]}),a=r.map(function(t){return i[t]});return e(n,r)&&e(o,a)}t.arrayEq=e,t.objEq=i}(e=t.Methods||(t.Methods={}))}(e=t.Utils||(t.Utils={}))}(o||(o={}));var o;!function(t){var e;!function(t){var e;!function(t){function e(t,e,i){var n=d3.transform(t.attr("transform"));return null==e?n.translate:(i=null==i?0:i,n.translate[0]=e,n.translate[1]=i,t.attr("transform",n.toString()),t)}function i(t){var e;try{e=t.node().getBBox()}catch(i){e={x:0,y:0,width:0,height:0}}return e}t.transform=e,t.getBBox=i}(e=t.DOM||(t.DOM={}))}(e=t.Utils||(t.Utils={}))}(o||(o={}));var o;!function(t){var e;!function(t){var e=function(){function t(t,e){void 0===e&&(e=function(t,e){return t===e}),this.cache=d3.map(),this.compute=t,this.valueEq=e}return t.prototype.get=function(t){return this.cache.has(t)||this.cache.set(t,this.compute(t)),this.cache.get(t)},t.prototype.clear=function(){return this.cache=d3.map(),this},t}();t.Cache=e}(e=t.Utils||(t.Utils={}))}(o||(o={}));var o;!function(t){var e;!function(t){var e=function(){function t(){this.WordDividerRegExp=new RegExp("\\W"),this.WhitespaceRegExp=new RegExp("\\s")}return t.prototype.tokenize=function(t){var e=this;return t.split("").reduce(function(t,i){return t.slice(0,-1).concat(e.shouldCreateNewToken(t[t.length-1],i))},[""])},t.prototype.shouldCreateNewToken=function(t,e){if(!t)return[e];var i=t[t.length-1];return this.WhitespaceRegExp.test(i)&&this.WhitespaceRegExp.test(e)?[t+e]:this.WhitespaceRegExp.test(i)||this.WhitespaceRegExp.test(e)?[t,e]:this.WordDividerRegExp.test(i)||this.WordDividerRegExp.test(e)?i===e?[t+e]:[t,e]:[t+e]},t}();t.Tokenizer=e}(e=t.Utils||(t.Utils={}))}(o||(o={}));var o;!function(t){var e;!function(t){var e;!function(t){function e(t){return t.replace(/\s+/g," ")}function i(t){return t&&""!==t.trim()}function n(t,e){if(!t)return t;var n=t.split(""),r=e?function(t){return t.split(e).some(i)}:i;return n.reduce(function(t,e){return r(t+e)?t+e:t},"")}function r(t,e){if(!t)return t;var i=t.split("");return i.reverse(),i=n(i.join(""),e).split(""),i.reverse(),i.join("")}t.combineWhitespace=e,t.isNotEmptyString=i,t.trimStart=n,t.trimEnd=r}(e=t.StringMethods||(t.StringMethods={}))}(e=t.Utils||(t.Utils={}))}(o||(o={}));var o;!function(t){var e;!function(t){var e=function(){function t(){this.duration(t.DEFAULT_DURATION_MILLISECONDS),this.delay(0),this.easing(t.DEFAULT_EASING),this.moveX(0),this.moveY(0)}return t.prototype.animate=function(t){var e=d3.transform("");return e.translate=[this.moveX(),this.moveY()],t.attr("transform",e.toString()),e.translate=[0,0],this._animate(t,{transform:e.toString()})},t.prototype._animate=function(t,e){return t.transition().ease(this.easing()).duration(this.duration()).delay(this.delay()).attr(e)},t.prototype.duration=function(t){return null==t?this._duration:(this._duration=t,this)},t.prototype.moveX=function(t){return null==t?this._moveX:(this._moveX=t,this)},t.prototype.moveY=function(t){return null==t?this._moveY:(this._moveY=t,this)},t.prototype.delay=function(t){return null==t?this._delay:(this._delay=t,this)},t.prototype.easing=function(t){return null==t?this._easing:(this._easing=t,this)},t.DEFAULT_DURATION_MILLISECONDS=300,t.DEFAULT_EASING="exp-out",t}();t.BaseAnimator=e}(e=t.Animators||(t.Animators={}))}(o||(o={}));var o,r=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i};!function(t){var e;!function(e){var i=function(e){function i(){this.direction("bottom"),e.call(this)}return r(i,e),i.prototype.direction=function(t){if(null==t)return this._direction;if(-1===i.SupportedDirections.indexOf(t))throw new Error("unsupported direction - "+t);return this._direction=t,this},i.prototype.animate=function(i){var n=t.Utils.DOM.getBBox(i),r=i.select(".clip-rect");switch(r.attr("width",0),r.attr("height",0),this._direction){case"top":r.attr("y",n.y+n.height),r.attr("x",n.x),r.attr("width",n.width);break;case"bottom":r.attr("y",n.y),r.attr("x",n.x),r.attr("width",n.width);break;case"left":r.attr("y",n.y),r.attr("x",n.x),r.attr("height",n.height);break;case"right":r.attr("y",n.y),r.attr("x",n.x+n.width),r.attr("height",n.height)}return this._animate(r,n),e.prototype.animate.call(this,i)},i.SupportedDirections=["top","bottom","left","right"],i}(e.BaseAnimator);e.UnveilAnimator=i}(e=t.Animators||(t.Animators={}))}(o||(o={}));var o,r=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i};!function(t){var e;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return r(e,t),e.prototype.animate=function(e){var i=e.select(".text-area");i.attr("opacity",0);var n={opacity:1};return this._animate(i,n),t.prototype.animate.call(this,e)},e}(t.BaseAnimator);t.OpacityAnimator=e}(e=t.Animators||(t.Animators={}))}(o||(o={}));var o;!function(t){var e;!function(e){var i=function(){function e(){this.maxLines(1/0),this.textTrimming("ellipsis"),this.allowBreakingWords(!0),this._tokenizer=new t.Utils.Tokenizer,this._breakingCharacter="-"}return e.prototype.maxLines=function(t){return null==t?this._maxLines:(this._maxLines=t,
this)},e.prototype.textTrimming=function(t){if(null==t)return this._textTrimming;if("ellipsis"!==t&&"none"!==t)throw new Error(t+" - unsupported text trimming option.");return this._textTrimming=t,this},e.prototype.allowBreakingWords=function(t){return null==t?this._allowBreakingWords:(this._allowBreakingWords=t,this)},e.prototype.wrap=function(t,e,i,n){var r=this;void 0===n&&(n=1/0);var o={originalText:t,wrappedText:"",noLines:0,noBrokeWords:0,truncatedText:""},a={wrapping:o,currentLine:"",availableWidth:i,availableLines:Math.min(Math.floor(n/e.measure().height),this._maxLines),canFitText:!0},s=t.split("\n");return s.reduce(function(t,i,n){return r.breakLineToFitWidth(t,i,n!==s.length-1,e)},a).wrapping},e.prototype.breakLineToFitWidth=function(e,i,n,r){var o=this;e.canFitText||""===e.wrapping.truncatedText||(e.wrapping.truncatedText+="\n");var a=this._tokenizer.tokenize(i);e=a.reduce(function(t,e){return o.wrapNextToken(e,t,r)},e);var s=t.Utils.StringMethods.trimEnd(e.currentLine);if(e.wrapping.noLines+=+(""!==s),e.wrapping.noLines===e.availableLines&&"none"!==this._textTrimming&&n){var l=this.addEllipsis(s,e.availableWidth,r);e.wrapping.wrappedText+=l.wrappedToken,e.wrapping.truncatedText+=l.remainingToken,e.canFitText=!1}else e.wrapping.wrappedText+=s;return e.currentLine="\n",e},e.prototype.canFitToken=function(t,e,i){var n=this,r=this._allowBreakingWords?t.split("").map(function(e,i){return i!==t.length-1?e+n._breakingCharacter:e}):[t];return i.measure(t).width<=e||r.every(function(t){return i.measure(t).width<=e})},e.prototype.addEllipsis=function(e,i,n){if("none"===this._textTrimming)return{wrappedToken:e,remainingToken:""};var r=e.substring(0).trim(),o=n.measure(r).width,a=n.measure("...").width,s=e.length>0&&"\n"===e[0]?"\n":"";if(a>=i){var l=a/3,c=Math.floor(i/l);return{wrappedToken:s+"...".substr(0,c),remainingToken:e}}for(;o+a>i;)r=t.Utils.StringMethods.trimEnd(r.substr(0,r.length-1)),o=n.measure(r).width;return{wrappedToken:s+r+"...",remainingToken:t.Utils.StringMethods.trimEnd(e.substring(r.length),"-").trim()}},e.prototype.wrapNextToken=function(e,i,n){if(!i.canFitText||i.availableLines===i.wrapping.noLines||!this.canFitToken(e,i.availableWidth,n))return this.finishWrapping(e,i,n);for(var r=e;r;){var o=this.breakTokenToFitInWidth(r,i.currentLine,i.availableWidth,n);if(i.currentLine=o.line,r=o.remainingToken,null!=r){if(i.wrapping.noBrokeWords+=+o.breakWord,++i.wrapping.noLines,i.availableLines===i.wrapping.noLines){var a=this.addEllipsis(i.currentLine,i.availableWidth,n);return i.wrapping.wrappedText+=a.wrappedToken,i.wrapping.truncatedText+=a.remainingToken+r,i.currentLine="\n",i}i.wrapping.wrappedText+=t.Utils.StringMethods.trimEnd(i.currentLine),i.currentLine="\n"}}return i},e.prototype.finishWrapping=function(t,e,i){if(e.canFitText&&e.availableLines!==e.wrapping.noLines&&this._allowBreakingWords&&"none"!==this._textTrimming){var n=this.addEllipsis(e.currentLine+t,e.availableWidth,i);e.wrapping.wrappedText+=n.wrappedToken,e.wrapping.truncatedText+=n.remainingToken,e.wrapping.noBrokeWords+=+(n.remainingToken.length<t.length),e.wrapping.noLines+=+(n.wrappedToken.length>0),e.currentLine=""}else e.wrapping.truncatedText+=t;return e.canFitText=!1,e},e.prototype.breakTokenToFitInWidth=function(t,e,i,n,r){if(void 0===r&&(r=this._breakingCharacter),n.measure(e+t).width<=i)return{remainingToken:null,line:e+t,breakWord:!1};if(""===t.trim())return{remainingToken:"",line:e,breakWord:!1};if(!this._allowBreakingWords)return{remainingToken:t,line:e,breakWord:!1};for(var o=0;o<t.length&&n.measure(e+t.substring(0,o+1)+r).width<=i;)++o;var a="";return o>0&&(a=r),{remainingToken:t.substring(o),line:e+t.substring(0,o)+a,breakWord:o>0}},e}();e.Wrapper=i}(e=t.Wrappers||(t.Wrappers={}))}(o||(o={}));var o,r=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i};!function(t){var e;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return r(e,t),e.prototype.wrap=function(i,n,r,o){var a=this;void 0===o&&(o=1/0);var s=i.split("\n");if(s.length>1)throw new Error("SingleLineWrapper is designed to work only on single line");var l=function(e){return t.prototype.wrap.call(a,i,n,e,o)},c=l(r);if(c.noLines<2)return c;for(var h=0,u=r,p=0;p<e.NO_WRAP_ITERATIONS&&u>h;++p){var d=(u+h)/2,_=l(d);this.areSameResults(c,_)?(u=d,c=_):h=d}return c},e.prototype.areSameResults=function(t,e){return t.noLines===e.noLines&&t.truncatedText===e.truncatedText},e.NO_WRAP_ITERATIONS=5,e}(t.Wrapper);t.SingleLineWrapper=e}(e=t.Wrappers||(t.Wrappers={}))}(o||(o={}));var o;!function(t){var e;!function(e){var i=function(){function e(t,i){this._writerID=e.nextID++,this._elementID=0,this.measurer(t),i&&this.wrapper(i),this.addTitleElement(!1)}return e.prototype.measurer=function(t){return this._measurer=t,this},e.prototype.wrapper=function(t){return this._wrapper=t,this},e.prototype.addTitleElement=function(t){return this._addTitleElement=t,this},e.prototype.writeLine=function(i,n,r,o,a){var s=n.append("text");s.text(i);var l=r*e.XOffsetFactor[o],c=e.AnchorConverter[o];s.attr("text-anchor",c).classed("text-line",!0),t.Utils.DOM.transform(s,l,a).attr("y","-0.25em")},e.prototype.writeText=function(t,i,n,r,o,a){var s=this,l=t.split("\n"),c=this._measurer.measure().height,h=e.YOffsetFactor[a]*(r-l.length*c);l.forEach(function(t,e){s.writeLine(t,i,n,o,(e+1)*c+h)})},e.prototype.write=function(t,i,n,r){if(-1===e.SupportedRotation.indexOf(r.textRotation))throw new Error("unsupported rotation - "+r.textRotation);var o=Math.abs(Math.abs(r.textRotation)-90)>45,a=o?i:n,s=o?n:i,l=r.selection.append("g").classed("text-container",!0);this._addTitleElement&&l.append("title").text(t);var c=l.append("g").classed("text-area",!0),h=this._wrapper?this._wrapper.wrap(t,this._measurer,a,s).wrappedText:t;this.writeText(h,c,a,s,r.xAlign,r.yAlign);var u=d3.transform(""),p=d3.transform("");switch(u.rotate=r.textRotation,r.textRotation){case 90:u.translate=[i,0],p.rotate=-90,p.translate=[0,200];break;case-90:u.translate=[0,n],p.rotate=90,p.translate=[i,0];break;case 180:u.translate=[i,n],p.translate=[i,n],p.rotate=180}c.attr("transform",u.toString()),this.addClipPath(l,p),r.animator&&r.animator.animate(l)},e.prototype.addClipPath=function(e,i){var n=this._elementID++,r=/MSIE [5-9]/.test(navigator.userAgent)?"":document.location.href;r=r.split("#")[0];var o="clipPath"+this._writerID+"_"+n;e.select(".text-area").attr("clip-path",'url("'+r+"#"+o+'")');var a=e.append("clipPath").attr("id",o),s=t.Utils.DOM.getBBox(e.select(".text-area")),l=a.append("rect");l.classed("clip-rect",!0).attr({x:s.x,y:s.y,width:s.width,height:s.height})},e.nextID=0,e.SupportedRotation=[-90,0,180,90],e.AnchorConverter={left:"start",center:"middle",right:"end"},e.XOffsetFactor={left:0,center:.5,right:1},e.YOffsetFactor={top:0,center:.5,bottom:1},e}();e.Writer=i}(e=t.Writers||(t.Writers={}))}(o||(o={}));var o;!function(t){var e;!function(e){var i=function(){function e(t,e){this.textMeasurer=this.getTextMeasurer(t,e)}return e.prototype.checkSelectionIsText=function(t){return"text"===t[0][0].tagName||!t.select("text").empty()},e.prototype.getTextMeasurer=function(t,e){var i=this;if(this.checkSelectionIsText(t)){var n,r=t.node().parentNode;return n="text"===t[0][0].tagName?t:t.select("text"),t.remove(),function(e){r.appendChild(t.node());var o=i.measureBBox(n,e);return t.remove(),o}}var o=t.append("text");return e&&o.classed(e,!0),o.remove(),function(e){t.node().appendChild(o.node());var n=i.measureBBox(o,e);return o.remove(),n}},e.prototype.measureBBox=function(e,i){e.text(i);var n=t.Utils.DOM.getBBox(e);return{width:n.width,height:n.height}},e.prototype.measure=function(t){return void 0===t&&(t=e.HEIGHT_TEXT),this.textMeasurer(t)},e.HEIGHT_TEXT="bqpdl",e}();e.AbstractMeasurer=i}(e=t.Measurers||(t.Measurers={}))}(o||(o={}));var o,r=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i};!function(t){var e;!function(t){var e=function(e){function i(t,i,n){void 0===i&&(i=null),void 0===n&&(n=!1),e.call(this,t,i),this.useGuards=n}return r(i,e),i.prototype._addGuards=function(e){return t.AbstractMeasurer.HEIGHT_TEXT+e+t.AbstractMeasurer.HEIGHT_TEXT},i.prototype.getGuardWidth=function(){return null==this.guardWidth&&(this.guardWidth=e.prototype.measure.call(this).width),this.guardWidth},i.prototype._measureLine=function(t){var i=this.useGuards?this._addGuards(t):t,n=e.prototype.measure.call(this,i);return n.width-=this.useGuards?2*this.getGuardWidth():0,n},i.prototype.measure=function(e){var i=this;if(void 0===e&&(e=t.AbstractMeasurer.HEIGHT_TEXT),""===e.trim())return{width:0,height:0};var n=e.trim().split("\n").map(function(t){return i._measureLine(t)});return{width:d3.max(n,function(t){return t.width}),height:d3.sum(n,function(t){return t.height})}},i}(t.AbstractMeasurer);t.Measurer=e}(e=t.Measurers||(t.Measurers={}))}(o||(o={}));var o,r=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i};!function(t){var e;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return r(e,t),e.prototype._measureCharacter=function(e){return t.prototype._measureLine.call(this,e)},e.prototype._measureLine=function(t){var e=this,i=t.split("").map(function(t){return e._measureCharacter(t)});return{width:d3.sum(i,function(t){return t.width}),height:d3.max(i,function(t){return t.height})}},e}(t.Measurer);t.CharacterMeasurer=e}(e=t.Measurers||(t.Measurers={}))}(o||(o={}));var o,r=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i};return function(t){var e;!function(e){var i=function(e){function i(i,n){var r=this;e.call(this,i,n),this.cache=new t.Utils.Cache(function(t){return r._measureCharacterNotFromCache(t)},t.Utils.Methods.objEq)}return r(i,e),i.prototype._measureCharacterNotFromCache=function(t){return e.prototype._measureCharacter.call(this,t)},i.prototype._measureCharacter=function(t){return this.cache.get(t)},i.prototype.reset=function(){this.cache.clear()},i}(e.CharacterMeasurer);e.CacheCharacterMeasurer=i}(e=t.Measurers||(t.Measurers={}))}(o||(o={})),n});