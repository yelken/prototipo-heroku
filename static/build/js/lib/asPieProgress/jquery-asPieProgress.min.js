!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){"use strict";function i(){return"undefined"!=typeof window.performance&&window.performance.now?window.performance.now():Date.now()}function e(t){return"string"==typeof t&&-1!=t.indexOf("%")}Date.now||(Date.now=function(){return(new Date).getTime()});for(var n=["webkit","moz"],s=0;s<n.length&&!window.requestAnimationFrame;++s){var a=n[s];window.requestAnimationFrame=window[a+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a+"CancelAnimationFrame"]||window[a+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS (6|7)/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var r=0;window.requestAnimationFrame=function(t){var e=i(),n=Math.max(r+16,e);return setTimeout(function(){t(r=n)},n-e)},window.cancelAnimationFrame=clearTimeout}var o=function(i,e){var n=document.createElementNS("http://www.w3.org/2000/svg",i);return t.each(e,function(t,i){n.setAttribute(t,i)}),n},h="createElementNS"in document&&new o("svg",{}).createSVGRect,c="asPieProgress",u=t[c]=function(i,e){this.element=i,this.$element=t(i),this.options=t.extend({},u.defaults,e,this.$element.data()),this.namespace=this.options.namespace,this.classes=this.options.classes,this.easing=u.easing[this.options.easing]||u.easing.ease,this.$element.addClass(this.classes.element),this.min=this.$element.attr("aria-valuemin"),this.max=this.$element.attr("aria-valuemax"),this.min=this.min?parseInt(this.min,10):this.options.min,this.max=this.max?parseInt(this.max,10):this.options.max,this.first=this.$element.attr("aria-valuenow"),this.first=this.first?parseInt(this.first,10):this.options.first?this.options.first:this.min,this.now=this.first,this.goal=this.options.goal,this._frameId=null,this.initialized=!1,this._trigger("init"),this.init()};u.defaults={namespace:"asPieProgress",classes:{svg:"pie_progress__svg",element:"pie_progress",number:"pie_progress__number",content:"pie_progress__content"},min:0,max:100,goal:100,size:160,speed:15,barcolor:"#ef1e25",barsize:"4",trackcolor:"#f2f2f2",fillcolor:"none",easing:"ease",numberCallback:function(t){var i=Math.round(this.getPercentage(t));return i+"%"},contentCallback:null};var l=function(t,i,e,n){function s(t,i){return 1-3*i+3*t}function a(t,i){return 3*i-6*t}function r(t){return 3*t}function o(t,i,e){return((s(i,e)*t+a(i,e))*t+r(i))*t}function h(t,i,e){return 3*s(i,e)*t*t+2*a(i,e)*t+r(i)}function c(i){for(var n=i,s=0;4>s;++s){var a=h(n,t,e);if(0===a)return n;var r=o(n,t,e)-i;n-=r/a}return n}return t===i&&e===n?{css:"linear",fn:function(t){return t}}:{css:"cubic-bezier("+t+","+i+","+e+","+n+")",fn:function(t){return o(c(t),i,n)}}};t.extend(u.easing={},{ease:l(.25,.1,.25,1),linear:l(0,0,1,1),"ease-in":l(.42,0,1,1),"ease-out":l(0,0,.58,1),"ease-in-out":l(.42,0,.58,1)}),u.prototype={constructor:u,init:function(){this.$number=this.$element.find("."+this.classes.number),this.$content=this.$element.find("."+this.classes.content),this.size=this.options.size,this.width=this.size,this.height=this.size,this.prepare(),this.initialized=!0,this._trigger("ready")},prepare:function(){h&&(this.svg=new o("svg",{version:"1.1",preserveAspectRatio:"xMinYMin meet",viewBox:"0 0 "+this.width+" "+this.height}),this.buildTrack(),this.buildBar(),t('<div class="'+this.classes.svg+'"></div>').append(this.svg).appendTo(this.$element))},buildTrack:function(){var t=this.size,i=this.size,e=t/2,n=i/2,s=this.options.barsize,a=new o("ellipse",{rx:e-s/2,ry:n-s/2,cx:e,cy:n,stroke:this.options.trackcolor,fill:this.options.fillcolor,"stroke-width":s});this.svg.appendChild(a)},buildBar:function(){if(h){var t=new o("path",{fill:"none","stroke-width":this.options.barsize,stroke:this.options.barcolor});this.bar=t,this.svg.appendChild(t),this._drawBar(this.first),this._updateBar()}},_drawBar:function(t){if(h){this.bar_goal=t;var i=this.size,e=this.size,n=i/2,s=e/2,a=0,r=this.options.barsize,o=Math.min(n,s)-r/2;this.r=o;var c=this.getPercentage(t);100===c&&(c-=1e-4);var u=a+c*Math.PI*2/100,l=n+o*Math.sin(a),f=s-o*Math.cos(a),m=n+o*Math.sin(u),p=s-o*Math.cos(u),d=0;u-a>Math.PI&&(d=1);var g="M"+l+","+f+" A"+o+","+o+" 0 "+d+" 1 "+m+","+p;this.bar.setAttribute("d",g)}},_updateBar:function(){if(h){var t=this.getPercentage(this.now),i=this.bar.getTotalLength(),e=i*(1-t/this.getPercentage(this.bar_goal));this.bar.style.strokeDasharray=i+" "+i,this.bar.style.strokeDashoffset=e}},_trigger:function(t){var i=Array.prototype.slice.call(arguments,1),e=[this].concat(i);this.$element.trigger(c+"::"+t,e),t=t.replace(/\b\w+\b/g,function(t){return t.substring(0,1).toUpperCase()+t.substring(1)});var n="on"+t;"function"==typeof this.options[n]&&this.options[n].apply(this,i)},getPercentage:function(t){return 100*(t-this.min)/(this.max-this.min)},go:function(t){var n=this;this._clear(),e(t)&&(t=parseInt(t.replace("%",""),10),t=Math.round(this.min+t/100*(this.max-this.min))),"undefined"==typeof t&&(t=this.goal),t>this.max?t=this.max:t<this.min&&(t=this.min),this.bar_goal<t&&this._drawBar(t);var s=n.now,a=i(),r=a+100*Math.abs(s-t)*n.options.speed/(n.max-n.min),o=function(i){var e;if(i>r)e=t;else{var h=(i-a)/n.options.speed;e=Math.round(n.easing.fn(h/100)*(n.max-n.min)),t>s?(e=s+e,e>t&&(e=t)):(e=s-e,t>e&&(e=t))}n._update(e),e===t?(window.cancelAnimationFrame(n._frameId),n._frameId=null,n.now===n.goal&&n._trigger("finish")):n._frameId=window.requestAnimationFrame(o)};n._frameId=window.requestAnimationFrame(o)},_update:function(t){this.now=t,this._updateBar(),this.$element.attr("aria-valuenow",this.now),this.$number.length>0&&"function"==typeof this.options.numberCallback&&this.$number.html(this.options.numberCallback.call(this,[this.now])),this.$content.length>0&&"function"==typeof this.options.contentCallback&&this.$content.html(this.options.contentCallback.call(this,[this.now])),this._trigger("update",t)},_clear:function(){this._frameId&&(window.cancelAnimationFrame(this._frameId),this._frameId=null)},get:function(){return this.now},start:function(){this._clear(),this._trigger("start"),this.go(this.goal)},reset:function(){this._clear(),this._drawBar(this.first),this._update(this.first),this._trigger("reset")},stop:function(){this._clear(),this._trigger("stop")},finish:function(){this._clear(),this._update(this.goal),this._trigger("finish")},destory:function(){this.$element.data(c,null),this._trigger("destory")}},t.fn[c]=function(i){if("string"!=typeof i)return this.each(function(){t.data(this,c)||t.data(this,c,new u(this,i))});var e=i,n=Array.prototype.slice.call(arguments,1);if(/^\_/.test(e))return!1;if(!/^(get)$/.test(e))return this.each(function(){var i=t.data(this,c);i&&"function"==typeof i[e]&&i[e].apply(i,n)});var s=this.first().data(c);return s&&"function"==typeof s[e]?s[e].apply(s,n):void 0}});