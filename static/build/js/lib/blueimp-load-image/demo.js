$(function(){"use strict";function e(e){var t;t=e.src||e instanceof HTMLCanvasElement?$('<a target="_blank">').append(e).attr("download",a.name).attr("href",e.src||e.toDataURL()):$("<span>Loading image file failed</span>"),r.children().replaceWith(t),e.getContext&&c.show()}function t(t,n){a=t,loadImage(t,e,n)||r.children().replaceWith($("<span>Your browser does not support the URL or FileReader API.</span>"))}function n(e){var t,n=e.get("Thumbnail"),i=e.getAll(),a=d.find("table").empty(),o=$("<tr></tr>"),r=$("<td></td>");n&&(l.empty(),loadImage(n,function(e){l.append(e).show()},{orientation:e.get("Orientation")}));for(t in i)i.hasOwnProperty(t)&&a.append(o.clone().append(r.clone().text(t)).append(r.clone().text(i[t])));d.show()}function i(e){e.preventDefault(),e=e.originalEvent;var i=e.dataTransfer||e.target,a=i&&i.files&&i.files[0],o={maxWidth:r.width(),canvas:!0,pixelRatio:window.devicePixelRatio,downsamplingRatio:.5};a&&(d.hide(),l.hide(),loadImage.parseMetaData(a,function(e){e.exif&&(o.orientation=e.exif.get("Orientation"),n(e.exif)),t(a,o)}))}var a,o,r=$("#result"),d=$("#exif"),l=$("#thumbnail"),c=$("#actions");(window.createObjectURL||window.URL||window.webkitURL||window.FileReader)&&r.children().hide(),$(document).on("dragover",function(e){e.preventDefault(),e=e.originalEvent,e.dataTransfer.dropEffect="copy"}).on("drop",i),$("#file-input").on("change",i),$("#edit").on("click",function(e){e.preventDefault();var t=r.find("img, canvas"),n=t[0],i=window.devicePixelRatio||1;t.Jcrop({setSelect:[40,40,n.width/i-40,n.height/i-40],onSelect:function(e){o=e},onRelease:function(){o=null}}).parent().on("click",function(e){e.preventDefault()})}),$("#crop").on("click",function(t){t.preventDefault();var n=r.find("img, canvas")[0],i=window.devicePixelRatio||1;n&&o&&(e(loadImage.scale(n,{left:o.x*i,top:o.y*i,sourceWidth:o.w*i,sourceHeight:o.h*i,minWidth:r.width(),maxWidth:r.width(),pixelRatio:i,downsamplingRatio:.5})),o=null)})});